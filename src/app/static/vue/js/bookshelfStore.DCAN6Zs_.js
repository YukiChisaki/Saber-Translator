import{d as ue,r as l,c as f}from"./vue-vendor.DwHUB8Dr.js";import{getBooks as ie,getTags as fe,createBook as de,updateBook as pe,deleteBook as ve,createTag as he,deleteTag as ge,updateTag as ye,createChapter as Be,updateChapter as ke,deleteChapter as $e,reorderChapters as Ce}from"./bookshelf.B4ums9uK.js";const Te="/pic/logo.png",me=ue("bookshelf",()=>{const o=l([]),i=l([]),u=l(""),a=l([]),g=l("updatedAt"),y=l("desc"),c=l(null),v=l(null),B=l(!1),k=l(null),C=f(()=>o.value),Q=f(()=>o.value.length),j=f(()=>C.value.length),q=f(()=>c.value&&o.value.find(e=>e.id===c.value)||null),z=f(()=>v.value&&o.value.find(e=>e.id===v.value)||null),D=f(()=>u.value);function w(e){o.value=e,console.log(`书籍列表已设置，共 ${e.length} 本书`)}function x(e){o.value.unshift(e),console.log(`已添加书籍: ${e.title}`)}function T(e,r){const n=o.value.findIndex(t=>t.id===e);if(n>=0){const t=o.value[n];t&&(o.value[n]={...t,...r},console.log(`已更新书籍: ${e}`))}}function m(e){const r=o.value.findIndex(n=>n.id===e);r>=0&&(o.value.splice(r,1),c.value===e&&(c.value=null),console.log(`已删除书籍: ${e}`))}function G(e){return o.value.find(r=>r.id===e)||null}function A(e,r){const n=o.value.find(t=>t.id===e);n&&(n.chapters||(n.chapters=[]),n.chapters.push(r),console.log(`已添加章节到书籍 ${e}: ${r.title}`))}function S(e,r,n){const t=o.value.find(s=>s.id===e);if(t&&t.chapters){const s=t.chapters.find(p=>p.id===r);s&&(Object.assign(s,n),console.log(`已更新章节: ${r}`))}}function O(e,r){const n=o.value.find(t=>t.id===e);if(n&&n.chapters){const t=n.chapters.findIndex(s=>s.id===r);t>=0&&(n.chapters.splice(t,1),console.log(`已删除章节: ${r}`))}}function E(e,r){const n=o.value.find(t=>t.id===e);if(n&&n.chapters){const t=[];for(let s=0;s<r.length;s++){const p=n.chapters.find(le=>le.id===r[s]);p&&(p.order=s,t.push(p))}n.chapters=t,console.log(`已重新排序章节: ${e}`)}}function F(e){i.value=e,console.log(`标签列表已设置，共 ${e.length} 个标签`)}function K(e){i.value.push(e),console.log(`已添加标签: ${e.name}`)}function _(e){const r=i.value.findIndex(n=>n.name===e);if(r>=0){i.value.splice(r,1);const n=a.value.indexOf(e);n>=0&&a.value.splice(n,1),console.log(`已删除标签: ${e}`)}}function H(e){u.value=e}function J(){u.value=""}function L(e){const r=a.value.indexOf(e);r>=0?a.value.splice(r,1):a.value.push(e),d()}function M(e){a.value=e}function P(){a.value=[]}function R(e,r="desc"){g.value=e,y.value=r}function U(e){c.value=e}function V(){c.value=null}function W(e){c.value===e?c.value=null:c.value=e}function $(e){B.value=e}function h(e){k.value=e}function X(e){v.value=e}function Y(e){u.value=e,d()}async function d(){$(!0),h(null);try{const e={};u.value.trim()&&(e.search=u.value.trim()),a.value.length>0&&(e.tags=a.value);const r=await ie(e);r.success&&r.books?w(r.books):h(r.error||"加载书籍失败")}catch(e){h(e instanceof Error?e.message:"加载书籍失败"),console.error("加载书籍失败:",e)}finally{$(!1)}}async function b(){try{const e=await fe();e.success&&e.tags&&F(e.tags)}catch(e){console.error("加载标签失败:",e)}}async function Z(e,r,n,t){try{const s=await de(e,r,n,t);return s.success&&s.book?(x(s.book),s.book):null}catch(s){return console.error("创建书籍失败:",s),null}}async function N(e,r){try{const n=await pe(e,r);return n.success&&n.book?(T(e,n.book),!0):!1}catch(n){return console.error("更新书籍失败:",n),!1}}async function I(e){try{return(await ve(e)).success?(m(e),!0):!1}catch(r){return console.error("删除书籍失败:",r),!1}}async function ee(e,r){try{const n=await he(e,r);return n.success&&n.tag?(K(n.tag),n.tag):null}catch(n){return console.error("创建标签失败:",n),null}}async function ne(e){try{return(await ge(e)).success?(_(e),!0):!1}catch(r){return console.error("删除标签失败:",r),!1}}async function re(e,r,n){try{return(await ye(e,r,n)).success?(await b(),await d(),!0):!1}catch(t){return console.error("更新标签失败:",t),!1}}async function te(e,r){try{const n=await Be(e,r);return n.success&&n.chapter?(A(e,n.chapter),n.chapter):null}catch(n){return console.error("创建章节失败:",n),null}}async function oe(e,r,n){try{return(await ke(e,r,n)).success?(S(e,r,{title:n}),!0):!1}catch(t){return console.error("更新章节失败:",t),!1}}async function se(e,r){try{return(await $e(e,r)).success?(O(e,r),!0):!1}catch(n){return console.error("删除章节失败:",n),!1}}async function ae(e,r){try{return(await Ce(e,r)).success?(E(e,r),!0):!1}catch(n){return console.error("重新排序章节失败:",n),!1}}function ce(){o.value=[],i.value=[],u.value="",a.value=[],g.value="updatedAt",y.value="desc",c.value=null,B.value=!1,k.value=null,console.log("书架状态已重置")}return{books:o,tags:i,searchKeyword:u,selectedTagIds:a,sortBy:g,sortOrder:y,expandedBookId:c,currentBookId:v,isLoading:B,error:k,filteredBooks:C,bookCount:Q,filteredBookCount:j,expandedBook:q,currentBook:z,searchQuery:D,setBooks:w,addBook:x,updateBook:T,deleteBook:m,getBookById:G,addChapter:A,updateChapter:S,deleteChapter:O,reorderChapters:E,setTags:F,addTag:K,deleteTag:_,setSearchKeyword:H,clearSearchKeyword:J,setSearchQuery:Y,toggleTagFilter:L,setTagFilter:M,clearTagFilter:P,setSort:R,expandBook:U,collapseBook:V,toggleBookExpand:W,setCurrentBook:X,setLoading:$,setError:h,loadBooks:d,fetchBooks:d,loadTags:b,createBook:Z,updateBookApi:N,deleteBookApi:I,createTag:ee,deleteTagApi:ne,updateTagApi:re,createChapterApi:te,updateChapterApi:oe,deleteChapterApi:se,reorderChaptersApi:ae,reset:ce}});export{Te as _,me as u};
