import{a as G,c as k,o as V,b as O,w as z,e as f,h as H,f as e,F as L,j as F,k as C,t as I,r as b,v as J,x as K,n as N,i as Y,l as M,y as j}from"./vue-vendor.DwHUB8Dr.js";import{getBookDetail as q,getChapterImages as U}from"./bookshelf.B4ums9uK.js";import{_ as W,u as Q}from"./index.BDlD_Y71.js";import"./client.Bht704G-.js";import"./utils-vendor.B9ygI19o.js";const X={class:"reader-main"},Z={key:0,id:"loadingState",class:"loading-state"},ee={key:1,id:"emptyState",class:"empty-state"},te={key:2,id:"imagesContainer",class:"images-container"},ae=["src","alt"],ne={class:"image-index"},oe=G({__name:"ReaderCanvas",props:{images:{},viewMode:{},isLoading:{type:Boolean}},emits:["pageChange","goTranslate"],setup(p,{emit:r}){const c=p,v=r,w=k(()=>!c.isLoading&&c.images.length===0),o=k(()=>!c.isLoading&&c.images.length>0);function g(l){return c.viewMode==="translated"&&l.translated||l.original}function y(){const l=document.querySelectorAll(".reader-image-wrapper"),i=window.innerHeight/2;let u=1;l.forEach((h,T)=>{const $=h.getBoundingClientRect();$.top<i&&$.bottom>0&&(u=T+1)}),v("pageChange",u)}function m(){y()}function _(){v("goTranslate")}return V(()=>{window.addEventListener("scroll",m)}),O(()=>{window.removeEventListener("scroll",m)}),z(()=>c.images,()=>{setTimeout(y,100)},{deep:!0}),(l,i)=>(C(),f("main",X,[p.isLoading?(C(),f("div",Z,[...i[0]||(i[0]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"æ­£åœ¨åŠ è½½...",-1)])])):w.value?(C(),f("div",ee,[i[1]||(i[1]=e("div",{class:"empty-icon"},"ğŸ“–",-1)),i[2]||(i[2]=e("h2",null,"æš‚æ— å›¾ç‰‡",-1)),i[3]||(i[3]=e("p",null,"è¯¥ç« èŠ‚è¿˜æ²¡æœ‰å›¾ç‰‡ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹ç¿»è¯‘",-1)),e("button",{id:"goTranslateBtn",class:"btn btn-primary",onClick:_}," è¿›å…¥ç¿»è¯‘ ")])):o.value?(C(),f("div",te,[(C(!0),f(L,null,F(p.images,(u,h)=>(C(),f("div",{key:h,class:"reader-image-wrapper"},[e("img",{class:"reader-image",src:g(u),alt:`ç¬¬ ${h+1} é¡µ`,loading:"lazy"},null,8,ae),e("div",ne,I(h+1)+" / "+I(p.images.length),1)]))),128))])):H("",!0)]))}}),se=W(oe,[["__scopeId","data-v-8201cb7c"]]),le={key:0,id:"chapterNav",class:"chapter-nav"},ie=["disabled"],re=["disabled"],de={class:"settings-content"},ce={class:"settings-body"},ue={class:"setting-item"},ge={class:"setting-control"},pe=["value"],ve={id:"imageWidthValue"},me={class:"setting-item"},he={class:"setting-control"},be=["value"],fe={id:"imageGapValue"},Ce={class:"setting-item"},we={class:"setting-control bg-options"},ke=["data-bg","title","onClick"],A="readerSettings",ye=G({__name:"ReaderControls",props:{currentPage:{},totalPages:{},hasPrevChapter:{type:Boolean},hasNextChapter:{type:Boolean},showChapterNav:{type:Boolean}},emits:["navigateChapter","settingsChange"],setup(p,{expose:r,emit:c}){const v=p,w=c,o=b({imageWidth:100,imageGap:8,bgColor:"#1a1a2e"}),g=b(!1),y=b(!1),m=[{color:"#1a1a2e",name:"æ·±è“"},{color:"#ffffff",name:"ç™½è‰²"},{color:"#f5f5dc",name:"ç±³è‰²"},{color:"#2d2d2d",name:"æ·±ç°"}];k(()=>v.totalPages===0?"- / -":`${v.currentPage} / ${v.totalPages}`);function _(){g.value=!0}function l(){g.value=!1}function i(){window.scrollTo({top:0,behavior:"smooth"})}function u(){const s=window.scrollY;y.value=s>500}function h(s){switch(s.key){case"Escape":l();break;case"ArrowLeft":v.hasPrevChapter&&w("navigateChapter","prev");break;case"ArrowRight":v.hasNextChapter&&w("navigateChapter","next");break;case"Home":window.scrollTo({top:0,behavior:"smooth"});break;case"End":window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"});break}}function T(){const s=localStorage.getItem(A);if(s)try{const t=JSON.parse(s);o.value={...o.value,...t}}catch(t){console.error("åŠ è½½é˜…è¯»è®¾ç½®å¤±è´¥:",t)}S()}function $(){localStorage.setItem(A,JSON.stringify(o.value))}function S(){document.documentElement.style.setProperty("--reader-bg-color",o.value.bgColor),document.documentElement.style.setProperty("--reader-image-width",`${o.value.imageWidth}%`),document.documentElement.style.setProperty("--reader-gap",`${o.value.imageGap}px`),w("settingsChange",o.value)}function x(s){o.value.imageWidth=s,S(),$()}function E(s){o.value.imageGap=s,S(),$()}function R(s){o.value.bgColor=s,S(),$()}function P(s){w("navigateChapter",s)}return V(()=>{T(),window.addEventListener("scroll",u),document.addEventListener("keydown",h)}),O(()=>{window.removeEventListener("scroll",u),document.removeEventListener("keydown",h),document.documentElement.style.removeProperty("--reader-bg-color"),document.documentElement.style.removeProperty("--reader-image-width"),document.documentElement.style.removeProperty("--reader-gap")}),r({openSettings:_,closeSettings:l,settings:o}),(s,t)=>(C(),f(L,null,[p.showChapterNav?(C(),f("nav",le,[e("button",{id:"prevChapterBtn",class:"nav-btn",disabled:!p.hasPrevChapter,onClick:t[0]||(t[0]=d=>P("prev"))},[...t[4]||(t[4]=[e("span",{class:"nav-icon"},"â—€",-1),e("span",{class:"nav-text"},"ä¸Šä¸€ç« ",-1)])],8,ie),e("button",{id:"nextChapterBtn",class:"nav-btn",disabled:!p.hasNextChapter,onClick:t[1]||(t[1]=d=>P("next"))},[...t[5]||(t[5]=[e("span",{class:"nav-text"},"ä¸‹ä¸€ç« ",-1),e("span",{class:"nav-icon"},"â–¶",-1)])],8,re)])):H("",!0),J(e("button",{id:"scrollTopBtn",class:"scroll-top-btn",title:"å›åˆ°é¡¶éƒ¨",onClick:i},[...t[6]||(t[6]=[e("span",null,"â†‘",-1)])],512),[[K,y.value]]),e("div",{id:"settingsPanel",class:N(["settings-panel",{active:g.value}])},[e("div",{class:"settings-overlay",onClick:l}),e("div",de,[e("div",{class:"settings-header"},[t[7]||(t[7]=e("h3",null,"é˜…è¯»è®¾ç½®",-1)),e("button",{class:"close-btn",onClick:l},"Ã—")]),e("div",ce,[e("div",ue,[t[8]||(t[8]=e("label",null,"å›¾ç‰‡å®½åº¦",-1)),e("div",ge,[e("input",{type:"range",id:"imageWidthSlider",min:"50",max:"100",value:o.value.imageWidth,onInput:t[2]||(t[2]=d=>x(Number(d.target.value)))},null,40,pe),e("span",ve,I(o.value.imageWidth)+"%",1)])]),e("div",me,[t[9]||(t[9]=e("label",null,"å›¾ç‰‡é—´è·",-1)),e("div",he,[e("input",{type:"range",id:"imageGapSlider",min:"0",max:"50",value:o.value.imageGap,onInput:t[3]||(t[3]=d=>E(Number(d.target.value)))},null,40,be),e("span",fe,I(o.value.imageGap)+"px",1)])]),e("div",Ce,[t[10]||(t[10]=e("label",null,"èƒŒæ™¯é¢œè‰²",-1)),e("div",we,[(C(),f(L,null,F(m,d=>e("button",{key:d.color,class:N(["bg-option",{active:o.value.bgColor===d.color}]),"data-bg":d.color,style:Y({background:d.color}),title:d.name,onClick:D=>R(d.color)},null,14,ke)),64))])])])])],2)],64))}}),_e=W(ye,[["__scopeId","data-v-8b2d70af"]]),$e={class:"reader-page"},Ie={class:"reader-header"},Se={class:"header-left"},Te={class:"book-info"},xe={id:"bookTitle",class:"book-title"},Ee={id:"chapterTitle",class:"chapter-title"},Pe={class:"header-center"},Be={id:"pageInfo",class:"page-info"},Ne={class:"header-right"},Re={class:"view-mode-toggle"},Le=G({__name:"ReaderView",props:{bookId:{},chapterId:{}},setup(p){const r=p,c=j(),v=Q(),w=b(null),o=b(null),g=b([]),y=k(()=>g.value.find(a=>a.id===r.chapterId)),m=b([]),_=b(!0),l=b("translated"),i=b(1),u=k(()=>g.value.findIndex(a=>a.id===r.chapterId)),h=k(()=>u.value>0),T=k(()=>u.value>=0&&u.value<g.value.length-1),$=k(()=>{const a=y.value?.title||"é˜…è¯»",n=o.value?.title||"Saber-Translator";return`${a} - ${n}`}),S=k(()=>!_.value&&m.value.length>0);async function x(){_.value=!0;try{const[a,n]=await Promise.all([q(r.bookId),U(r.bookId,r.chapterId)]);if(a.success&&a.book)o.value=a.book,g.value=a.book.chapters||[];else throw new Error(a.error||"è·å–ä¹¦ç±ä¿¡æ¯å¤±è´¥");if(n.success&&n.images)m.value=n.images;else throw new Error(n.error||"è·å–ç« èŠ‚å›¾ç‰‡å¤±è´¥");document.title=$.value}catch(a){console.error("åŠ è½½æ•°æ®å¤±è´¥:",a),v.error("åŠ è½½å¤±è´¥: "+(a instanceof Error?a.message:"æœªçŸ¥é”™è¯¯")),setTimeout(()=>c.push("/"),2e3)}finally{_.value=!1}}function E(a){l.value=a}function R(a){const n=a==="prev"?u.value-1:u.value+1;if(n>=0&&n<g.value.length){const B=g.value[n];B&&c.push(`/reader?book=${r.bookId}&chapter=${B.id}`)}}function P(){c.push("/")}function s(){c.push(`/translate?book=${r.bookId}&chapter=${r.chapterId}`)}function t(){w.value?.openSettings()}function d(a){i.value=a}function D(a){}return V(()=>{x()}),z(()=>[r.bookId,r.chapterId],()=>{x(),window.scrollTo({top:0})}),(a,n)=>(C(),f("div",$e,[e("header",Ie,[e("div",Se,[e("button",{id:"backBtn",class:"header-btn",title:"è¿”å›ä¹¦æ¶",onClick:P},[...n[2]||(n[2]=[e("span",{class:"btn-icon"},"â†",-1),e("span",{class:"btn-text"},"è¿”å›",-1)])]),e("div",Te,[e("span",xe,I(o.value?.title||"åŠ è½½ä¸­..."),1),n[3]||(n[3]=e("span",{class:"separator"},"Â·",-1)),e("span",Ee,I(y.value?.title||"-"),1)])]),e("div",Pe,[e("span",Be,I(i.value)+" / "+I(m.value.length||"-"),1)]),e("div",Ne,[e("div",Re,[e("button",{id:"viewOriginalBtn",class:N(["mode-btn",{active:l.value==="original"}]),"data-mode":"original",title:"æŸ¥çœ‹åŸå›¾",onClick:n[0]||(n[0]=B=>E("original"))}," åŸå›¾ ",2),e("button",{id:"viewTranslatedBtn",class:N(["mode-btn",{active:l.value==="translated"}]),"data-mode":"translated",title:"æŸ¥çœ‹ç¿»è¯‘",onClick:n[1]||(n[1]=B=>E("translated"))}," ç¿»è¯‘ ",2)]),e("button",{id:"settingsBtn",class:"header-btn",title:"é˜…è¯»è®¾ç½®",onClick:t},[...n[4]||(n[4]=[e("span",{class:"btn-icon"},"âš™ï¸",-1)])]),e("button",{id:"translateBtn",class:"header-btn primary",title:"è¿›å…¥ç¿»è¯‘é¡µé¢",onClick:s},[...n[5]||(n[5]=[e("span",{class:"btn-icon"},"âœï¸",-1),e("span",{class:"btn-text"},"ç¿»è¯‘",-1)])])])]),M(se,{images:m.value,"view-mode":l.value,"is-loading":_.value,onPageChange:d,onGoTranslate:s},null,8,["images","view-mode","is-loading"]),M(_e,{ref_key:"readerControlsRef",ref:w,"current-page":i.value,"total-pages":m.value.length,"has-prev-chapter":h.value,"has-next-chapter":T.value,"show-chapter-nav":S.value,onNavigateChapter:R,onSettingsChange:D},null,8,["current-page","total-pages","has-prev-chapter","has-next-chapter","show-chapter-nav"])]))}}),Ae=W(Le,[["__scopeId","data-v-143aa2e8"]]);export{Ae as default};
