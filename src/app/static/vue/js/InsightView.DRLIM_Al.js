import{d as Qs,r as h,c as N,a as ge,e as p,l as ie,k as d,w as Be,f as e,h as M,g as rt,n as Z,t as $,i as ws,D as pe,v as K,z as G,o as qe,F as W,j as te,u as ae,p as fe,K as it,B as ps,L as Hs,m as Pt,x as _e,M as Js,b as Zs,C as Ws,y as Xs}from"./vue-vendor.DwHUB8Dr.js";import{u as xs,_ as Ys}from"./bookshelfStore.DCAN6Zs_.js";import{_ as xe}from"./CustomSelect.vue_vue_type_style_index_0_lang.CZ495rEt.js";import{_ as Se,s as en}from"./index.BDlD_Y71.js";import{apiClient as H}from"./client.Bht704G-.js";import{B as tn}from"./BaseModal.CncnZcl-.js";import{fetchModels as ht}from"./config.CwRcCkM9.js";import"./bookshelf.B4ums9uK.js";import"./utils-vendor.B9ygI19o.js";async function sn(l,t){return H.post(`/api/manga-insight/${l}/analyze/start`,t,{timeout:0})}async function nn(l,t){return H.post(`/api/manga-insight/${l}/analyze/pause`,{task_id:t})}async function an(l,t){return H.post(`/api/manga-insight/${l}/analyze/resume`,{task_id:t})}async function ln(l,t){return H.post(`/api/manga-insight/${l}/analyze/cancel`,{task_id:t})}async function Cs(l){return H.get(`/api/manga-insight/${l}/analyze/status`)}async function on(l,t){return H.post(`/api/manga-insight/${l}/reanalyze/page/${t}`,{},{timeout:0})}async function rn(l,t){return H.get(`/api/manga-insight/${l}/pages/${t}`)}function un(l,t){return`/api/manga-insight/${l}/page-image/${t}`}function Ss(l,t){return`/api/manga-insight/${l}/thumbnail/${t}`}async function cn(l){return H.get(`/api/manga-insight/${l}/chapters`)}async function dn(l,t){return t?H.get(`/api/manga-insight/${l}/overview/${t}`):H.get(`/api/manga-insight/${l}/overview`)}async function pn(l,t,n=!1){return H.post(`/api/manga-insight/${l}/overview/generate`,{template:t,force:n},{timeout:0})}async function vn(l){return H.get(`/api/manga-insight/${l}/overview/templates`)}async function mn(l){return H.get(`/api/manga-insight/${l}/timeline`)}async function gn(l){return H.post(`/api/manga-insight/${l}/regenerate/timeline`,{},{timeout:0})}async function fn(l,t,n){return H.post(`/api/manga-insight/${l}/chat`,{question:t,...n},{timeout:0})}async function hn(l){return H.post(`/api/manga-insight/${l}/rebuild-embeddings`,{},{timeout:0})}async function bn(){return H.get("/api/manga-insight/config")}async function kn(l){return H.post("/api/manga-insight/config",l)}async function yn(l){return H.post("/api/manga-insight/config/test/vlm",l)}async function _n(l){return H.post("/api/manga-insight/config/test/embedding",l)}async function $n(l){return H.post("/api/manga-insight/config/test/reranker",l)}async function wn(l){return H.post("/api/manga-insight/config/test/llm",l)}const vs={batch_analysis:{label:"ðŸ“„ æ‰¹é‡åˆ†æžæç¤ºè¯",hint:"ç”¨äºŽæ‰¹é‡åˆ†æžå¤šä¸ªé¡µé¢ã€‚æ”¯æŒå˜é‡ï¼š{page_count}, {start_page}, {end_page}"},segment_summary:{label:"ðŸ“‘ æ®µè½æ€»ç»“æç¤ºè¯",hint:"ç”¨äºŽæ±‡æ€»å¤šä¸ªæ‰¹æ¬¡çš„åˆ†æžç»“æžœç”Ÿæˆæ®µè½æ€»ç»“ã€‚"},chapter_summary:{label:"ðŸ“– ç« èŠ‚æ€»ç»“æç¤ºè¯",hint:"ç”¨äºŽç”Ÿæˆç« èŠ‚çº§åˆ«çš„å®Œæ•´æ€»ç»“ã€‚"},qa_response:{label:"ðŸ’¬ é—®ç­”å“åº”æç¤ºè¯",hint:"ç”¨äºŽå›žç­”ç”¨æˆ·å…³äºŽæ¼«ç”»å†…å®¹çš„é—®é¢˜ã€‚"}};async function xn(){return H.get("/api/manga-insight/prompts/defaults")}async function Cn(){return H.get("/api/manga-insight/prompts/library")}async function Sn(l){return H.post("/api/manga-insight/prompts/library",l)}async function Pn(l){return H.delete(`/api/manga-insight/prompts/library/${l}`)}async function In(l){return H.post("/api/manga-insight/prompts/library/import",{library:l})}async function Ps(l){return H.get(`/api/manga-insight/${l}/export`)}const ms="insight_provider_configs",he=Qs("insight",()=>{const l=h(null),t=h(null),n=h("idle"),a=h({current:0,total:0,status:"idle"}),s=h(0),i=h(0),u=h("full"),b=h(!0),m=h([]),f=h(new Map),k=h(null),P=h([]),R=h([]),U=h([]),E=h([]),D=h(null),F=h("all"),q=h(!1),j=h(!1),B=h(null),x=h(0),o=h({vlm:{provider:"gemini",apiKey:"",model:"gemini-2.0-flash",baseUrl:"",rpmLimit:10,temperature:.3,forceJson:!1,useStream:!0,imageMaxSize:0},llm:{useSameAsVlm:!0,provider:"gemini",apiKey:"",model:"gemini-2.0-flash",baseUrl:"",useStream:!0},embedding:{provider:"openai",apiKey:"",model:"text-embedding-3-small",baseUrl:"",rpmLimit:0},reranker:{provider:"jina",apiKey:"",model:"jina-reranker-v2-base-multilingual",baseUrl:"",topK:5},imageGen:{provider:"siliconflow",apiKey:"",model:"stabilityai/stable-diffusion-3-5-large",baseUrl:"",maxRetries:3},batch:{pagesPerBatch:5,contextBatchCount:1,architecturePreset:"standard",customLayers:[]},prompts:{}}),r=h({vlm:{},llm:{},embedding:{},reranker:{}}),g=N(()=>a.value.total===0?0:Math.round(a.value.current/a.value.total*100)),S=N(()=>n.value==="running"),T=N(()=>n.value==="completed"),C=N(()=>{if(i.value>0)return i.value;let _=0;return f.value.forEach(A=>{A.analyzed&&_++}),_}),V=N(()=>s.value||f.value.size),se=N(()=>F.value==="all"?E.value:E.value.filter(_=>_.type===F.value)),Q=N(()=>D.value===null?null:f.value.get(D.value)||null);function I(_){l.value=_,_?(console.log(`å½“å‰åˆ†æžä¹¦ç±: ${_}`),console.log("å‡†å¤‡åŠ è½½ç¬”è®°..."),_t()):E.value=[]}function w(_){n.value=_,a.value.status=_,console.log(`åˆ†æžçŠ¶æ€: ${_}`)}function z(_){t.value=_}function ne(_,A,Y){a.value={current:_,total:A,status:n.value,message:Y}}function ce(_){u.value=_}function be(_){b.value=_}function Ce(_){s.value=_,console.log(`ä¹¦ç±æ€»é¡µæ•°: ${_}`)}function Me(_){i.value=_,console.log(`å·²åˆ†æžé¡µæ•°: ${_}`)}function Fe(_){m.value=_,console.log(`ç« èŠ‚åˆ—è¡¨å·²è®¾ç½®ï¼Œå…± ${_.length} ç« `)}function Le(_,A){f.value.set(_,A)}function Ee(_){f.value.clear();for(const A of _)f.value.set(A.pageNum,A);console.log(`é¡µé¢æ•°æ®å·²è®¾ç½®ï¼Œå…± ${_.length} é¡µ`)}function Ue(_){D.value=_}function Ne(_){k.value=_,_&&!P.value.includes(_.type)&&P.value.push(_.type)}function et(_){P.value=_}function ke(_){R.value=_,console.log(`æ—¶é—´çº¿å·²è®¾ç½®ï¼Œå…± ${_.length} ä¸ªäº‹ä»¶`)}function je(_){U.value.push(_)}function X(_){const A=U.value[U.value.length-1];A&&A.role==="assistant"&&(A.content=_)}function tt(){U.value=[]}function De(){U.value=U.value.filter(_=>!_.isLoading)}function st(_){j.value=_}function Ge(_){D.value=_}async function Qe(_){if(await Bt(_))E.value.unshift(_),console.log(`å·²æ·»åŠ ç¬”è®°: ${_.id}`);else throw new Error("ä¿å­˜ç¬”è®°åˆ°åŽç«¯å¤±è´¥")}async function He(_,A){const Y=E.value.find(we=>we.id===_);Y&&(Object.assign(Y,A,{updatedAt:new Date().toISOString()}),await Mt(_,A),console.log(`å·²æ›´æ–°ç¬”è®°: ${_}`))}async function Je(_){const A=E.value.findIndex(Y=>Y.id===_);A>=0&&(await $t(_)?(E.value.splice(A,1),console.log(`å·²åˆ é™¤ç¬”è®°: ${_}`)):console.error(`åˆ é™¤ç¬”è®°å¤±è´¥: ${_}`))}function yt(_){F.value=_}async function _t(){if(console.log("loadNotesFromAPI è¢«è°ƒç”¨, bookId:",l.value),!!l.value)try{const A=await(await fetch(`/api/manga-insight/${l.value}/notes`)).json();console.log("ç¬”è®°APIå“åº”:",A),A.success&&A.notes?(E.value=A.notes,console.log(`å·²ä»ŽAPIåŠ è½½ ${E.value.length} æ¡ç¬”è®°`)):(console.log("APIè¿”å›žæ— ç¬”è®°æ•°æ®"),E.value=[])}catch(_){console.error("ä»ŽAPIåŠ è½½ç¬”è®°å¤±è´¥:",_),E.value=[]}}async function Bt(_){if(!l.value)return!1;try{return(await(await fetch(`/api/manga-insight/${l.value}/notes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(_)})).json()).success}catch(A){return console.error("ä¿å­˜ç¬”è®°åˆ°APIå¤±è´¥:",A),!1}}async function Mt(_,A){if(!l.value)return!1;try{return(await(await fetch(`/api/manga-insight/${l.value}/notes/${_}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(A)})).json()).success}catch(Y){return console.error("æ›´æ–°ç¬”è®°åˆ°APIå¤±è´¥:",Y),!1}}async function $t(_){if(!l.value)return!1;try{return(await(await fetch(`/api/manga-insight/${l.value}/notes/${_}`,{method:"DELETE"})).json()).success}catch(A){return console.error("ä»ŽAPIåˆ é™¤ç¬”è®°å¤±è´¥:",A),!1}}function O(){x.value=Date.now(),console.log("è§¦å‘æ•°æ®åˆ·æ–°ï¼Œkey:",x.value)}function Pe(_){q.value=_}function ut(_){B.value=_}function Lt(_){o.value.vlm={...o.value.vlm,..._},Ve(o.value.vlm.provider),me()}function nt(_){o.value.llm={...o.value.llm,..._},ct(o.value.llm.provider),me()}function Et(_){o.value.embedding={...o.value.embedding,..._},dt(o.value.embedding.provider),me()}function zt(_){o.value.reranker={...o.value.reranker,..._},pt(o.value.reranker.provider),me()}function at(_){o.value.imageGen={...o.value.imageGen,..._},me()}function Dt(_){o.value.batch={...o.value.batch,..._},me()}function Vt(_){o.value.prompts={...o.value.prompts,..._},me()}function Ot(_){const A=o.value.vlm.provider;A!==_&&(Ve(A),o.value.vlm.provider=_,Ft(_),me(),console.log(`[Insight] VLM æœåŠ¡å•†å·²åˆ‡æ¢ä¸º: ${_}`))}function de(_){const A=o.value.llm.provider;A!==_&&(ct(A),o.value.llm.provider=_,Nt(_),me(),console.log(`[Insight] LLM æœåŠ¡å•†å·²åˆ‡æ¢ä¸º: ${_}`))}function Kt(_){const A=o.value.embedding.provider;A!==_&&(dt(A),o.value.embedding.provider=_,jt(_),me(),console.log(`[Insight] Embedding æœåŠ¡å•†å·²åˆ‡æ¢ä¸º: ${_}`))}function lt(_){const A=o.value.reranker.provider;A!==_&&(pt(A),o.value.reranker.provider=_,Gt(_),me(),console.log(`[Insight] Reranker æœåŠ¡å•†å·²åˆ‡æ¢ä¸º: ${_}`))}function Ze(){localStorage.setItem(ms,JSON.stringify(r.value))}function qt(){const _=localStorage.getItem(ms);if(_)try{const A=JSON.parse(_);r.value={vlm:A.vlm||{},llm:A.llm||{},embedding:A.embedding||{},reranker:A.reranker||{}},console.log("[Insight] å·²åŠ è½½æœåŠ¡å•†é…ç½®ç¼“å­˜")}catch(A){console.error("[Insight] åŠ è½½æœåŠ¡å•†é…ç½®ç¼“å­˜å¤±è´¥:",A)}}function Ve(_){_&&(r.value.vlm[_]={apiKey:o.value.vlm.apiKey,model:o.value.vlm.model,baseUrl:o.value.vlm.baseUrl,rpmLimit:o.value.vlm.rpmLimit,temperature:o.value.vlm.temperature,forceJson:o.value.vlm.forceJson,useStream:o.value.vlm.useStream,imageMaxSize:o.value.vlm.imageMaxSize},Ze(),console.log(`[Insight] ä¿å­˜ VLM æœåŠ¡å•†é…ç½®: ${_}`))}function Ft(_){if(!_)return;const A=r.value.vlm[_];A?(A.apiKey!==void 0&&(o.value.vlm.apiKey=A.apiKey),A.model!==void 0&&(o.value.vlm.model=A.model),A.baseUrl!==void 0&&(o.value.vlm.baseUrl=A.baseUrl),A.rpmLimit!==void 0&&(o.value.vlm.rpmLimit=A.rpmLimit),A.temperature!==void 0&&(o.value.vlm.temperature=A.temperature),A.forceJson!==void 0&&(o.value.vlm.forceJson=A.forceJson),A.useStream!==void 0&&(o.value.vlm.useStream=A.useStream),A.imageMaxSize!==void 0&&(o.value.vlm.imageMaxSize=A.imageMaxSize),console.log(`[Insight] æ¢å¤ VLM æœåŠ¡å•†é…ç½®: ${_}`)):(o.value.vlm.apiKey="",o.value.vlm.model="",o.value.vlm.baseUrl="",console.log(`[Insight] ${_} æ— ç¼“å­˜é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼`))}function ct(_){_&&(r.value.llm[_]={apiKey:o.value.llm.apiKey,model:o.value.llm.model,baseUrl:o.value.llm.baseUrl,useStream:o.value.llm.useStream},Ze(),console.log(`[Insight] ä¿å­˜ LLM æœåŠ¡å•†é…ç½®: ${_}`))}function Nt(_){if(!_)return;const A=r.value.llm[_];A?(A.apiKey!==void 0&&(o.value.llm.apiKey=A.apiKey),A.model!==void 0&&(o.value.llm.model=A.model),A.baseUrl!==void 0&&(o.value.llm.baseUrl=A.baseUrl),A.useStream!==void 0&&(o.value.llm.useStream=A.useStream),console.log(`[Insight] æ¢å¤ LLM æœåŠ¡å•†é…ç½®: ${_}`)):(o.value.llm.apiKey="",o.value.llm.model="",o.value.llm.baseUrl="",console.log(`[Insight] ${_} æ— ç¼“å­˜é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼`))}function dt(_){_&&(r.value.embedding[_]={apiKey:o.value.embedding.apiKey,model:o.value.embedding.model,baseUrl:o.value.embedding.baseUrl,rpmLimit:o.value.embedding.rpmLimit},Ze(),console.log(`[Insight] ä¿å­˜ Embedding æœåŠ¡å•†é…ç½®: ${_}`))}function jt(_){if(!_)return;const A=r.value.embedding[_];A?(A.apiKey!==void 0&&(o.value.embedding.apiKey=A.apiKey),A.model!==void 0&&(o.value.embedding.model=A.model),A.baseUrl!==void 0&&(o.value.embedding.baseUrl=A.baseUrl),A.rpmLimit!==void 0&&(o.value.embedding.rpmLimit=A.rpmLimit),console.log(`[Insight] æ¢å¤ Embedding æœåŠ¡å•†é…ç½®: ${_}`)):(o.value.embedding.apiKey="",o.value.embedding.model="",o.value.embedding.baseUrl="",console.log(`[Insight] ${_} æ— ç¼“å­˜é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼`))}function pt(_){_&&(r.value.reranker[_]={apiKey:o.value.reranker.apiKey,model:o.value.reranker.model,baseUrl:o.value.reranker.baseUrl,topK:o.value.reranker.topK},Ze(),console.log(`[Insight] ä¿å­˜ Reranker æœåŠ¡å•†é…ç½®: ${_}`))}function Gt(_){if(!_)return;const A=r.value.reranker[_];A?(A.apiKey!==void 0&&(o.value.reranker.apiKey=A.apiKey),A.model!==void 0&&(o.value.reranker.model=A.model),A.baseUrl!==void 0&&(o.value.reranker.baseUrl=A.baseUrl),A.topK!==void 0&&(o.value.reranker.topK=A.topK),console.log(`[Insight] æ¢å¤ Reranker æœåŠ¡å•†é…ç½®: ${_}`)):(o.value.reranker.apiKey="",o.value.reranker.model="",o.value.reranker.baseUrl="",console.log(`[Insight] ${_} æ— ç¼“å­˜é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼`))}function Qt(_){o.value=_,me()}function me(){localStorage.setItem("manga_insight_config",JSON.stringify(o.value))}function Ht(){qt();const A=localStorage.getItem("manga_insight_config");if(A)try{const Y=JSON.parse(A);o.value={vlm:{...o.value.vlm,...Y.vlm},llm:{...o.value.llm,...Y.llm},embedding:{...o.value.embedding,...Y.embedding},reranker:{...o.value.reranker,...Y.reranker},imageGen:{...o.value.imageGen,...Y.imageGen},batch:{...o.value.batch,...Y.batch},prompts:Y.prompts||{}},console.log("å·²åŠ è½½æ¼«ç”»åˆ†æžé…ç½®")}catch(Y){console.error("åŠ è½½æ¼«ç”»åˆ†æžé…ç½®å¤±è´¥:",Y)}}function Jt(){return{vlm:{provider:o.value.vlm.provider,api_key:o.value.vlm.apiKey,model:o.value.vlm.model,base_url:o.value.vlm.baseUrl||null,rpm_limit:o.value.vlm.rpmLimit,temperature:o.value.vlm.temperature,force_json:o.value.vlm.forceJson,use_stream:o.value.vlm.useStream,image_max_size:o.value.vlm.imageMaxSize},chat_llm:{use_same_as_vlm:o.value.llm.useSameAsVlm,provider:o.value.llm.provider,api_key:o.value.llm.apiKey,model:o.value.llm.model,base_url:o.value.llm.baseUrl||null,use_stream:o.value.llm.useStream},embedding:{provider:o.value.embedding.provider,api_key:o.value.embedding.apiKey,model:o.value.embedding.model,base_url:o.value.embedding.baseUrl||null,rpm_limit:o.value.embedding.rpmLimit},reranker:{provider:o.value.reranker.provider,api_key:o.value.reranker.apiKey,model:o.value.reranker.model,base_url:o.value.reranker.baseUrl||null,top_k:o.value.reranker.topK},image_gen:{provider:o.value.imageGen.provider,api_key:o.value.imageGen.apiKey,model:o.value.imageGen.model,base_url:o.value.imageGen.baseUrl||null,max_retries:o.value.imageGen.maxRetries},analysis:{batch:{pages_per_batch:o.value.batch.pagesPerBatch,context_batch_count:o.value.batch.contextBatchCount,architecture_preset:o.value.batch.architecturePreset,custom_layers:o.value.batch.customLayers.map(_=>({name:_.name,units_per_group:_.units,align_to_chapter:_.align}))}},prompts:o.value.prompts,providerSettings:Zt()}}function Zt(){const _={},A={},Y={},we={};for(const[ye,ue]of Object.entries(r.value.vlm))_[ye]={api_key:ue.apiKey||"",model:ue.model||"",base_url:ue.baseUrl||"",rpm_limit:ue.rpmLimit??10,temperature:ue.temperature??.3,force_json:ue.forceJson??!1,use_stream:ue.useStream??!0,image_max_size:ue.imageMaxSize??0};for(const[ye,ue]of Object.entries(r.value.llm))A[ye]={api_key:ue.apiKey||"",model:ue.model||"",base_url:ue.baseUrl||"",use_stream:ue.useStream??!0};for(const[ye,ue]of Object.entries(r.value.embedding))Y[ye]={api_key:ue.apiKey||"",model:ue.model||"",base_url:ue.baseUrl||"",rpm_limit:ue.rpmLimit??0};for(const[ye,ue]of Object.entries(r.value.reranker))we[ye]={api_key:ue.apiKey||"",model:ue.model||"",base_url:ue.baseUrl||"",top_k:ue.topK??5};return{vlmProvider:_,llmProvider:A,embeddingProvider:Y,rerankerProvider:we}}function Wt(_){const A=_.vlm,Y=_.chat_llm,we=_.embedding,ye=_.reranker,We=_.analysis?.batch;if(A&&(o.value.vlm={provider:A.provider||"gemini",apiKey:A.api_key||"",model:A.model||"",baseUrl:A.base_url||"",rpmLimit:A.rpm_limit||10,temperature:A.temperature||.3,forceJson:A.force_json||!1,useStream:A.use_stream!==!1,imageMaxSize:A.image_max_size||0}),Y&&(o.value.llm={useSameAsVlm:Y.use_same_as_vlm!==!1,provider:Y.provider||o.value.vlm.provider,apiKey:Y.api_key||o.value.vlm.apiKey,model:Y.model||o.value.vlm.model,baseUrl:Y.base_url||o.value.vlm.baseUrl,useStream:Y.use_stream!==!1}),we&&(o.value.embedding={provider:we.provider||"openai",apiKey:we.api_key||"",model:we.model||"",baseUrl:we.base_url||"",rpmLimit:we.rpm_limit??0}),ye&&(o.value.reranker={provider:ye.provider||"jina",apiKey:ye.api_key||"",model:ye.model||"",baseUrl:ye.base_url||"",topK:ye.top_k||5}),We){const Re=We.custom_layers;o.value.batch={pagesPerBatch:We.pages_per_batch||5,contextBatchCount:We.context_batch_count??1,architecturePreset:We.architecture_preset||"standard",customLayers:Re?.map(re=>({name:re.name||"",units:re.units_per_group||1,align:re.align_to_chapter||!1}))||[]}}const Oe=_.image_gen;Oe&&(o.value.imageGen={provider:Oe.provider||"siliconflow",apiKey:Oe.api_key||"",model:Oe.model||"stabilityai/stable-diffusion-3-5-large",baseUrl:Oe.base_url||"",maxRetries:Oe.max_retries||3});const Ie=_.providerSettings;if(Ie){if(Ie.vlmProvider)for(const[Re,re]of Object.entries(Ie.vlmProvider))r.value.vlm[Re]={apiKey:re.api_key||"",model:re.model||"",baseUrl:re.base_url||"",rpmLimit:re.rpm_limit??10,temperature:re.temperature??.3,forceJson:re.force_json??!1,useStream:re.use_stream??!0,imageMaxSize:re.image_max_size??0};if(Ie.llmProvider)for(const[Re,re]of Object.entries(Ie.llmProvider))r.value.llm[Re]={apiKey:re.api_key||"",model:re.model||"",baseUrl:re.base_url||"",useStream:re.use_stream??!0};if(Ie.embeddingProvider)for(const[Re,re]of Object.entries(Ie.embeddingProvider))r.value.embedding[Re]={apiKey:re.api_key||"",model:re.model||"",baseUrl:re.base_url||"",rpmLimit:re.rpm_limit??0};if(Ie.rerankerProvider)for(const[Re,re]of Object.entries(Ie.rerankerProvider))r.value.reranker[Re]={apiKey:re.api_key||"",model:re.model||"",baseUrl:re.base_url||"",topK:re.top_k??5};console.log("[Insight] å·²ä»ŽåŽç«¯æ¢å¤æœåŠ¡å•†é…ç½®ç¼“å­˜"),Ze()}const Ke=_.prompts;Ke&&(o.value.prompts=Ke),me(),Ve(o.value.vlm.provider),ct(o.value.llm.provider),dt(o.value.embedding.provider),pt(o.value.reranker.provider),console.log("[Insight] å·²ä»Ž API åŠ è½½é…ç½®")}function Xt(){n.value="idle",a.value={current:0,total:0,status:"idle"},f.value.clear(),k.value=null,R.value=[],console.log("åˆ†æžçŠ¶æ€å·²é‡ç½®")}function wt(){l.value=null,n.value="idle",a.value={current:0,total:0,status:"idle"},u.value="full",b.value=!0,m.value=[],f.value.clear(),k.value=null,P.value=[],R.value=[],U.value=[],E.value=[],D.value=null,F.value="all",q.value=!1,j.value=!1,B.value=null,console.log("æ¼«ç”»åˆ†æžçŠ¶æ€å·²é‡ç½®")}return{currentBookId:l,currentTaskId:t,analysisStatus:n,progress:a,analysisMode:u,incrementalAnalysis:b,chapters:m,pages:f,overview:k,generatedTemplates:P,timeline:R,qaHistory:U,notes:E,selectedPageNum:D,noteTypeFilter:F,isLoading:q,isStreaming:j,error:B,config:o,progressPercent:g,isAnalyzing:S,isAnalysisCompleted:T,analyzedPageCount:C,totalPageCount:V,filteredNotes:se,selectedPage:Q,setCurrentBook:I,setCurrentTaskId:z,setAnalysisStatus:w,updateProgress:ne,setAnalysisMode:ce,setIncrementalAnalysis:be,setBookTotalPages:Ce,setAnalyzedPagesCount:Me,setChapters:Fe,setPageData:Le,setPages:Ee,selectPage:Ue,setOverview:Ne,setGeneratedTemplates:et,setTimeline:ke,dataRefreshKey:x,triggerDataRefresh:O,addQAMessage:je,updateLastAssistantMessage:X,clearQAHistory:tt,removeLoadingMessages:De,setStreaming:st,setCurrentPage:Ge,addNote:Qe,updateNote:He,deleteNote:Je,setNoteTypeFilter:yt,loadNotesFromAPI:_t,setLoading:Pe,setError:ut,updateVlmConfig:Lt,updateLlmConfig:nt,updateEmbeddingConfig:Et,updateRerankerConfig:zt,updateImageGenConfig:at,updateBatchConfig:Dt,updatePrompts:Vt,setConfig:Qt,saveConfigToStorage:me,loadConfigFromStorage:Ht,getConfigForApi:Jt,setConfigFromApi:Wt,setVlmProvider:Ot,setLlmProvider:de,setEmbeddingProvider:Kt,setRerankerProvider:lt,resetAnalysis:Xt,reset:wt}}),Rn={class:"book-selector"},Tn=ge({__name:"BookSelector",emits:["select"],setup(l,{emit:t}){const n=t,a=xs(),s=N(()=>a.books),i=N(()=>{const m=[{label:"-- é€‰æ‹©ä¹¦ç± --",value:""}];return s.value.forEach(f=>{m.push({label:f.title||f.id,value:f.id})}),m}),u=h("");function b(m){const f=String(m);u.value=f,f&&n("select",f)}return(m,f)=>(d(),p("div",Rn,[ie(xe,{modelValue:u.value,"onUpdate:modelValue":f[0]||(f[0]=k=>u.value=k),options:i.value,onChange:b},null,8,["modelValue","options"])]))}}),An=Se(Tn,[["__scopeId","data-v-d6052909"]]),Un={class:"sidebar-section analysis-control-compact"},Bn={class:"analysis-status-bar"},Mn={class:"status-left"},Ln={class:"status-label"},En={class:"status-right"},zn={class:"status-progress"},Dn={key:1,class:"progress-message"},Vn={class:"analysis-btn-group"},On={key:0,class:"btn-group-idle"},Kn=["disabled"],qn={key:0,width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor"},Fn={key:1,class:"loading-spinner"},Nn={key:1,class:"btn-group-running"},jn={key:2,class:"btn-group-paused"},Gn={key:4,class:"page-input-wrapper"},Qn=["max"],Hn={class:"page-hint"},Jn={key:5,class:"mode-description"},Zn={key:6,class:"estimated-time"},Wn={class:"analysis-options-row"},Xn={class:"checkbox-compact",title:"ä»…åˆ†æžæœªåˆ†æžçš„é¡µé¢ï¼Œè·³è¿‡å·²åˆ†æžçš„é¡µé¢"},Yn=["checked"],ea=["disabled"],ta=ge({__name:"AnalysisProgress",emits:["start-polling","stop-polling"],setup(l,{emit:t}){const n=[{label:"å…¨ä¹¦",value:"full"},{label:"ç« èŠ‚",value:"chapter"},{label:"å•é¡µ",value:"page"}],a=N(()=>{const I=[{label:"é€‰æ‹©ç« èŠ‚...",value:""}];return i.chapters.forEach(w=>{I.push({label:`${w.title} (${w.startPage}-${w.endPage}é¡µ)`,value:w.id})}),I}),s=t,i=he(),u=h("full"),b=h(""),m=h(null),f=h(!1),k=h(""),P=N(()=>{const I=i.analysisStatus;return{"status-dot":!0,running:I==="running",paused:I==="paused",completed:I==="completed",failed:I==="failed"}}),R=N(()=>{switch(i.analysisStatus){case"running":return"åˆ†æžä¸­";case"paused":return"å·²æš‚åœ";case"completed":return"å·²å®Œæˆ";case"failed":return"åˆ†æžå¤±è´¥";default:return"æœªåˆ†æž"}}),U=N(()=>{const{current:I,total:w}=i.progress;return w===0?"":`${I}/${w}`}),E=N(()=>i.analysisStatus==="idle"||i.analysisStatus==="completed"),D=N(()=>i.analysisStatus==="running"),F=N(()=>i.analysisStatus==="paused"),q=N(()=>i.analysisStatus==="completed"?"é‡æ–°åˆ†æž":"å¼€å§‹åˆ†æž"),j=N(()=>u.value==="chapter"),B=N(()=>u.value==="page"),x=N(()=>!(f.value||i.isAnalyzing||u.value==="chapter"&&!b.value||u.value==="page"&&!m.value)),o=N(()=>{switch(u.value){case"full":return"åˆ†æžæ•´æœ¬ä¹¦çš„æ‰€æœ‰é¡µé¢";case"chapter":return"ä»…åˆ†æžé€‰ä¸­ç« èŠ‚çš„é¡µé¢";case"page":return"ä»…åˆ†æžæŒ‡å®šçš„å•ä¸ªé¡µé¢";default:return""}}),r=N(()=>{const I=i.totalPageCount;if(I===0)return"";const w=i.config.batch.pagesPerBatch||5,ne=Math.ceil(I/w)*10;return ne<60?`çº¦ ${ne} ç§’`:`çº¦ ${Math.ceil(ne/60)} åˆ†é’Ÿ`});function g(){i.setAnalysisMode(u.value)}async function S(){if(i.currentBookId){if(i.isAnalyzing||f.value){console.warn("åˆ†æžæ­£åœ¨è¿›è¡Œä¸­æˆ–æ­£åœ¨å¯åŠ¨");return}if(u.value==="chapter"&&!b.value){k.value="è¯·é€‰æ‹©è¦åˆ†æžçš„ç« èŠ‚";return}if(u.value==="page"&&!m.value){k.value="è¯·è¾“å…¥è¦åˆ†æžçš„é¡µç ";return}f.value=!0,k.value="";try{const I={};u.value==="chapter"&&b.value?(I.mode="chapters",I.chapters=[b.value]):u.value==="page"&&m.value?(I.mode="pages",I.pages=[m.value]):I.mode=i.incrementalAnalysis?"incremental":"full";const w=await sn(i.currentBookId,I);w.success?(w.task_id&&i.setCurrentTaskId(w.task_id),i.setAnalysisStatus("running"),s("start-polling")):(k.value=w.error||"å¯åŠ¨åˆ†æžå¤±è´¥",console.error("å¯åŠ¨åˆ†æžå¤±è´¥:",w.error))}catch(I){k.value=I instanceof Error?I.message:"å¯åŠ¨åˆ†æžå¤±è´¥",console.error("å¯åŠ¨åˆ†æžå¤±è´¥:",I)}finally{f.value=!1}}}async function T(){if(i.currentBookId)try{(await nn(i.currentBookId,i.currentTaskId||void 0)).success&&i.setAnalysisStatus("paused")}catch(I){console.error("æš‚åœåˆ†æžå¤±è´¥:",I)}}async function C(){if(i.currentBookId)try{(await an(i.currentBookId,i.currentTaskId||void 0)).success&&(i.setAnalysisStatus("running"),s("start-polling"))}catch(I){console.error("ç»§ç»­åˆ†æžå¤±è´¥:",I)}}async function V(){if(i.currentBookId&&confirm("ç¡®å®šè¦å–æ¶ˆåˆ†æžå—ï¼Ÿ"))try{(await ln(i.currentBookId,i.currentTaskId||void 0)).success&&(i.setAnalysisStatus("idle"),i.setCurrentTaskId(null),s("stop-polling"))}catch(I){console.error("å–æ¶ˆåˆ†æžå¤±è´¥:",I)}}async function se(){if(!i.currentBookId){k.value="è¯·å…ˆé€‰æ‹©ä¹¦ç±";return}try{const I=await Ps(i.currentBookId);if(I.success&&I.markdown){const w=new Blob([I.markdown],{type:"text/markdown"}),z=URL.createObjectURL(w),ne=document.createElement("a");ne.href=z,ne.download=`${i.currentBookId}_analysis.md`,ne.click(),URL.revokeObjectURL(z)}else k.value=I.error||"å¯¼å‡ºå¤±è´¥"}catch(I){k.value=I instanceof Error?I.message:"å¯¼å‡ºå¤±è´¥",console.error("å¯¼å‡ºå¤±è´¥:",I)}}function Q(){k.value=""}return Be(u,()=>{Q()}),(I,w)=>(d(),p("div",Un,[e("div",Bn,[e("div",Mn,[e("span",{class:Z(P.value)},null,2),e("span",Ln,$(R.value),1)]),e("div",En,[e("span",zn,$(U.value),1)])]),D.value||F.value?(d(),p("div",{key:0,class:Z(["progress-bar-slim",{paused:F.value}])},[e("div",{class:"progress-fill-slim",style:ws({width:pe(i).progressPercent+"%"})},null,4)],2)):M("",!0),pe(i).progress.message&&(D.value||F.value)?(d(),p("div",Dn,$(pe(i).progress.message),1)):M("",!0),k.value?(d(),p("div",{key:2,class:"error-message",onClick:Q}," âš ï¸ "+$(k.value),1)):M("",!0),e("div",Vn,[E.value?(d(),p("div",On,[ie(xe,{modelValue:u.value,"onUpdate:modelValue":w[0]||(w[0]=z=>u.value=z),options:n,onChange:g},null,8,["modelValue"]),e("button",{class:Z(["btn-analysis-start",{loading:f.value}]),disabled:!x.value,onClick:S},[f.value?M("",!0):(d(),p("svg",qn,[...w[4]||(w[4]=[e("path",{d:"M8 5v14l11-7z"},null,-1)])])),f.value?(d(),p("span",Fn)):M("",!0),e("span",null,$(f.value?"å¯åŠ¨ä¸­...":q.value),1)],10,Kn)])):M("",!0),D.value?(d(),p("div",Nn,[e("button",{class:"btn-control btn-pause",title:"æš‚åœåˆ†æž",onClick:T},[...w[5]||(w[5]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})],-1),e("span",{class:"btn-label"},"æš‚åœ",-1)])]),e("button",{class:"btn-control btn-cancel",title:"å–æ¶ˆåˆ†æž",onClick:V},[...w[6]||(w[6]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 6h12v12H6z"})],-1),e("span",{class:"btn-label"},"å–æ¶ˆ",-1)])])])):M("",!0),F.value?(d(),p("div",jn,[e("button",{class:"btn-control btn-resume",title:"ç»§ç»­åˆ†æž",onClick:C},[...w[7]||(w[7]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M8 5v14l11-7z"})],-1),e("span",{class:"btn-label"},"ç»§ç»­",-1)])]),e("button",{class:"btn-control btn-cancel",title:"å–æ¶ˆåˆ†æž",onClick:V},[...w[8]||(w[8]=[e("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M6 6h12v12H6z"})],-1),e("span",{class:"btn-label"},"å–æ¶ˆ",-1)])])])):M("",!0)]),j.value?(d(),rt(xe,{key:3,modelValue:b.value,"onUpdate:modelValue":w[1]||(w[1]=z=>b.value=z),options:a.value},null,8,["modelValue","options"])):M("",!0),B.value?(d(),p("div",Gn,[K(e("input",{"onUpdate:modelValue":w[2]||(w[2]=z=>m.value=z),type:"number",class:"form-input-compact",placeholder:"è¾“å…¥é¡µç ",min:"1",max:pe(i).totalPageCount||void 0},null,8,Qn),[[G,m.value,void 0,{number:!0}]]),e("span",Hn,"/ "+$(pe(i).totalPageCount||"?"),1)])):M("",!0),E.value&&o.value?(d(),p("div",Jn,$(o.value),1)):M("",!0),E.value&&u.value==="full"&&r.value?(d(),p("div",Zn," â±ï¸ "+$(r.value),1)):M("",!0),e("div",Wn,[e("label",Xn,[e("input",{type:"checkbox",checked:pe(i).incrementalAnalysis,onChange:w[3]||(w[3]=z=>pe(i).setIncrementalAnalysis(z.target.checked))},null,40,Yn),w[9]||(w[9]=e("span",null,"å¢žé‡æ¨¡å¼",-1))]),e("button",{class:"btn-icon-sm",title:"å¯¼å‡ºåˆ†æžæŠ¥å‘Š",disabled:pe(i).analyzedPageCount===0,onClick:se},[...w[10]||(w[10]=[e("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e("polyline",{points:"7 10 12 15 17 10"}),e("line",{x1:"12",y1:"15",x2:"12",y2:"3"})],-1)])],8,ea)])]))}}),sa=Se(ta,[["__scopeId","data-v-1421f4fe"]]);function ns(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Ye=ns();function Is(l){Ye=l}var ft={exec:()=>null};function le(l,t=""){let n=typeof l=="string"?l:l.source,a={replace:(s,i)=>{let u=typeof i=="string"?i:i.source;return u=u.replace($e.caret,"$1"),n=n.replace(s,u),a},getRegex:()=>new RegExp(n,t)};return a}var na=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),$e={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:l=>new RegExp(`^( {0,3}${l})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:l=>new RegExp(`^ {0,${Math.min(3,l-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:l=>new RegExp(`^ {0,${Math.min(3,l-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:l=>new RegExp(`^ {0,${Math.min(3,l-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:l=>new RegExp(`^ {0,${Math.min(3,l-1)}}#`),htmlBeginRegex:l=>new RegExp(`^ {0,${Math.min(3,l-1)}}<(?:[a-z].*>|!--)`,"i")},aa=/^(?:[ \t]*(?:\n|$))+/,la=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,oa=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,bt=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,ra=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,as=/(?:[*+-]|\d{1,9}[.)])/,Rs=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Ts=le(Rs).replace(/bull/g,as).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),ia=le(Rs).replace(/bull/g,as).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),ls=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,ua=/^[^\n]+/,os=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,ca=le(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",os).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),da=le(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,as).getRegex(),At="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",rs=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,pa=le("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",rs).replace("tag",At).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),As=le(ls).replace("hr",bt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",At).getRegex(),va=le(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",As).getRegex(),is={blockquote:va,code:la,def:ca,fences:oa,heading:ra,hr:bt,html:pa,lheading:Ts,list:da,newline:aa,paragraph:As,table:ft,text:ua},gs=le("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",bt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",At).getRegex(),ma={...is,lheading:ia,table:gs,paragraph:le(ls).replace("hr",bt).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",gs).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",At).getRegex()},ga={...is,html:le(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",rs).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:ft,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:le(ls).replace("hr",bt).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Ts).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},fa=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,ha=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Us=/^( {2,}|\\)\n(?!\s*$)/,ba=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ut=/[\p{P}\p{S}]/u,us=/[\s\p{P}\p{S}]/u,Bs=/[^\s\p{P}\p{S}]/u,ka=le(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,us).getRegex(),Ms=/(?!~)[\p{P}\p{S}]/u,ya=/(?!~)[\s\p{P}\p{S}]/u,_a=/(?:[^\s\p{P}\p{S}]|~)/u,$a=le(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",na?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),Ls=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,wa=le(Ls,"u").replace(/punct/g,Ut).getRegex(),xa=le(Ls,"u").replace(/punct/g,Ms).getRegex(),Es="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Ca=le(Es,"gu").replace(/notPunctSpace/g,Bs).replace(/punctSpace/g,us).replace(/punct/g,Ut).getRegex(),Sa=le(Es,"gu").replace(/notPunctSpace/g,_a).replace(/punctSpace/g,ya).replace(/punct/g,Ms).getRegex(),Pa=le("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Bs).replace(/punctSpace/g,us).replace(/punct/g,Ut).getRegex(),Ia=le(/\\(punct)/,"gu").replace(/punct/g,Ut).getRegex(),Ra=le(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ta=le(rs).replace("(?:-->|$)","-->").getRegex(),Aa=le("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Ta).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),It=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Ua=le(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",It).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),zs=le(/^!?\[(label)\]\[(ref)\]/).replace("label",It).replace("ref",os).getRegex(),Ds=le(/^!?\[(ref)\](?:\[\])?/).replace("ref",os).getRegex(),Ba=le("reflink|nolink(?!\\()","g").replace("reflink",zs).replace("nolink",Ds).getRegex(),fs=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,cs={_backpedal:ft,anyPunctuation:Ia,autolink:Ra,blockSkip:$a,br:Us,code:ha,del:ft,emStrongLDelim:wa,emStrongRDelimAst:Ca,emStrongRDelimUnd:Pa,escape:fa,link:Ua,nolink:Ds,punctuation:ka,reflink:zs,reflinkSearch:Ba,tag:Aa,text:ba,url:ft},Ma={...cs,link:le(/^!?\[(label)\]\((.*?)\)/).replace("label",It).getRegex(),reflink:le(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",It).getRegex()},es={...cs,emStrongRDelimAst:Sa,emStrongLDelim:xa,url:le(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",fs).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:le(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",fs).getRegex()},La={...es,br:le(Us).replace("{2,}","*").getRegex(),text:le(es.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},St={normal:is,gfm:ma,pedantic:ga},vt={normal:cs,gfm:es,breaks:La,pedantic:Ma},Ea={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},hs=l=>Ea[l];function ze(l,t){if(t){if($e.escapeTest.test(l))return l.replace($e.escapeReplace,hs)}else if($e.escapeTestNoEncode.test(l))return l.replace($e.escapeReplaceNoEncode,hs);return l}function bs(l){try{l=encodeURI(l).replace($e.percentDecode,"%")}catch{return null}return l}function ks(l,t){let n=l.replace($e.findPipe,(i,u,b)=>{let m=!1,f=u;for(;--f>=0&&b[f]==="\\";)m=!m;return m?"|":" |"}),a=n.split($e.splitPipe),s=0;if(a[0].trim()||a.shift(),a.length>0&&!a.at(-1)?.trim()&&a.pop(),t)if(a.length>t)a.splice(t);else for(;a.length<t;)a.push("");for(;s<a.length;s++)a[s]=a[s].trim().replace($e.slashPipe,"|");return a}function mt(l,t,n){let a=l.length;if(a===0)return"";let s=0;for(;s<a&&l.charAt(a-s-1)===t;)s++;return l.slice(0,a-s)}function za(l,t){if(l.indexOf(t[1])===-1)return-1;let n=0;for(let a=0;a<l.length;a++)if(l[a]==="\\")a++;else if(l[a]===t[0])n++;else if(l[a]===t[1]&&(n--,n<0))return a;return n>0?-2:-1}function ys(l,t,n,a,s){let i=t.href,u=t.title||null,b=l[1].replace(s.other.outputLinkReplace,"$1");a.state.inLink=!0;let m={type:l[0].charAt(0)==="!"?"image":"link",raw:n,href:i,title:u,text:b,tokens:a.inlineTokens(b)};return a.state.inLink=!1,m}function Da(l,t,n){let a=l.match(n.other.indentCodeCompensation);if(a===null)return t;let s=a[1];return t.split(`
`).map(i=>{let u=i.match(n.other.beginningSpace);if(u===null)return i;let[b]=u;return b.length>=s.length?i.slice(s.length):i}).join(`
`)}var Rt=class{options;rules;lexer;constructor(l){this.options=l||Ye}space(l){let t=this.rules.block.newline.exec(l);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(l){let t=this.rules.block.code.exec(l);if(t){let n=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:mt(n,`
`)}}}fences(l){let t=this.rules.block.fences.exec(l);if(t){let n=t[0],a=Da(n,t[3]||"",this.rules);return{type:"code",raw:n,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:a}}}heading(l){let t=this.rules.block.heading.exec(l);if(t){let n=t[2].trim();if(this.rules.other.endingHash.test(n)){let a=mt(n,"#");(this.options.pedantic||!a||this.rules.other.endingSpaceChar.test(a))&&(n=a.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(l){let t=this.rules.block.hr.exec(l);if(t)return{type:"hr",raw:mt(t[0],`
`)}}blockquote(l){let t=this.rules.block.blockquote.exec(l);if(t){let n=mt(t[0],`
`).split(`
`),a="",s="",i=[];for(;n.length>0;){let u=!1,b=[],m;for(m=0;m<n.length;m++)if(this.rules.other.blockquoteStart.test(n[m]))b.push(n[m]),u=!0;else if(!u)b.push(n[m]);else break;n=n.slice(m);let f=b.join(`
`),k=f.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");a=a?`${a}
${f}`:f,s=s?`${s}
${k}`:k;let P=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(k,i,!0),this.lexer.state.top=P,n.length===0)break;let R=i.at(-1);if(R?.type==="code")break;if(R?.type==="blockquote"){let U=R,E=U.raw+`
`+n.join(`
`),D=this.blockquote(E);i[i.length-1]=D,a=a.substring(0,a.length-U.raw.length)+D.raw,s=s.substring(0,s.length-U.text.length)+D.text;break}else if(R?.type==="list"){let U=R,E=U.raw+`
`+n.join(`
`),D=this.list(E);i[i.length-1]=D,a=a.substring(0,a.length-R.raw.length)+D.raw,s=s.substring(0,s.length-U.raw.length)+D.raw,n=E.substring(i.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:a,tokens:i,text:s}}}list(l){let t=this.rules.block.list.exec(l);if(t){let n=t[1].trim(),a=n.length>1,s={type:"list",raw:"",ordered:a,start:a?+n.slice(0,-1):"",loose:!1,items:[]};n=a?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=a?n:"[*+-]");let i=this.rules.other.listItemRegex(n),u=!1;for(;l;){let m=!1,f="",k="";if(!(t=i.exec(l))||this.rules.block.hr.test(l))break;f=t[0],l=l.substring(f.length);let P=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,D=>" ".repeat(3*D.length)),R=l.split(`
`,1)[0],U=!P.trim(),E=0;if(this.options.pedantic?(E=2,k=P.trimStart()):U?E=t[1].length+1:(E=t[2].search(this.rules.other.nonSpaceChar),E=E>4?1:E,k=P.slice(E),E+=t[1].length),U&&this.rules.other.blankLine.test(R)&&(f+=R+`
`,l=l.substring(R.length+1),m=!0),!m){let D=this.rules.other.nextBulletRegex(E),F=this.rules.other.hrRegex(E),q=this.rules.other.fencesBeginRegex(E),j=this.rules.other.headingBeginRegex(E),B=this.rules.other.htmlBeginRegex(E);for(;l;){let x=l.split(`
`,1)[0],o;if(R=x,this.options.pedantic?(R=R.replace(this.rules.other.listReplaceNesting,"  "),o=R):o=R.replace(this.rules.other.tabCharGlobal,"    "),q.test(R)||j.test(R)||B.test(R)||D.test(R)||F.test(R))break;if(o.search(this.rules.other.nonSpaceChar)>=E||!R.trim())k+=`
`+o.slice(E);else{if(U||P.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||q.test(P)||j.test(P)||F.test(P))break;k+=`
`+R}!U&&!R.trim()&&(U=!0),f+=x+`
`,l=l.substring(x.length+1),P=o.slice(E)}}s.loose||(u?s.loose=!0:this.rules.other.doubleBlankLine.test(f)&&(u=!0)),s.items.push({type:"list_item",raw:f,task:!!this.options.gfm&&this.rules.other.listIsTask.test(k),loose:!1,text:k,tokens:[]}),s.raw+=f}let b=s.items.at(-1);if(b)b.raw=b.raw.trimEnd(),b.text=b.text.trimEnd();else return;s.raw=s.raw.trimEnd();for(let m of s.items){if(this.lexer.state.top=!1,m.tokens=this.lexer.blockTokens(m.text,[]),m.task){if(m.text=m.text.replace(this.rules.other.listReplaceTask,""),m.tokens[0]?.type==="text"||m.tokens[0]?.type==="paragraph"){m.tokens[0].raw=m.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),m.tokens[0].text=m.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let k=this.lexer.inlineQueue.length-1;k>=0;k--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[k].src)){this.lexer.inlineQueue[k].src=this.lexer.inlineQueue[k].src.replace(this.rules.other.listReplaceTask,"");break}}let f=this.rules.other.listTaskCheckbox.exec(m.raw);if(f){let k={type:"checkbox",raw:f[0]+" ",checked:f[0]!=="[ ]"};m.checked=k.checked,s.loose?m.tokens[0]&&["paragraph","text"].includes(m.tokens[0].type)&&"tokens"in m.tokens[0]&&m.tokens[0].tokens?(m.tokens[0].raw=k.raw+m.tokens[0].raw,m.tokens[0].text=k.raw+m.tokens[0].text,m.tokens[0].tokens.unshift(k)):m.tokens.unshift({type:"paragraph",raw:k.raw,text:k.raw,tokens:[k]}):m.tokens.unshift(k)}}if(!s.loose){let f=m.tokens.filter(P=>P.type==="space"),k=f.length>0&&f.some(P=>this.rules.other.anyLine.test(P.raw));s.loose=k}}if(s.loose)for(let m of s.items){m.loose=!0;for(let f of m.tokens)f.type==="text"&&(f.type="paragraph")}return s}}html(l){let t=this.rules.block.html.exec(l);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(l){let t=this.rules.block.def.exec(l);if(t){let n=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),a=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:n,raw:t[0],href:a,title:s}}}table(l){let t=this.rules.block.table.exec(l);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let n=ks(t[1]),a=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=t[3]?.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],i={type:"table",raw:t[0],header:[],align:[],rows:[]};if(n.length===a.length){for(let u of a)this.rules.other.tableAlignRight.test(u)?i.align.push("right"):this.rules.other.tableAlignCenter.test(u)?i.align.push("center"):this.rules.other.tableAlignLeft.test(u)?i.align.push("left"):i.align.push(null);for(let u=0;u<n.length;u++)i.header.push({text:n[u],tokens:this.lexer.inline(n[u]),header:!0,align:i.align[u]});for(let u of s)i.rows.push(ks(u,i.header.length).map((b,m)=>({text:b,tokens:this.lexer.inline(b),header:!1,align:i.align[m]})));return i}}lheading(l){let t=this.rules.block.lheading.exec(l);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(l){let t=this.rules.block.paragraph.exec(l);if(t){let n=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:n,tokens:this.lexer.inline(n)}}}text(l){let t=this.rules.block.text.exec(l);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(l){let t=this.rules.inline.escape.exec(l);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(l){let t=this.rules.inline.tag.exec(l);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(l){let t=this.rules.inline.link.exec(l);if(t){let n=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let i=mt(n.slice(0,-1),"\\");if((n.length-i.length)%2===0)return}else{let i=za(t[2],"()");if(i===-2)return;if(i>-1){let u=(t[0].indexOf("!")===0?5:4)+t[1].length+i;t[2]=t[2].substring(0,i),t[0]=t[0].substring(0,u).trim(),t[3]=""}}let a=t[2],s="";if(this.options.pedantic){let i=this.rules.other.pedanticHrefTitle.exec(a);i&&(a=i[1],s=i[3])}else s=t[3]?t[3].slice(1,-1):"";return a=a.trim(),this.rules.other.startAngleBracket.test(a)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?a=a.slice(1):a=a.slice(1,-1)),ys(t,{href:a&&a.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(l,t){let n;if((n=this.rules.inline.reflink.exec(l))||(n=this.rules.inline.nolink.exec(l))){let a=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),s=t[a.toLowerCase()];if(!s){let i=n[0].charAt(0);return{type:"text",raw:i,text:i}}return ys(n,s,n[0],this.lexer,this.rules)}}emStrong(l,t,n=""){let a=this.rules.inline.emStrongLDelim.exec(l);if(!(!a||a[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(a[1]||a[2])||!n||this.rules.inline.punctuation.exec(n))){let s=[...a[0]].length-1,i,u,b=s,m=0,f=a[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(f.lastIndex=0,t=t.slice(-1*l.length+s);(a=f.exec(t))!=null;){if(i=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!i)continue;if(u=[...i].length,a[3]||a[4]){b+=u;continue}else if((a[5]||a[6])&&s%3&&!((s+u)%3)){m+=u;continue}if(b-=u,b>0)continue;u=Math.min(u,u+b+m);let k=[...a[0]][0].length,P=l.slice(0,s+a.index+k+u);if(Math.min(s,u)%2){let U=P.slice(1,-1);return{type:"em",raw:P,text:U,tokens:this.lexer.inlineTokens(U)}}let R=P.slice(2,-2);return{type:"strong",raw:P,text:R,tokens:this.lexer.inlineTokens(R)}}}}codespan(l){let t=this.rules.inline.code.exec(l);if(t){let n=t[2].replace(this.rules.other.newLineCharGlobal," "),a=this.rules.other.nonSpaceChar.test(n),s=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return a&&s&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:t[0],text:n}}}br(l){let t=this.rules.inline.br.exec(l);if(t)return{type:"br",raw:t[0]}}del(l){let t=this.rules.inline.del.exec(l);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(l){let t=this.rules.inline.autolink.exec(l);if(t){let n,a;return t[2]==="@"?(n=t[1],a="mailto:"+n):(n=t[1],a=n),{type:"link",raw:t[0],text:n,href:a,tokens:[{type:"text",raw:n,text:n}]}}}url(l){let t;if(t=this.rules.inline.url.exec(l)){let n,a;if(t[2]==="@")n=t[0],a="mailto:"+n;else{let s;do s=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])?.[0]??"";while(s!==t[0]);n=t[0],t[1]==="www."?a="http://"+t[0]:a=t[0]}return{type:"link",raw:t[0],text:n,href:a,tokens:[{type:"text",raw:n,text:n}]}}}inlineText(l){let t=this.rules.inline.text.exec(l);if(t){let n=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:n}}}},Te=class ts{tokens;options;state;inlineQueue;tokenizer;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||Ye,this.options.tokenizer=this.options.tokenizer||new Rt,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:$e,block:St.normal,inline:vt.normal};this.options.pedantic?(n.block=St.pedantic,n.inline=vt.pedantic):this.options.gfm&&(n.block=St.gfm,this.options.breaks?n.inline=vt.breaks:n.inline=vt.gfm),this.tokenizer.rules=n}static get rules(){return{block:St,inline:vt}}static lex(t,n){return new ts(n).lex(t)}static lexInline(t,n){return new ts(n).inlineTokens(t)}lex(t){t=t.replace($e.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let a=this.inlineQueue[n];this.inlineTokens(a.src,a.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,n=[],a=!1){for(this.options.pedantic&&(t=t.replace($e.tabCharGlobal,"    ").replace($e.spaceLine,""));t;){let s;if(this.options.extensions?.block?.some(u=>(s=u.call({lexer:this},t,n))?(t=t.substring(s.raw.length),n.push(s),!0):!1))continue;if(s=this.tokenizer.space(t)){t=t.substring(s.raw.length);let u=n.at(-1);s.raw.length===1&&u!==void 0?u.raw+=`
`:n.push(s);continue}if(s=this.tokenizer.code(t)){t=t.substring(s.raw.length);let u=n.at(-1);u?.type==="paragraph"||u?.type==="text"?(u.raw+=(u.raw.endsWith(`
`)?"":`
`)+s.raw,u.text+=`
`+s.text,this.inlineQueue.at(-1).src=u.text):n.push(s);continue}if(s=this.tokenizer.fences(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.heading(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.hr(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.blockquote(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.list(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.html(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.def(t)){t=t.substring(s.raw.length);let u=n.at(-1);u?.type==="paragraph"||u?.type==="text"?(u.raw+=(u.raw.endsWith(`
`)?"":`
`)+s.raw,u.text+=`
`+s.raw,this.inlineQueue.at(-1).src=u.text):this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title},n.push(s));continue}if(s=this.tokenizer.table(t)){t=t.substring(s.raw.length),n.push(s);continue}if(s=this.tokenizer.lheading(t)){t=t.substring(s.raw.length),n.push(s);continue}let i=t;if(this.options.extensions?.startBlock){let u=1/0,b=t.slice(1),m;this.options.extensions.startBlock.forEach(f=>{m=f.call({lexer:this},b),typeof m=="number"&&m>=0&&(u=Math.min(u,m))}),u<1/0&&u>=0&&(i=t.substring(0,u+1))}if(this.state.top&&(s=this.tokenizer.paragraph(i))){let u=n.at(-1);a&&u?.type==="paragraph"?(u.raw+=(u.raw.endsWith(`
`)?"":`
`)+s.raw,u.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=u.text):n.push(s),a=i.length!==t.length,t=t.substring(s.raw.length);continue}if(s=this.tokenizer.text(t)){t=t.substring(s.raw.length);let u=n.at(-1);u?.type==="text"?(u.raw+=(u.raw.endsWith(`
`)?"":`
`)+s.raw,u.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=u.text):n.push(s);continue}if(t){let u="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(u);break}else throw new Error(u)}}return this.state.top=!0,n}inline(t,n=[]){return this.inlineQueue.push({src:t,tokens:n}),n}inlineTokens(t,n=[]){let a=t,s=null;if(this.tokens.links){let m=Object.keys(this.tokens.links);if(m.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(a))!=null;)m.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(a=a.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(a))!=null;)a=a.slice(0,s.index)+"++"+a.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let i;for(;(s=this.tokenizer.rules.inline.blockSkip.exec(a))!=null;)i=s[2]?s[2].length:0,a=a.slice(0,s.index+i)+"["+"a".repeat(s[0].length-i-2)+"]"+a.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);a=this.options.hooks?.emStrongMask?.call({lexer:this},a)??a;let u=!1,b="";for(;t;){u||(b=""),u=!1;let m;if(this.options.extensions?.inline?.some(k=>(m=k.call({lexer:this},t,n))?(t=t.substring(m.raw.length),n.push(m),!0):!1))continue;if(m=this.tokenizer.escape(t)){t=t.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.tag(t)){t=t.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.link(t)){t=t.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(m.raw.length);let k=n.at(-1);m.type==="text"&&k?.type==="text"?(k.raw+=m.raw,k.text+=m.text):n.push(m);continue}if(m=this.tokenizer.emStrong(t,a,b)){t=t.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.codespan(t)){t=t.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.br(t)){t=t.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.del(t)){t=t.substring(m.raw.length),n.push(m);continue}if(m=this.tokenizer.autolink(t)){t=t.substring(m.raw.length),n.push(m);continue}if(!this.state.inLink&&(m=this.tokenizer.url(t))){t=t.substring(m.raw.length),n.push(m);continue}let f=t;if(this.options.extensions?.startInline){let k=1/0,P=t.slice(1),R;this.options.extensions.startInline.forEach(U=>{R=U.call({lexer:this},P),typeof R=="number"&&R>=0&&(k=Math.min(k,R))}),k<1/0&&k>=0&&(f=t.substring(0,k+1))}if(m=this.tokenizer.inlineText(f)){t=t.substring(m.raw.length),m.raw.slice(-1)!=="_"&&(b=m.raw.slice(-1)),u=!0;let k=n.at(-1);k?.type==="text"?(k.raw+=m.raw,k.text+=m.text):n.push(m);continue}if(t){let k="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(k);break}else throw new Error(k)}}return n}},Tt=class{options;parser;constructor(l){this.options=l||Ye}space(l){return""}code({text:l,lang:t,escaped:n}){let a=(t||"").match($e.notSpaceStart)?.[0],s=l.replace($e.endingNewline,"")+`
`;return a?'<pre><code class="language-'+ze(a)+'">'+(n?s:ze(s,!0))+`</code></pre>
`:"<pre><code>"+(n?s:ze(s,!0))+`</code></pre>
`}blockquote({tokens:l}){return`<blockquote>
${this.parser.parse(l)}</blockquote>
`}html({text:l}){return l}def(l){return""}heading({tokens:l,depth:t}){return`<h${t}>${this.parser.parseInline(l)}</h${t}>
`}hr(l){return`<hr>
`}list(l){let t=l.ordered,n=l.start,a="";for(let u=0;u<l.items.length;u++){let b=l.items[u];a+=this.listitem(b)}let s=t?"ol":"ul",i=t&&n!==1?' start="'+n+'"':"";return"<"+s+i+`>
`+a+"</"+s+`>
`}listitem(l){return`<li>${this.parser.parse(l.tokens)}</li>
`}checkbox({checked:l}){return"<input "+(l?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:l}){return`<p>${this.parser.parseInline(l)}</p>
`}table(l){let t="",n="";for(let s=0;s<l.header.length;s++)n+=this.tablecell(l.header[s]);t+=this.tablerow({text:n});let a="";for(let s=0;s<l.rows.length;s++){let i=l.rows[s];n="";for(let u=0;u<i.length;u++)n+=this.tablecell(i[u]);a+=this.tablerow({text:n})}return a&&(a=`<tbody>${a}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+a+`</table>
`}tablerow({text:l}){return`<tr>
${l}</tr>
`}tablecell(l){let t=this.parser.parseInline(l.tokens),n=l.header?"th":"td";return(l.align?`<${n} align="${l.align}">`:`<${n}>`)+t+`</${n}>
`}strong({tokens:l}){return`<strong>${this.parser.parseInline(l)}</strong>`}em({tokens:l}){return`<em>${this.parser.parseInline(l)}</em>`}codespan({text:l}){return`<code>${ze(l,!0)}</code>`}br(l){return"<br>"}del({tokens:l}){return`<del>${this.parser.parseInline(l)}</del>`}link({href:l,title:t,tokens:n}){let a=this.parser.parseInline(n),s=bs(l);if(s===null)return a;l=s;let i='<a href="'+l+'"';return t&&(i+=' title="'+ze(t)+'"'),i+=">"+a+"</a>",i}image({href:l,title:t,text:n,tokens:a}){a&&(n=this.parser.parseInline(a,this.parser.textRenderer));let s=bs(l);if(s===null)return ze(n);l=s;let i=`<img src="${l}" alt="${n}"`;return t&&(i+=` title="${ze(t)}"`),i+=">",i}text(l){return"tokens"in l&&l.tokens?this.parser.parseInline(l.tokens):"escaped"in l&&l.escaped?l.text:ze(l.text)}},ds=class{strong({text:l}){return l}em({text:l}){return l}codespan({text:l}){return l}del({text:l}){return l}html({text:l}){return l}text({text:l}){return l}link({text:l}){return""+l}image({text:l}){return""+l}br(){return""}checkbox({raw:l}){return l}},Ae=class ss{options;renderer;textRenderer;constructor(t){this.options=t||Ye,this.options.renderer=this.options.renderer||new Tt,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new ds}static parse(t,n){return new ss(n).parse(t)}static parseInline(t,n){return new ss(n).parseInline(t)}parse(t){let n="";for(let a=0;a<t.length;a++){let s=t[a];if(this.options.extensions?.renderers?.[s.type]){let u=s,b=this.options.extensions.renderers[u.type].call({parser:this},u);if(b!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(u.type)){n+=b||"";continue}}let i=s;switch(i.type){case"space":{n+=this.renderer.space(i);break}case"hr":{n+=this.renderer.hr(i);break}case"heading":{n+=this.renderer.heading(i);break}case"code":{n+=this.renderer.code(i);break}case"table":{n+=this.renderer.table(i);break}case"blockquote":{n+=this.renderer.blockquote(i);break}case"list":{n+=this.renderer.list(i);break}case"checkbox":{n+=this.renderer.checkbox(i);break}case"html":{n+=this.renderer.html(i);break}case"def":{n+=this.renderer.def(i);break}case"paragraph":{n+=this.renderer.paragraph(i);break}case"text":{n+=this.renderer.text(i);break}default:{let u='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(u),"";throw new Error(u)}}}return n}parseInline(t,n=this.renderer){let a="";for(let s=0;s<t.length;s++){let i=t[s];if(this.options.extensions?.renderers?.[i.type]){let b=this.options.extensions.renderers[i.type].call({parser:this},i);if(b!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type)){a+=b||"";continue}}let u=i;switch(u.type){case"escape":{a+=n.text(u);break}case"html":{a+=n.html(u);break}case"link":{a+=n.link(u);break}case"image":{a+=n.image(u);break}case"checkbox":{a+=n.checkbox(u);break}case"strong":{a+=n.strong(u);break}case"em":{a+=n.em(u);break}case"codespan":{a+=n.codespan(u);break}case"br":{a+=n.br(u);break}case"del":{a+=n.del(u);break}case"text":{a+=n.text(u);break}default:{let b='Token with "'+u.type+'" type was not found.';if(this.options.silent)return console.error(b),"";throw new Error(b)}}}return a}},gt=class{options;block;constructor(l){this.options=l||Ye}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(l){return l}postprocess(l){return l}processAllTokens(l){return l}emStrongMask(l){return l}provideLexer(){return this.block?Te.lex:Te.lexInline}provideParser(){return this.block?Ae.parse:Ae.parseInline}},Va=class{defaults=ns();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=Ae;Renderer=Tt;TextRenderer=ds;Lexer=Te;Tokenizer=Rt;Hooks=gt;constructor(...l){this.use(...l)}walkTokens(l,t){let n=[];for(let a of l)switch(n=n.concat(t.call(this,a)),a.type){case"table":{let s=a;for(let i of s.header)n=n.concat(this.walkTokens(i.tokens,t));for(let i of s.rows)for(let u of i)n=n.concat(this.walkTokens(u.tokens,t));break}case"list":{let s=a;n=n.concat(this.walkTokens(s.items,t));break}default:{let s=a;this.defaults.extensions?.childTokens?.[s.type]?this.defaults.extensions.childTokens[s.type].forEach(i=>{let u=s[i].flat(1/0);n=n.concat(this.walkTokens(u,t))}):s.tokens&&(n=n.concat(this.walkTokens(s.tokens,t)))}}return n}use(...l){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return l.forEach(n=>{let a={...n};if(a.async=this.defaults.async||a.async||!1,n.extensions&&(n.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){let i=t.renderers[s.name];i?t.renderers[s.name]=function(...u){let b=s.renderer.apply(this,u);return b===!1&&(b=i.apply(this,u)),b}:t.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let i=t[s.level];i?i.unshift(s.tokenizer):t[s.level]=[s.tokenizer],s.start&&(s.level==="block"?t.startBlock?t.startBlock.push(s.start):t.startBlock=[s.start]:s.level==="inline"&&(t.startInline?t.startInline.push(s.start):t.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(t.childTokens[s.name]=s.childTokens)}),a.extensions=t),n.renderer){let s=this.defaults.renderer||new Tt(this.defaults);for(let i in n.renderer){if(!(i in s))throw new Error(`renderer '${i}' does not exist`);if(["options","parser"].includes(i))continue;let u=i,b=n.renderer[u],m=s[u];s[u]=(...f)=>{let k=b.apply(s,f);return k===!1&&(k=m.apply(s,f)),k||""}}a.renderer=s}if(n.tokenizer){let s=this.defaults.tokenizer||new Rt(this.defaults);for(let i in n.tokenizer){if(!(i in s))throw new Error(`tokenizer '${i}' does not exist`);if(["options","rules","lexer"].includes(i))continue;let u=i,b=n.tokenizer[u],m=s[u];s[u]=(...f)=>{let k=b.apply(s,f);return k===!1&&(k=m.apply(s,f)),k}}a.tokenizer=s}if(n.hooks){let s=this.defaults.hooks||new gt;for(let i in n.hooks){if(!(i in s))throw new Error(`hook '${i}' does not exist`);if(["options","block"].includes(i))continue;let u=i,b=n.hooks[u],m=s[u];gt.passThroughHooks.has(i)?s[u]=f=>{if(this.defaults.async&&gt.passThroughHooksRespectAsync.has(i))return(async()=>{let P=await b.call(s,f);return m.call(s,P)})();let k=b.call(s,f);return m.call(s,k)}:s[u]=(...f)=>{if(this.defaults.async)return(async()=>{let P=await b.apply(s,f);return P===!1&&(P=await m.apply(s,f)),P})();let k=b.apply(s,f);return k===!1&&(k=m.apply(s,f)),k}}a.hooks=s}if(n.walkTokens){let s=this.defaults.walkTokens,i=n.walkTokens;a.walkTokens=function(u){let b=[];return b.push(i.call(this,u)),s&&(b=b.concat(s.call(this,u))),b}}this.defaults={...this.defaults,...a}}),this}setOptions(l){return this.defaults={...this.defaults,...l},this}lexer(l,t){return Te.lex(l,t??this.defaults)}parser(l,t){return Ae.parse(l,t??this.defaults)}parseMarkdown(l){return(t,n)=>{let a={...n},s={...this.defaults,...a},i=this.onError(!!s.silent,!!s.async);if(this.defaults.async===!0&&a.async===!1)return i(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return i(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));if(s.hooks&&(s.hooks.options=s,s.hooks.block=l),s.async)return(async()=>{let u=s.hooks?await s.hooks.preprocess(t):t,b=await(s.hooks?await s.hooks.provideLexer():l?Te.lex:Te.lexInline)(u,s),m=s.hooks?await s.hooks.processAllTokens(b):b;s.walkTokens&&await Promise.all(this.walkTokens(m,s.walkTokens));let f=await(s.hooks?await s.hooks.provideParser():l?Ae.parse:Ae.parseInline)(m,s);return s.hooks?await s.hooks.postprocess(f):f})().catch(i);try{s.hooks&&(t=s.hooks.preprocess(t));let u=(s.hooks?s.hooks.provideLexer():l?Te.lex:Te.lexInline)(t,s);s.hooks&&(u=s.hooks.processAllTokens(u)),s.walkTokens&&this.walkTokens(u,s.walkTokens);let b=(s.hooks?s.hooks.provideParser():l?Ae.parse:Ae.parseInline)(u,s);return s.hooks&&(b=s.hooks.postprocess(b)),b}catch(u){return i(u)}}}onError(l,t){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,l){let a="<p>An error occurred:</p><pre>"+ze(n.message+"",!0)+"</pre>";return t?Promise.resolve(a):a}if(t)return Promise.reject(n);throw n}}},Xe=new Va;function oe(l,t){return Xe.parse(l,t)}oe.options=oe.setOptions=function(l){return Xe.setOptions(l),oe.defaults=Xe.defaults,Is(oe.defaults),oe};oe.getDefaults=ns;oe.defaults=Ye;oe.use=function(...l){return Xe.use(...l),oe.defaults=Xe.defaults,Is(oe.defaults),oe};oe.walkTokens=function(l,t){return Xe.walkTokens(l,t)};oe.parseInline=Xe.parseInline;oe.Parser=Ae;oe.parser=Ae.parse;oe.Renderer=Tt;oe.TextRenderer=ds;oe.Lexer=Te;oe.lexer=Te.lex;oe.Tokenizer=Rt;oe.Hooks=gt;oe.parse=oe;oe.options;oe.setOptions;oe.use;oe.walkTokens;oe.parseInline;Ae.parse;Te.lex;const Oa={class:"overview-grid"},Ka={class:"overview-card summary-card"},qa={class:"card-header"},Fa={class:"card-title-with-selector"},Na={class:"card-title-icon"},ja={class:"card-header-actions"},Ga={class:"template-status"},Qa={class:"template-description"},Ha={class:"card-content markdown-content"},Ja={key:0,class:"loading-text"},Za=["innerHTML"],Wa={key:2,class:"placeholder-text"},Xa={class:"overview-card stats-card"},Ya={class:"stats-grid"},el={class:"stat-item"},tl={class:"stat-value"},sl={class:"stat-item"},nl={class:"stat-value"},al={class:"export-actions"},ll=["disabled"],ol=["disabled"],rl={class:"overview-card recent-card"},il={class:"recent-pages"},ul={key:0,class:"placeholder-text"},cl=["onClick"],dl={class:"page-number"},pl={key:0,class:"page-summary"},vl=ge({__name:"OverviewPanel",setup(l){const t=he(),n=h("no_spoiler"),a=h(""),s=h(!1),i=h([]),u=h([]),b=[{value:"no_spoiler",label:"æ— å‰§é€ç®€ä»‹",icon:"ðŸŽ",description:"ä¸å«å‰§é€çš„ç®€çŸ­ä»‹ç»ï¼Œé€‚åˆæŽ¨èç»™ä»–äºº"},{value:"story_summary",label:"æ•…äº‹æ¦‚è¦",icon:"ðŸ“–",description:"å®Œæ•´çš„å‰§æƒ…å›žé¡¾ï¼ŒåŒ…å«æ‰€æœ‰å‰§é€"},{value:"recap",label:"å‰æƒ…å›žé¡¾",icon:"âª",description:"ä¹‹å‰å‘ç”Ÿçš„é‡è¦äº‹ä»¶å›žé¡¾"},{value:"character_guide",label:"è§’è‰²å›¾é‰´",icon:"ðŸ‘¥",description:"ä¸»è¦è§’è‰²ä»‹ç»å’Œå…³ç³»"},{value:"world_setting",label:"ä¸–ç•Œè§‚è®¾å®š",icon:"ðŸŒ",description:"æ•…äº‹èƒŒæ™¯å’Œä¸–ç•Œè§‚è®¾å®š"},{value:"highlights",label:"ååœºé¢ç›˜ç‚¹",icon:"âœ¨",description:"ç²¾å½©ç‰‡æ®µå’Œç»å…¸åœºæ™¯å›žé¡¾"},{value:"reading_notes",label:"é˜…è¯»ç¬”è®°",icon:"ðŸ“",description:"é˜…è¯»è¿‡ç¨‹ä¸­çš„é‡ç‚¹ç¬”è®°"}],m=b.map(r=>({label:`${r.icon} ${r.label}`,value:r.value})),f=N(()=>b.find(g=>g.value===n.value)?.icon||"ðŸ“Š"),k=N(()=>b.find(g=>g.value===n.value)?.description||""),P=N(()=>i.value.includes(n.value)?"å·²ç”Ÿæˆ":""),R=N(()=>a.value?oe.parse(a.value):"");async function U(){await E()}async function E(){if(t.currentBookId){s.value=!0,a.value="";try{const r=await dn(t.currentBookId,n.value);r.success&&r.content?(a.value=r.content,i.value.includes(n.value)||i.value.push(n.value)):a.value=""}catch(r){console.error("åŠ è½½æ¦‚è§ˆå¤±è´¥:",r),a.value="åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•"}finally{s.value=!1}}}async function D(r){if(t.currentBookId){s.value=!0,a.value="";try{const g=await pn(t.currentBookId,n.value,r);g.success?g.content&&(a.value=g.content,i.value.includes(n.value)||i.value.push(n.value)):a.value=`ç”Ÿæˆå¤±è´¥: ${g.error||"æœªçŸ¥é”™è¯¯"}`}catch(g){console.error("ç”Ÿæˆæ¦‚è§ˆå¤±è´¥:",g),a.value="ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•"}finally{s.value=!1}}}async function F(){if(t.currentBookId)try{const r=await vn(t.currentBookId);if(r.success){let g=[];r.generated?g=r.generated:r.templates&&Array.isArray(r.templates)&&(g=r.templates),i.value=g}}catch(r){console.error("åŠ è½½æ¨¡æ¿åˆ—è¡¨å¤±è´¥:",r)}}const q=h(!1);async function j(){if(!t.currentBookId){alert("è¯·å…ˆé€‰æ‹©ä¹¦ç±");return}q.value=!0;try{const r=await Ps(t.currentBookId);if(r.success&&r.markdown){const g=new Blob([r.markdown],{type:"text/markdown"}),S=URL.createObjectURL(g),T=document.createElement("a");T.href=S,T.download=`${t.currentBookId}_analysis.md`,T.click(),URL.revokeObjectURL(S),alert("å¯¼å‡ºæˆåŠŸ")}else alert("å¯¼å‡ºå¤±è´¥: "+(r.error||"æœªçŸ¥é”™è¯¯"))}catch(r){console.error("å¯¼å‡ºå¤±è´¥:",r),alert("å¯¼å‡ºå¤±è´¥")}finally{q.value=!1}}function B(){if(!a.value){alert("æš‚æ— å†…å®¹å¯å¯¼å‡º");return}const r=b.find(se=>se.value===n.value),g=`${t.currentBookId}_${n.value}.md`,S=`# ${r?.label||n.value}

${a.value}`,T=new Blob([S],{type:"text/markdown"}),C=URL.createObjectURL(T),V=document.createElement("a");V.href=C,V.download=g,V.click(),URL.revokeObjectURL(C)}async function x(){if(t.currentBookId)try{if((await Cs(t.currentBookId)).success&&t.analyzedPageCount>0){const g=t.totalPageCount,S=t.analyzedPageCount,T=[],C=Math.max(1,S-4);for(let V=0;V<Math.min(5,S);V++){const se=C+V;se<=g&&T.push({page_num:se,summary:`ç¬¬ ${se} é¡µ`})}u.value=T.reverse()}}catch(r){console.error("åŠ è½½æœ€è¿‘åˆ†æžé¡µé¢å¤±è´¥:",r)}}function o(r){t.selectPage(r)}return qe(async()=>{await F(),await x(),i.value.includes(n.value)&&await E()}),Be(()=>t.currentBookId,async r=>{r&&(a.value="",i.value=[],u.value=[],await F(),await x(),i.value.includes(n.value)&&await E())}),Be(()=>t.dataRefreshKey,async r=>{r>0&&t.currentBookId&&(console.log("OverviewPanel: æ”¶åˆ°åˆ·æ–°ä¿¡å·ï¼Œé‡æ–°åŠ è½½æ•°æ®"),await F(),await x(),i.value.includes(n.value)&&await E())}),(r,g)=>(d(),p("div",Oa,[e("div",Ka,[e("div",qa,[e("div",Fa,[e("span",Na,$(f.value),1),ie(xe,{modelValue:n.value,"onUpdate:modelValue":g[0]||(g[0]=S=>n.value=S),options:pe(m),onChange:U},null,8,["modelValue","options"])]),e("div",ja,[e("span",Ga,$(P.value),1),e("button",{class:"btn-icon",title:"ç”Ÿæˆ/åŠ è½½",onClick:g[1]||(g[1]=S=>D(!1))}," ðŸ“„ "),e("button",{class:"btn-icon",title:"é‡æ–°ç”Ÿæˆ",onClick:g[2]||(g[2]=S=>D(!0))}," ðŸ”„ ")])]),e("p",Qa,$(k.value),1),e("div",Ha,[s.value?(d(),p("div",Ja,"åŠ è½½ä¸­...")):a.value?(d(),p("div",{key:1,innerHTML:R.value},null,8,Za)):(d(),p("div",Wa,"é€‰æ‹©æ¨¡æ¿ç±»åž‹ï¼Œç‚¹å‡»ç”ŸæˆæŒ‰é’®"))])]),e("div",Xa,[g[5]||(g[5]=e("h3",{class:"card-title"},"ðŸ“Š åˆ†æžç»Ÿè®¡",-1)),e("div",Ya,[e("div",el,[e("span",tl,$(pe(t).analyzedPageCount),1),g[3]||(g[3]=e("span",{class:"stat-label"},"å·²åˆ†æžé¡µé¢",-1))]),e("div",sl,[e("span",nl,$(pe(t).chapters.length),1),g[4]||(g[4]=e("span",{class:"stat-label"},"ç« èŠ‚æ•°",-1))])]),e("div",al,[e("button",{class:"btn btn-secondary btn-sm",disabled:q.value||!a.value,title:"å¯¼å‡ºå½“å‰æ¦‚è§ˆ",onClick:B}," ðŸ“„ å¯¼å‡ºå½“å‰ ",8,ll),e("button",{class:"btn btn-primary btn-sm",disabled:q.value,title:"å¯¼å‡ºå®Œæ•´åˆ†æžæ•°æ®",onClick:j},$(q.value?"å¯¼å‡ºä¸­...":"ðŸ“¤ å¯¼å‡ºå…¨éƒ¨"),9,ol)])]),e("div",rl,[g[6]||(g[6]=e("h3",{class:"card-title"},"ðŸ• æœ€è¿‘åˆ†æž",-1)),e("div",il,[u.value.length===0?(d(),p("div",ul,"æš‚æ— åˆ†æžè®°å½•")):M("",!0),(d(!0),p(W,null,te(u.value,S=>(d(),p("div",{key:S.page_num,class:"recent-page-item",onClick:T=>o(S.page_num)},[e("span",dl,"ç¬¬ "+$(S.page_num)+" é¡µ",1),S.summary?(d(),p("span",pl,$(S.summary),1)):M("",!0)],8,cl))),128))])])]))}}),ml=Se(vl,[["__scopeId","data-v-ab7103d7"]]),gl={class:"timeline-tab"},fl={class:"timeline-header"},hl=["disabled"],bl={key:0,class:"btn-spinner"},kl={key:0,class:"error-message"},yl={class:"timeline-container"},_l={key:0,class:"loading-state"},$l={key:1,class:"timeline-empty-state"},wl=["disabled"],xl={class:"timeline-stats"},Cl={key:0,class:"stat-badge"},Sl={class:"stat-badge"},Pl={key:1,class:"stat-badge"},Il={key:2,class:"stat-badge"},Rl={class:"stat-badge"},Tl={key:0,class:"timeline-summary-card"},Al={class:"one-sentence"},Ul={key:0,class:"themes"},Bl={key:1,class:"characters-section"},Ml={class:"characters-grid"},Ll=["onClick"],El={class:"character-name"},zl={class:"character-desc"},Dl={class:"character-page"},Vl={key:2,class:"timeline-section"},Ol={key:3,class:"timeline-track"},Kl={class:"timeline-node"},ql=["onClick"],Fl={class:"timeline-card"},Nl=["onClick"],jl=["src","alt","onClick"],Gl={class:"timeline-card-title"},Ql={class:"timeline-page-range"},Hl={class:"timeline-event-count"},Jl={class:"expand-icon"},Zl={key:0,class:"timeline-summary"},Wl={key:1,class:"timeline-mood"},Xl={key:4,class:"timeline-track"},Yl={class:"timeline-node"},eo=["onClick"],to={class:"timeline-card"},so=["onClick"],no=["src","alt","onClick"],ao={class:"timeline-card-title"},lo={class:"timeline-page-range"},oo={class:"timeline-event-count"},ro={class:"expand-icon"},io={key:0,class:"timeline-summary"},uo={key:1,class:"timeline-events-list"},co={key:5,class:"timeline-section"},po={class:"plot-threads-list"},vo={class:"thread-header"},mo={class:"thread-name"},go={key:0,class:"thread-desc"},fo={key:1,class:"thread-intro"},ho={key:6,class:"placeholder-text"},bo=ge({__name:"TimelinePanel",setup(l){const t=he(),n=h(!1),a=h(!1),s=h(null);h("simple");const i=h(new Set),u=h(""),b=N(()=>{if(!s.value)return!1;const x=s.value.groups&&s.value.groups.length>0,o=s.value.plot_arcs&&s.value.plot_arcs.length>0;return x||o}),m=N(()=>s.value?.stats?.total_events||0),f=N(()=>s.value?.stats?.total_pages||0),k=N(()=>s.value?.mode==="enhanced"||!!s.value?.story_summary||!!s.value?.plot_arcs?.length),P=N(()=>s.value?.main_characters||[]),R=N(()=>s.value?.plot_arcs||[]),U=N(()=>s.value?.story_summary||"");async function E(){if(t.currentBookId){n.value=!0,u.value="";try{const x=await mn(t.currentBookId);console.log("Timeline API response:",x),x.success?(s.value={mode:x.mode||"simple",groups:x.groups||[],stats:x.stats,story_summary:x.summary?.one_sentence||"",main_characters:x.characters||[],plot_arcs:x.story_arcs||[],plot_threads:x.plot_threads||[],events:x.events||[],cached:x.cached},console.log("Parsed timelineData:",s.value)):u.value=x.error||"åŠ è½½æ—¶é—´çº¿å¤±è´¥"}catch(x){console.error("åŠ è½½æ—¶é—´çº¿å¤±è´¥:",x),u.value=x instanceof Error?x.message:"åŠ è½½å¤±è´¥"}finally{n.value=!1}}}async function D(){if(t.currentBookId){a.value=!0,u.value="";try{const x=await gn(t.currentBookId);x.success?s.value=x:u.value="é‡æ–°ç”Ÿæˆå¤±è´¥"}catch(x){console.error("é‡æ–°ç”Ÿæˆæ—¶é—´çº¿å¤±è´¥:",x),u.value=x instanceof Error?x.message:"é‡æ–°ç”Ÿæˆå¤±è´¥"}finally{a.value=!1}}}function F(x){return t.currentBookId?Ss(t.currentBookId,x):""}function q(x){t.selectPage(x)}function j(x){i.value.has(x)?i.value.delete(x):i.value.add(x)}function B(x){return i.value.has(x)}return qe(()=>{t.currentBookId&&E()}),Be(()=>t.currentBookId,x=>{x&&(s.value=null,E())}),Be(()=>t.dataRefreshKey,x=>{x>0&&t.currentBookId&&(console.log("TimelinePanel: æ”¶åˆ°åˆ·æ–°ä¿¡å·ï¼Œé‡æ–°åŠ è½½æ•°æ®"),E())}),(x,o)=>(d(),p("div",gl,[e("div",fl,[o[2]||(o[2]=e("h3",null,"ðŸ“ˆ å‰§æƒ…æ—¶é—´çº¿",-1)),e("button",{class:Z(["btn btn-secondary btn-sm",{loading:a.value}]),disabled:n.value||a.value,onClick:D},[a.value?(d(),p("span",bl)):M("",!0),ae(" "+$(a.value?"ç”Ÿæˆä¸­...":"ðŸ”„ é‡æ–°ç”Ÿæˆ"),1)],10,hl)]),u.value?(d(),p("div",kl," âš ï¸ "+$(u.value),1)):M("",!0),e("div",yl,[n.value?(d(),p("div",_l,[...o[3]||(o[3]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"åŠ è½½æ—¶é—´çº¿...",-1)])])):b.value?(d(),p(W,{key:2},[e("div",xl,[s.value?.stats?.total_arcs?(d(),p("span",Cl,"ðŸŽ­ "+$(s.value.stats.total_arcs)+" ä¸ªå‰§æƒ…å¼§",1)):M("",!0),e("span",Sl,"ðŸ“Š "+$(m.value)+" ä¸ªäº‹ä»¶",1),s.value?.stats?.total_characters?(d(),p("span",Pl,"ðŸ‘¥ "+$(s.value.stats.total_characters)+" ä¸ªè§’è‰²",1)):M("",!0),s.value?.stats?.total_threads?(d(),p("span",Il,"ðŸ”— "+$(s.value.stats.total_threads)+" æ¡çº¿ç´¢",1)):M("",!0),e("span",Rl,"ðŸ“„ "+$(f.value)+" é¡µ",1)]),U.value?(d(),p("div",Tl,[o[8]||(o[8]=e("h4",null,"ðŸ“– æ•…äº‹æ¦‚è¦",-1)),e("p",Al,$(U.value),1),s.value?.plot_threads?.length?(d(),p("div",Ul,[o[7]||(o[7]=e("span",null,"ä¸»é¢˜ï¼š",-1)),(d(!0),p(W,null,te(s.value.plot_threads.slice(0,5),r=>(d(),p("span",{key:r.id,class:"theme-tag"},$(r.name),1))),128))])):M("",!0)])):M("",!0),P.value.length>0?(d(),p("div",Bl,[o[9]||(o[9]=e("h4",null,"ðŸ‘¥ ä¸»è¦è§’è‰²",-1)),e("div",Ml,[(d(!0),p(W,null,te(P.value,r=>(d(),p("div",{key:r.name,class:"character-card",onClick:g=>q(r.first_appearance)},[e("div",El,$(r.name),1),e("div",zl,$(r.description),1),e("div",Dl,"é¦–æ¬¡å‡ºçŽ°ï¼šç¬¬ "+$(r.first_appearance)+" é¡µ",1)],8,Ll))),128))])])):M("",!0),k.value&&R.value.length>0?(d(),p("div",Vl,[...o[10]||(o[10]=[e("h4",null,"ðŸŽ­ å‰§æƒ…å‘å±•",-1)])])):M("",!0),k.value&&R.value.length>0?(d(),p("div",Ol,[(d(!0),p(W,null,te(R.value,(r,g)=>(d(),p("div",{key:r.id||r.name,class:Z(["timeline-group",{expanded:B(r.id||`arc-${g}`)}])},[e("div",Kl,[e("div",{class:"timeline-node-dot",onClick:S=>j(r.id||`arc-${g}`)},null,8,ql),o[11]||(o[11]=e("div",{class:"timeline-node-line"},null,-1))]),e("div",Fl,[e("div",{class:"timeline-card-header",onClick:S=>j(r.id||`arc-${g}`)},[e("img",{class:"timeline-thumbnail",src:F(r.page_range?.start||1),alt:`ç¬¬${r.page_range?.start||1}é¡µ`,loading:"lazy",onError:o[0]||(o[0]=S=>S.target.style.display="none"),onClick:fe(S=>q(r.page_range?.start||1),["stop"])},null,40,jl),e("div",Gl,[e("span",Ql," ç¬¬ "+$(r.page_range?.start||r.start_page||"?")+"-"+$(r.page_range?.end||r.end_page||"?")+" é¡µ ",1),e("span",Hl,$(r.name),1)]),e("span",Jl,$(B(r.id||`arc-${g}`)?"â–¼":"â–¶"),1)],8,Nl),r.description?(d(),p("div",Zl,$(r.description),1)):M("",!0),r.mood?(d(),p("div",Wl,[o[12]||(o[12]=e("span",{class:"label"},"ðŸŽ¨ æ°›å›´ï¼š",-1)),ae($(r.mood),1)])):M("",!0)])],2))),128))])):s.value?.groups&&s.value.groups.length>0?(d(),p("div",Xl,[(d(!0),p(W,null,te(s.value.groups,r=>(d(),p("div",{key:r.id,class:Z(["timeline-group",{expanded:B(r.id)}])},[e("div",Yl,[e("div",{class:"timeline-node-dot",onClick:g=>j(r.id)},null,8,eo),o[13]||(o[13]=e("div",{class:"timeline-node-line"},null,-1))]),e("div",to,[e("div",{class:"timeline-card-header",onClick:g=>j(r.id)},[e("img",{class:"timeline-thumbnail",src:F(r.thumbnail_page||r.page_range.start),alt:`ç¬¬${r.page_range.start}é¡µ`,loading:"lazy",onError:o[1]||(o[1]=g=>g.target.style.display="none"),onClick:fe(g=>q(r.page_range.start),["stop"])},null,40,no),e("div",ao,[e("span",lo," ç¬¬ "+$(r.page_range.start)+"-"+$(r.page_range.end)+" é¡µ ",1),e("span",oo,$(r.events.length)+" ä¸ªäº‹ä»¶",1)]),e("span",ro,$(B(r.id)?"â–¼":"â–¶"),1)],8,so),r.summary?(d(),p("div",io,$(r.summary),1)):M("",!0),B(r.id)&&r.events.length>0?(d(),p("ul",uo,[(d(!0),p(W,null,te(r.events,(g,S)=>(d(),p("li",{key:S,class:"timeline-event-item"},$(g),1))),128))])):M("",!0)])],2))),128))])):M("",!0),s.value?.plot_threads&&s.value.plot_threads.length>0?(d(),p("div",co,[o[14]||(o[14]=e("h4",null,"ðŸ”— ä¼ç¬”ä¸Žçº¿ç´¢",-1)),e("div",po,[(d(!0),p(W,null,te(s.value.plot_threads,r=>(d(),p("div",{key:r.id,class:Z(["plot-thread-item",{resolved:r.status==="å·²è§£å†³"}])},[e("div",vo,[e("span",mo,$(r.name||"æœªå‘½åçº¿ç´¢"),1),e("span",{class:Z(["thread-status",{resolved:r.status==="å·²è§£å†³"}])},$(r.status||"è¿›è¡Œä¸­"),3)]),r.description?(d(),p("p",go,$(r.description),1)):M("",!0),r.introduced_at?(d(),p("span",fo,"ç¬¬ "+$(r.introduced_at)+" é¡µå¼•å…¥",1)):M("",!0)],2))),128))])])):M("",!0),b.value?M("",!0):(d(),p("div",ho,' æš‚æ— è¯¦ç»†æ—¶é—´çº¿æ•°æ®ï¼Œç‚¹å‡»"é‡æ–°ç”Ÿæˆ"æŒ‰é’®ç”Ÿæˆ '))],64)):(d(),p("div",$l,[o[4]||(o[4]=e("div",{class:"empty-icon"},"ðŸ“ˆ",-1)),o[5]||(o[5]=e("h4",null,"æ—¶é—´çº¿å°šæœªç”Ÿæˆ",-1)),o[6]||(o[6]=e("p",null,"å®Œæˆæ¼«ç”»åˆ†æžåŽä¼šè‡ªåŠ¨ç”Ÿæˆæ—¶é—´çº¿ï¼Œæˆ–ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ‰‹åŠ¨ç”Ÿæˆ",-1)),e("button",{class:"btn btn-primary btn-sm",disabled:a.value,onClick:D},$(a.value?"ç”Ÿæˆä¸­...":"ç”Ÿæˆæ—¶é—´çº¿"),9,wl)]))])]))}}),ko=Se(bo,[["__scopeId","data-v-42a23730"]]),yo={class:"qa-container"},_o={key:0,class:"welcome-message"},$o={class:"message-avatar"},wo={key:0,src:Ys,alt:"ç”¨æˆ·",class:"avatar-img"},xo={key:0,class:"message-content"},Co={key:1,class:"message-content markdown-content"},So={key:0,class:"loading-dots"},Po={key:0,class:"answer-mode-badge"},Io=["innerHTML"],Ro={key:1,class:"message-citations"},To=["onClick"],Ao=["disabled","onClick"],Uo={class:"chat-input-container"},Bo={class:"chat-options"},Mo={class:"qa-mode-toggle",title:"ç²¾ç¡®æ¨¡å¼ï¼šä½¿ç”¨RAGæ£€ç´¢ç›¸å…³ç‰‡æ®µï¼›å…¨å±€æ¨¡å¼ï¼šä½¿ç”¨å…¨æ–‡æ‘˜è¦"},Lo={key:0,class:"precise-mode-options"},Eo={class:"checkbox-label compact",title:"å¯ç”¨çˆ¶å­å—æ¨¡å¼"},zo={class:"checkbox-label compact",title:"å¯ç”¨æŽ¨ç†æ£€ç´¢"},Do={class:"checkbox-label compact",title:"å¯ç”¨é‡æŽ’åº"},Vo={class:"input-label compact",title:"è¿”å›žçš„æœ€å¤§ç»“æžœæ•°"},Oo={class:"input-label compact",title:"ç›¸å…³æ€§é˜ˆå€¼"},Ko={key:1,class:"global-mode-hint"},qo={class:"welcome-examples"},Fo=["onClick"],No={class:"chat-input-wrapper"},jo=["disabled"],Go=["disabled"],Qo={key:0,class:"modal note-modal show"},Ho={class:"modal-content note-modal-content"},Jo={class:"modal-body"},Zo={key:0,class:"qa-preview"},Wo={class:"qa-preview-section"},Xo={class:"qa-preview-content"},Yo={class:"qa-preview-section"},er=["innerHTML"],tr={key:0,class:"qa-preview-section"},sr={class:"qa-preview-citations"},nr={class:"note-form"},ar={class:"form-group"},lr={class:"form-group"},or=ge({__name:"QAPanel",setup(l){const t=he(),n=h(""),a=h("precise"),s=h(!0),i=h(!0),u=h(!0),b=h(5),m=h(0),f=h(null),k=N(()=>t.qaHistory),P=N(()=>t.isStreaming),R=N(()=>a.value==="precise");function U(Q){a.value=Q}async function E(){const Q=n.value.trim();if(!Q||!t.currentBookId||P.value)return;n.value="",t.clearQAHistory(),t.addQAMessage({id:Date.now().toString(),role:"user",content:Q,timestamp:new Date().toISOString()}),await ps(),F();const I=a.value==="global"?"æ­£åœ¨åˆ†æžå…¨æ–‡...":"æ€è€ƒä¸­...";t.addQAMessage({id:(Date.now()+1).toString(),role:"assistant",content:I,timestamp:new Date().toISOString(),isLoading:!0}),t.setStreaming(!0);try{const w=await fn(t.currentBookId,Q,{use_parent_child:s.value,use_reasoning:i.value,use_reranker:u.value,top_k:b.value,threshold:m.value,use_global_context:a.value==="global"});if(t.removeLoadingMessages(),w.success){const z=w.mode==="global"?"ðŸŒ å…¨å±€æ¨¡å¼":"ðŸŽ¯ ç²¾ç¡®æ¨¡å¼";t.addQAMessage({id:(Date.now()+2).toString(),role:"assistant",content:w.answer||"",timestamp:new Date().toISOString(),mode:z,citations:w.citations||[]})}else t.addQAMessage({id:(Date.now()+2).toString(),role:"assistant",content:"æŠ±æ­‰ï¼Œå¤„ç†é—®é¢˜æ—¶å‡ºé”™: "+(w.error||"æœªçŸ¥é”™è¯¯"),timestamp:new Date().toISOString()})}catch(w){console.error("é—®ç­”è¯·æ±‚å¤±è´¥:",w),t.removeLoadingMessages(),t.addQAMessage({id:(Date.now()+2).toString(),role:"assistant",content:"æŠ±æ­‰ï¼Œç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•ã€‚",timestamp:new Date().toISOString()})}finally{t.setStreaming(!1),await ps(),F()}}function D(Q){Q.key==="Enter"&&!Q.shiftKey&&(Q.preventDefault(),E())}function F(){f.value&&(f.value.scrollTop=f.value.scrollHeight)}async function q(){if(t.currentBookId&&confirm(`ç¡®å®šè¦é‡å»ºå‘é‡ç´¢å¼•å—ï¼Ÿ

è¿™å°†åˆ é™¤çŽ°æœ‰çš„å‘é‡æ•°æ®å¹¶é‡æ–°æž„å»ºï¼Œå¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ã€‚`)){t.setLoading(!0);try{const Q=await hn(t.currentBookId);if(Q.success){let I="å‘é‡ç´¢å¼•é‡å»ºå®Œæˆ";Q.stats&&(I+=`
é¡µé¢å‘é‡: ${Q.stats.pages_count||0} æ¡`,Q.stats.dialogues_count&&(I+=`
å¯¹è¯å‘é‡: ${Q.stats.dialogues_count} æ¡`)),alert(I)}else alert("é‡å»ºå¤±è´¥: "+(Q.error||"æœªçŸ¥é”™è¯¯"))}catch(Q){console.error("é‡å»ºå‘é‡ç´¢å¼•å¤±è´¥:",Q),alert("é‡å»ºå‘é‡ç´¢å¼•å¤±è´¥")}finally{t.setLoading(!1)}}}function j(Q){return Q?oe.parse(Q):""}function B(Q){t.setCurrentPage(Q)}const x=["æ•…äº‹çš„ä¸»é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ","ä¸»è§’çš„æ€§æ ¼æœ‰ä»€ä¹ˆå˜åŒ–ï¼Ÿ","ç»“å±€æ˜¯æ€Žæ ·çš„ï¼Ÿ"];function o(Q){n.value=Q,E()}const r=h(!1),g=h(null),S=h(""),T=h("");function C(Q){if(!t.currentBookId)return;const w=t.qaHistory.find(z=>z.role==="user")?.content||"";g.value={messageId:Q.id,question:w,answer:Q.content,citations:Q.citations||[]},S.value="",T.value="",r.value=!0}function V(){r.value=!1,g.value=null}async function se(){if(!t.currentBookId||!g.value)return;const Q=new Date().toISOString(),I={id:Date.now().toString(),type:"qa",title:S.value||g.value.question.substring(0,30),content:g.value.answer,question:g.value.question,answer:g.value.answer,citations:g.value.citations,comment:T.value||void 0,createdAt:Q,updatedAt:Q};try{await t.addNote(I);const w=t.qaHistory.find(z=>z.id===g.value?.messageId);w&&(w.saved=!0),V()}catch(w){console.error("ä¿å­˜ç¬”è®°å¤±è´¥:",w),alert("ä¿å­˜ç¬”è®°å¤±è´¥")}}return qe(()=>{F()}),(Q,I)=>(d(),p("div",yo,[e("div",{ref_key:"messagesContainer",ref:f,class:"chat-messages"},[k.value.length===0?(d(),p("div",_o,[...I[10]||(I[10]=[e("div",{class:"welcome-icon"},"ðŸ’¬",-1),e("h3",null,"æ™ºèƒ½é—®ç­”",-1),e("p",null,"é’ˆå¯¹å·²åˆ†æžçš„æ¼«ç”»å†…å®¹æé—®ï¼ŒèŽ·å–ç²¾å‡†å›žç­”",-1)])])):M("",!0),(d(!0),p(W,null,te(k.value,w=>(d(),p("div",{key:w.id,class:Z(["chat-message",w.role])},[e("div",$o,[w.role==="user"?(d(),p("img",wo)):(d(),p(W,{key:1},[ae(" ðŸ¤– ")],64))]),w.role==="user"?(d(),p("div",xo,$(w.content),1)):(d(),p("div",Co,[w.isLoading?(d(),p("div",So,$(w.content),1)):(d(),p(W,{key:1},[w.mode?(d(),p("div",Po,$(w.mode),1)):M("",!0),e("div",{class:"answer-text",innerHTML:j(w.content)},null,8,Io),w.citations&&w.citations.length>0?(d(),p("div",Ro,[I[11]||(I[11]=e("span",null,"ðŸ“– å¼•ç”¨: ",-1)),(d(!0),p(W,null,te(w.citations,z=>(d(),p("span",{key:z.page,class:"citation-item",onClick:ne=>B(z.page)}," ç¬¬"+$(z.page)+"é¡µ ",9,To))),128))])):M("",!0),w.content&&!w.isLoading?(d(),p("button",{key:2,class:Z(["message-save-btn",{saved:w.saved}]),disabled:w.saved,onClick:z=>C(w)},$(w.saved?"âœ… å·²ä¿å­˜":"ðŸ“ ä¿å­˜ä¸ºç¬”è®°"),11,Ao)):M("",!0)],64))]))],2))),128))],512),e("div",Uo,[e("div",Bo,[e("div",Mo,[e("button",{type:"button",class:Z(["qa-mode-btn",{active:a.value==="precise"}]),onClick:I[0]||(I[0]=w=>U("precise"))}," ðŸŽ¯ ç²¾ç¡®æ¨¡å¼ ",2),e("button",{type:"button",class:Z(["qa-mode-btn",{active:a.value==="global"}]),onClick:I[1]||(I[1]=w=>U("global"))}," ðŸŒ å…¨å±€æ¨¡å¼ ",2)]),I[20]||(I[20]=e("span",{class:"chat-option-divider"},"|",-1)),R.value?(d(),p("div",Lo,[e("label",Eo,[K(e("input",{"onUpdate:modelValue":I[2]||(I[2]=w=>s.value=w),type:"checkbox"},null,512),[[it,s.value]]),I[12]||(I[12]=e("span",null,"çˆ¶å­å—æ¨¡å¼",-1))]),e("label",zo,[K(e("input",{"onUpdate:modelValue":I[3]||(I[3]=w=>i.value=w),type:"checkbox"},null,512),[[it,i.value]]),I[13]||(I[13]=e("span",null,"æŽ¨ç†æ£€ç´¢",-1))]),e("label",Do,[K(e("input",{"onUpdate:modelValue":I[4]||(I[4]=w=>u.value=w),type:"checkbox"},null,512),[[it,u.value]]),I[14]||(I[14]=e("span",null,"é‡æŽ’åº",-1))]),I[17]||(I[17]=e("span",{class:"chat-option-divider"},"|",-1)),e("label",Vo,[I[15]||(I[15]=e("span",null,"Top K:",-1)),K(e("input",{"onUpdate:modelValue":I[5]||(I[5]=w=>b.value=w),type:"number",min:"1",max:"20",class:"input-small"},null,512),[[G,b.value,void 0,{number:!0}]])]),e("label",Oo,[I[16]||(I[16]=e("span",null,"é˜ˆå€¼:",-1)),K(e("input",{"onUpdate:modelValue":I[6]||(I[6]=w=>m.value=w),type:"number",min:"0",max:"1",step:"0.1",class:"input-small"},null,512),[[G,m.value,void 0,{number:!0}]])]),I[18]||(I[18]=e("span",{class:"chat-option-divider"},"|",-1)),e("button",{type:"button",class:"btn btn-sm btn-secondary",title:"é‡å»ºå‘é‡ç´¢å¼•",onClick:q}," ðŸ”„ é‡å»ºå‘é‡ ")])):(d(),p("div",Ko,[I[19]||(I[19]=e("span",{class:"hint-text"},"ðŸ’¡ å…¨å±€æ¨¡å¼ä½¿ç”¨å…¨æ–‡æ‘˜è¦å›žç­”ï¼Œé€‚åˆæ€»ç»“æ€§é—®é¢˜",-1)),e("div",qo,[(d(),p(W,null,te(x,(w,z)=>e("span",{key:z,class:"example-tag",onClick:ne=>o(w)},$(w),9,Fo)),64))])]))]),e("div",No,[K(e("textarea",{"onUpdate:modelValue":I[7]||(I[7]=w=>n.value=w),placeholder:"è¾“å…¥ä½ çš„é—®é¢˜...",rows:"1",disabled:P.value,onKeydown:D},null,40,jo),[[G,n.value]]),e("button",{class:"send-btn",disabled:P.value||!n.value.trim(),onClick:E},[...I[21]||(I[21]=[e("span",null,"å‘é€",-1)])],8,Go)])]),r.value?(d(),p("div",Qo,[e("div",{class:"modal-overlay",onClick:V}),e("div",Ho,[e("div",{class:"modal-header"},[I[22]||(I[22]=e("h2",null,"ðŸ“ æ·»åŠ ç¬”è®°",-1)),e("button",{class:"modal-close",onClick:V},"Ã—")]),e("div",Jo,[g.value?(d(),p("div",Zo,[e("div",Wo,[I[23]||(I[23]=e("label",null,"é—®é¢˜",-1)),e("div",Xo,$(g.value.question),1)]),e("div",Yo,[I[24]||(I[24]=e("label",null,"å›žç­”",-1)),e("div",{class:"qa-preview-content",innerHTML:j(g.value.answer)},null,8,er)]),g.value.citations.length>0?(d(),p("div",tr,[I[25]||(I[25]=e("label",null,"å¼•ç”¨é¡µç ",-1)),e("div",sr,[(d(!0),p(W,null,te(g.value.citations,w=>(d(),p("span",{key:w.page,class:"qa-citation-badge"}," ç¬¬"+$(w.page)+"é¡µ ",1))),128))])])):M("",!0)])):M("",!0),e("div",nr,[e("div",ar,[I[26]||(I[26]=e("label",{for:"qaNoteTitle"},[ae("ç¬”è®°æ ‡é¢˜ "),e("span",{class:"optional"},"(å¯é€‰)")],-1)),K(e("input",{"onUpdate:modelValue":I[8]||(I[8]=w=>S.value=w),type:"text",id:"qaNoteTitle",class:"form-input",placeholder:"é»˜è®¤ä½¿ç”¨é—®é¢˜ä½œä¸ºæ ‡é¢˜..."},null,512),[[G,S.value]])]),e("div",lr,[I[27]||(I[27]=e("label",{for:"qaNoteComment"},[ae("è¡¥å……è¯´æ˜Ž "),e("span",{class:"optional"},"(å¯é€‰)")],-1)),K(e("textarea",{"onUpdate:modelValue":I[9]||(I[9]=w=>T.value=w),id:"qaNoteComment",class:"form-textarea",rows:"3",placeholder:"æ·»åŠ ä½ çš„è¯„è®ºæˆ–è¡¥å……..."},null,512),[[G,T.value]])])])]),e("div",{class:"modal-footer"},[e("button",{class:"btn btn-secondary",onClick:V},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",onClick:se},"ä¿å­˜ç¬”è®°")])])])):M("",!0)]))}}),rr=Se(or,[["__scopeId","data-v-0019a5fe"]]),ir={class:"workspace-section notes-section"},ur={class:"section-header-with-actions"},cr={class:"notes-filter"},dr={class:"notes-list"},pr={key:0,class:"placeholder-text"},vr=["onClick"],mr={class:"note-header"},gr={class:"note-type-icon"},fr={class:"note-date"},hr={class:"note-actions"},br=["onClick"],kr=["onClick"],yr={key:0,class:"note-title"},_r={key:1,class:"note-content"},$r={class:"qa-preview-text"},wr={key:2,class:"note-content"},xr={key:3,class:"note-tags"},Cr={key:4,class:"note-citations"},Sr=["onClick"],Pr={key:0,class:"citation-badge"},Ir={key:5,class:"note-page-link"},Rr=["onClick"],Tr={class:"modal-content modal-sm"},Ar={class:"modal-header"},Ur={class:"modal-body"},Br={class:"qa-note-view"},Mr={class:"qa-section"},Lr={class:"qa-content"},Er={class:"qa-section"},zr={class:"qa-content qa-answer"},Dr={key:0,class:"qa-section"},Vr={class:"qa-citations"},Or=["onClick"],Kr={key:1,class:"qa-section"},qr={class:"qa-content"},Fr={class:"form-group"},Nr={class:"form-group"},jr={class:"form-group"},Gr={class:"form-group"},Qr={class:"form-group"},Hr={class:"form-group"},Jr={class:"modal-footer"},Zr=["disabled"],Wr=ge({__name:"NotesPanel",setup(l){const t=[{label:"å…¨éƒ¨",value:"all"},{label:"æ–‡æœ¬ç¬”è®°",value:"text"},{label:"é—®ç­”ç¬”è®°",value:"qa"}],n=[{label:"æ–‡æœ¬ç¬”è®°",value:"text"},{label:"é—®ç­”ç¬”è®°",value:"qa"}],a=he(),s=h(!1),i=h(null),u=h(""),b=h(""),m=h("text"),f=h(null),k=h(""),P=N(()=>a.filteredNotes),R=N({get:()=>a.noteTypeFilter,set:r=>a.setNoteTypeFilter(r)});function U(){i.value=null,u.value="",b.value="",m.value="text",f.value=a.selectedPageNum,k.value="",s.value=!0}function E(r){i.value=r,u.value=r.title||"",b.value=r.content,m.value=r.type,f.value=r.pageNum||null,k.value=(r.tags||[]).join(", "),s.value=!0}function D(){s.value=!1,i.value=null,u.value="",b.value="",k.value=""}function F(r){return r.trim()?r.split(/[,ï¼Œ]/).map(g=>g.trim()).filter(g=>g):[]}async function q(){if(!b.value.trim())return;const r=F(k.value);if(i.value)await a.updateNote(i.value.id,{title:u.value||void 0,content:b.value,type:m.value,pageNum:f.value||void 0,tags:r.length>0?r:void 0});else{const g={id:Date.now().toString(),type:m.value,title:u.value||void 0,content:b.value,pageNum:f.value||void 0,tags:r.length>0?r:void 0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};await a.addNote(g)}D()}async function j(r){confirm("ç¡®å®šè¦åˆ é™¤è¿™æ¡ç¬”è®°å—ï¼Ÿ")&&await a.deleteNote(r)}function B(r){a.selectPage(r)}function x(r){return new Date(r).toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function o(r){return r==="qa"?"ðŸ’¬":"ðŸ“"}return(r,g)=>(d(),p("div",ir,[e("div",ur,[g[7]||(g[7]=e("h3",{class:"section-title"},"ðŸ“ ç¬”è®°",-1)),e("div",cr,[ie(xe,{modelValue:R.value,"onUpdate:modelValue":g[0]||(g[0]=S=>R.value=S),options:t},null,8,["modelValue"])])]),e("div",dr,[P.value.length===0?(d(),p("div",pr," æš‚æ— ç¬”è®° ")):M("",!0),(d(!0),p(W,null,te(P.value,S=>(d(),p("div",{key:S.id,class:Z(["note-item",{"qa-note":S.type==="qa"}]),onClick:T=>E(S)},[e("div",mr,[e("span",gr,$(o(S.type)),1),e("span",fr,$(x(S.createdAt)),1),e("div",hr,[e("button",{class:"btn-icon-sm",title:"ç¼–è¾‘",onClick:fe(T=>E(S),["stop"])}," âœï¸ ",8,br),e("button",{class:"btn-icon-sm",title:"åˆ é™¤",onClick:fe(T=>j(S.id),["stop"])}," ðŸ—‘ï¸ ",8,kr)])]),S.title?(d(),p("div",yr,$(S.title),1)):M("",!0),S.type==="qa"?(d(),p("div",_r,[e("div",$r,"Q: "+$(S.question?.substring(0,60))+"...",1)])):(d(),p("div",wr,$(S.content),1)),S.tags&&S.tags.length>0?(d(),p("div",xr,[(d(!0),p(W,null,te(S.tags,T=>(d(),p("span",{key:T,class:"note-tag"},$(T),1))),128))])):M("",!0),S.type==="qa"&&S.citations&&S.citations.length>0?(d(),p("div",Cr,[(d(!0),p(W,null,te(S.citations.slice(0,3),T=>(d(),p("span",{key:T.page,class:"citation-badge",onClick:fe(C=>B(T.page),["stop"])}," ç¬¬"+$(T.page)+"é¡µ ",9,Sr))),128)),S.citations.length>3?(d(),p("span",Pr,"+"+$(S.citations.length-3),1)):M("",!0)])):M("",!0),S.pageNum?(d(),p("div",Ir,[e("button",{class:"btn-link",onClick:fe(T=>B(S.pageNum),["stop"])}," ðŸ“„ ç¬¬ "+$(S.pageNum)+" é¡µ ",9,Rr)])):M("",!0)],10,vr))),128))]),e("button",{class:"btn btn-secondary btn-block btn-sm",onClick:U}," + æ·»åŠ ç¬”è®° "),s.value?(d(),p("div",{key:0,class:"modal show",onClick:fe(D,["self"])},[e("div",Tr,[e("div",Ar,[e("h3",null,$(i.value?"ç¼–è¾‘ç¬”è®°":"æ·»åŠ ç¬”è®°"),1),e("button",{class:"modal-close",onClick:D},"Ã—")]),e("div",Ur,[i.value&&i.value.type==="qa"?(d(),p(W,{key:0},[e("div",Br,[e("div",Mr,[g[8]||(g[8]=e("label",{class:"qa-label"},"é—®é¢˜",-1)),e("div",Lr,$(i.value.question),1)]),e("div",Er,[g[9]||(g[9]=e("label",{class:"qa-label"},"å›žç­”",-1)),e("div",zr,$(i.value.answer),1)]),i.value.citations&&i.value.citations.length>0?(d(),p("div",Dr,[g[10]||(g[10]=e("label",{class:"qa-label"},"å¼•ç”¨é¡µç ",-1)),e("div",Vr,[(d(!0),p(W,null,te(i.value.citations,S=>(d(),p("span",{key:S.page,class:"qa-citation-badge",onClick:T=>B(S.page)}," ç¬¬"+$(S.page)+"é¡µ ",9,Or))),128))])])):M("",!0),i.value.comment?(d(),p("div",Kr,[g[11]||(g[11]=e("label",{class:"qa-label"},"è¡¥å……è¯´æ˜Ž",-1)),e("div",qr,$(i.value.comment),1)])):M("",!0)]),e("div",Fr,[g[12]||(g[12]=e("label",null,[ae("ç¬”è®°æ ‡é¢˜ "),e("span",{class:"label-optional"},"(å¯é€‰)")],-1)),K(e("input",{"onUpdate:modelValue":g[1]||(g[1]=S=>u.value=S),type:"text",class:"form-input",placeholder:"ä¿®æ”¹æ ‡é¢˜..."},null,512),[[G,u.value]])])],64)):(d(),p(W,{key:1},[e("div",Nr,[g[13]||(g[13]=e("label",null,"ç¬”è®°ç±»åž‹",-1)),ie(xe,{modelValue:m.value,"onUpdate:modelValue":g[2]||(g[2]=S=>m.value=S),options:n},null,8,["modelValue"])]),e("div",jr,[g[14]||(g[14]=e("label",null,[ae("æ ‡é¢˜ "),e("span",{class:"label-optional"},"(å¯é€‰)")],-1)),K(e("input",{"onUpdate:modelValue":g[3]||(g[3]=S=>u.value=S),type:"text",class:"form-input",placeholder:"ç»™ç¬”è®°èµ·ä¸ªæ ‡é¢˜..."},null,512),[[G,u.value]])]),e("div",Gr,[g[15]||(g[15]=e("label",null,[ae("å†…å®¹ "),e("span",{class:"label-required"},"*")],-1)),K(e("textarea",{"onUpdate:modelValue":g[4]||(g[4]=S=>b.value=S),class:"form-textarea",rows:"5",placeholder:"å†™ä¸‹ä½ çš„æƒ³æ³•..."},null,512),[[G,b.value]])]),e("div",Qr,[g[16]||(g[16]=e("label",null,[ae("å…³è”é¡µç  "),e("span",{class:"label-optional"},"(å¯é€‰)")],-1)),K(e("input",{"onUpdate:modelValue":g[5]||(g[5]=S=>f.value=S),type:"number",class:"form-input",placeholder:"è¾“å…¥é¡µç ",min:"1"},null,512),[[G,f.value,void 0,{number:!0}]])]),e("div",Hr,[g[17]||(g[17]=e("label",null,[ae("æ ‡ç­¾ "),e("span",{class:"label-optional"},"(å¯é€‰)")],-1)),K(e("input",{"onUpdate:modelValue":g[6]||(g[6]=S=>k.value=S),type:"text",class:"form-input",placeholder:"å¤šä¸ªæ ‡ç­¾ç”¨é€—å·åˆ†éš”ï¼Œå¦‚: è§’è‰²,å‰§æƒ…"},null,512),[[G,k.value]])])],64))]),e("div",Jr,[e("button",{class:"btn btn-secondary",onClick:D},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",disabled:i.value?.type!=="qa"&&!b.value.trim(),onClick:q}," ä¿å­˜ ",8,Zr)])])])):M("",!0)]))}}),Xr=Se(Wr,[["__scopeId","data-v-45521d3c"]]),Yr={class:"workspace-section page-detail-section"},ei={class:"page-detail"},ti={key:0,class:"placeholder-text"},si={key:1,class:"loading-state"},ni={key:2,class:"page-detail-content"},ai={class:"page-detail-header"},li={class:"page-nav-buttons"},oi=["disabled"],ri={class:"page-indicator"},ii=["disabled"],ui={key:0,class:"error-message"},ci=["src","alt"],di={key:1,class:"page-summary"},pi={key:2,class:"page-summary empty"},vi={key:3,class:"scene-mood-info"},mi={key:0,class:"info-item"},gi={class:"info-value"},fi={key:1,class:"info-item"},hi={class:"info-value"},bi={key:4,class:"dialogues-section"},ki={class:"dialogue-speaker"},yi={class:"dialogue-text"},_i={key:0,class:"dialogue-original"},$i={key:5,class:"dialogues-section empty"},wi={class:"page-detail-actions"},xi=["disabled"],Ci={key:0,class:"btn-spinner"},Si=["disabled"],Pi=["src","alt"],Ii={class:"preview-nav"},Ri=["disabled"],Ti={class:"preview-page-info"},Ai=["disabled"],Ui=ge({__name:"PageDetail",setup(l){const t=he(),n=h(null),a=h(!1),s=h(!1),i=h(!1),u=h(""),b=N(()=>t.selectedPageNum),m=N(()=>t.totalPageCount),f=N(()=>b.value!==null&&b.value>1),k=N(()=>b.value!==null&&b.value<m.value),P=N(()=>!t.currentBookId||!b.value?"":un(t.currentBookId,b.value)),R=N(()=>{if(!n.value?.panels)return[];const T=[];for(const C of n.value.panels)if(C.dialogues)for(const V of C.dialogues){const se=V.translated_text||V.text;se&&T.push({speaker:V.speaker_name||V.character||"æœªçŸ¥",text:se,originalText:V.text!==V.translated_text?V.text:void 0})}return T}),U=N(()=>n.value?.analyzed===!0||!!n.value?.page_summary),E=N(()=>n.value?.scene||""),D=N(()=>n.value?.mood||"");async function F(){if(!t.currentBookId||!b.value){n.value=null;return}a.value=!0,u.value="";try{const T=await rn(t.currentBookId,b.value);T.success?T.analysis?n.value=T.analysis:T.page?n.value=T.page:n.value=null:(n.value=null,T.error&&(u.value=T.error))}catch(T){console.error("åŠ è½½é¡µé¢è¯¦æƒ…å¤±è´¥:",T),n.value=null,u.value=T instanceof Error?T.message:"åŠ è½½å¤±è´¥"}finally{a.value=!1}}function q(){f.value&&b.value&&t.selectPage(b.value-1)}function j(){k.value&&b.value&&t.selectPage(b.value+1)}async function B(){if(!(!t.currentBookId||!b.value)){s.value=!0,u.value="";try{const T=await on(t.currentBookId,b.value);T.success?await F():u.value=T.error||"é‡æ–°åˆ†æžå¤±è´¥"}catch(T){console.error("é‡æ–°åˆ†æžå¤±è´¥:",T),u.value=T instanceof Error?T.message:"é‡æ–°åˆ†æžå¤±è´¥"}finally{s.value=!1}}}function x(){i.value=!0}function o(){i.value=!1}function r(T){if(i.value)switch(T.key){case"Escape":o();break;case"ArrowLeft":f.value&&q();break;case"ArrowRight":k.value&&j();break}}const g=h(!1);async function S(){if(!(!t.currentBookId||!b.value||!n.value)){g.value=!0;try{let T=`# ç¬¬ ${b.value} é¡µåˆ†æžæ•°æ®

`;if(n.value.page_summary&&(T+=`## ðŸ“ é¡µé¢æ‘˜è¦

${n.value.page_summary}

`),n.value.scene&&(T+=`## ðŸŽ¬ åœºæ™¯

${n.value.scene}

`),n.value.mood&&(T+=`## ðŸŽ­ æ°›å›´

${n.value.mood}

`),R.value.length>0){T+=`## ðŸ’¬ å¯¹è¯å†…å®¹

`;for(const Q of R.value)T+=`**${Q.speaker}**: ${Q.text}

`,Q.originalText&&(T+=`> åŽŸæ–‡: ${Q.originalText}

`)}const C=new Blob([T],{type:"text/markdown"}),V=URL.createObjectURL(C),se=document.createElement("a");se.href=V,se.download=`${t.currentBookId}_page_${b.value}.md`,se.click(),URL.revokeObjectURL(V)}catch(T){console.error("å¯¼å‡ºé¡µé¢æ•°æ®å¤±è´¥:",T),u.value="å¯¼å‡ºå¤±è´¥"}finally{g.value=!1}}}return Be(b,()=>{F()},{immediate:!0}),(T,C)=>(d(),p("div",Yr,[C[12]||(C[12]=e("h3",{class:"section-title"},"ðŸ“„ é¡µé¢è¯¦æƒ…",-1)),e("div",ei,[b.value?a.value?(d(),p("div",si,[...C[3]||(C[3]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"åŠ è½½ä¸­...",-1)])])):(d(),p("div",ni,[e("div",ai,[e("h4",null,"ðŸ“„ ç¬¬ "+$(b.value)+" é¡µ",1),e("div",li,[e("button",{class:Z(["btn-page-nav",{disabled:!f.value}]),disabled:!f.value,title:"ä¸Šä¸€é¡µ (â†)",onClick:q}," â—€ ä¸Šä¸€å¼  ",10,oi),e("span",ri,$(b.value)+" / "+$(m.value),1),e("button",{class:Z(["btn-page-nav",{disabled:!k.value}]),disabled:!k.value,title:"ä¸‹ä¸€é¡µ (â†’)",onClick:j}," ä¸‹ä¸€å¼  â–¶ ",10,ii)])]),u.value?(d(),p("div",ui," âš ï¸ "+$(u.value),1)):M("",!0),e("div",{class:"page-detail-image",onClick:x},[e("img",{src:P.value,alt:`ç¬¬${b.value}é¡µ`,onError:C[0]||(C[0]=V=>V.target.style.display="none")},null,40,ci),C[4]||(C[4]=e("div",{class:"image-overlay"},[e("span",{class:"zoom-hint"},"ðŸ” ç‚¹å‡»æ”¾å¤§")],-1))]),e("div",{class:Z(["analysis-status-tag",{analyzed:U.value}])},$(U.value?"âœ“ å·²åˆ†æž":"â—‹ æœªåˆ†æž"),3),n.value?.page_summary?(d(),p("div",di,[C[5]||(C[5]=e("h5",null,"ðŸ“ é¡µé¢æ‘˜è¦",-1)),e("p",null,$(n.value.page_summary),1)])):(d(),p("div",pi,[...C[6]||(C[6]=[e("p",null,"æ­¤é¡µå°šæœªåˆ†æžï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹åˆ†æž",-1)])])),E.value||D.value?(d(),p("div",vi,[E.value?(d(),p("div",mi,[C[7]||(C[7]=e("span",{class:"info-label"},"ðŸŽ¬ åœºæ™¯ï¼š",-1)),e("span",gi,$(E.value),1)])):M("",!0),D.value?(d(),p("div",fi,[C[8]||(C[8]=e("span",{class:"info-label"},"ðŸŽ­ æ°›å›´ï¼š",-1)),e("span",hi,$(D.value),1)])):M("",!0)])):M("",!0),R.value.length>0?(d(),p("div",bi,[e("h5",null,"ðŸ’¬ å¯¹è¯å†…å®¹ ("+$(R.value.length)+")",1),(d(!0),p(W,null,te(R.value,(V,se)=>(d(),p("div",{key:se,class:"dialogue-item"},[e("div",ki,[C[9]||(C[9]=e("span",{class:"speaker-icon"},"ðŸ‘¤",-1)),ae(" "+$(V.speaker),1)]),e("div",yi,$(V.text),1),V.originalText?(d(),p("div",_i,[C[10]||(C[10]=e("span",{class:"original-label"},"åŽŸæ–‡ï¼š",-1)),ae($(V.originalText),1)])):M("",!0)]))),128))])):U.value?(d(),p("div",$i,[...C[11]||(C[11]=[e("p",null,"æ­¤é¡µæ²¡æœ‰æ£€æµ‹åˆ°å¯¹è¯å†…å®¹",-1)])])):M("",!0),e("div",wi,[e("button",{class:Z(["btn btn-secondary btn-sm",{loading:s.value}]),disabled:s.value,onClick:B},[s.value?(d(),p("span",Ci)):M("",!0),ae(" "+$(s.value?"åˆ†æžä¸­...":"ðŸ”„ é‡æ–°åˆ†æž"),1)],10,xi),U.value?(d(),p("button",{key:0,class:"btn btn-secondary btn-sm",disabled:g.value,onClick:S},$(g.value?"å¯¼å‡ºä¸­...":"ðŸ“„ å¯¼å‡ºæ­¤é¡µ"),9,Si)):M("",!0)])])):(d(),p("div",ti,[...C[2]||(C[2]=[e("div",{class:"empty-icon"},"ðŸ“„",-1),e("p",null,"ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ ‘ä¸­çš„é¡µé¢æŸ¥çœ‹è¯¦æƒ…",-1)])]))]),i.value?(d(),p("div",{key:0,class:"image-preview-modal",tabindex:"0",onClick:o,onKeydown:r},[e("div",{class:"image-preview-content",onClick:C[1]||(C[1]=fe(()=>{},["stop"]))},[e("button",{class:"preview-close",title:"å…³é—­ (Esc)",onClick:o},"Ã—"),e("img",{src:P.value,alt:`ç¬¬${b.value}é¡µ`},null,8,Pi),e("div",Ii,[e("button",{class:"preview-nav-btn prev",disabled:!f.value,title:"ä¸Šä¸€é¡µ (â†)",onClick:fe(q,["stop"])}," â—€ ",8,Ri),e("span",Ti,$(b.value)+" / "+$(m.value),1),e("button",{class:"preview-nav-btn next",disabled:!k.value,title:"ä¸‹ä¸€é¡µ (â†’)",onClick:fe(j,["stop"])}," â–¶ ",8,Ai)])])],32)):M("",!0)]))}}),Bi=Se(Ui,[["__scopeId","data-v-25a66086"]]),Mi={class:"sidebar-section pages-tree-section"},Li={class:"section-header"},Ei={class:"page-count-badge"},zi={class:"pages-tree"},Di={key:0,class:"empty-hint"},Vi={key:1,class:"tree-all-pages"},Oi=["data-page","onClick"],Ki=["src","alt"],qi={class:"tree-page-num"},Fi={key:2,class:"tree-load-more"},Ni=["onClick"],ji={class:"tree-chapter-info"},Gi={class:"tree-chapter-title"},Qi={class:"tree-chapter-meta"},Hi=["onClick"],Ji={class:"tree-pages-grid"},Zi=["data-page","onClick"],Wi=["src","alt"],Xi={class:"tree-page-num"},Yi=ge({__name:"PagesTree",setup(l){const t=he(),n=h(new Set),a=h(new Map),s=h(100),i=N(()=>t.chapters),u=N(()=>t.totalPageCount);function b(B){n.value.has(B)?n.value.delete(B):n.value.add(B)}function m(B){return n.value.has(B)}function f(B){t.selectPage(B)}function k(B){return a.value.get(B)||!1}function P(B){return t.selectedPageNum===B}function R(B,x){const o=[];for(let r=B;r<=x;r++)o.push(r);return o}function U(B){return t.currentBookId?Ss(t.currentBookId,B):""}function E(){s.value=Math.min(s.value+100,u.value)}function D(B){const x=B.target;x.style.opacity="0"}function F(B){const x=B.endPage-B.startPage+1;let o=0;for(let r=B.startPage;r<=B.endPage;r++)a.value.get(r)&&o++;return o===x}async function q(B){if(confirm("ç¡®å®šè¦é‡æ–°åˆ†æžæ­¤ç« èŠ‚å—ï¼Ÿ"))try{const o=await(await fetch(`/api/manga-insight/${t.currentBookId}/reanalyze/chapter/${B}`,{method:"POST"})).json();o.success?alert("ç« èŠ‚åˆ†æžå·²å¯åŠ¨"):alert("å¯åŠ¨å¤±è´¥: "+(o.error||"æœªçŸ¥é”™è¯¯"))}catch(x){console.error("é‡æ–°åˆ†æžç« èŠ‚å¤±è´¥:",x),alert("é‡æ–°åˆ†æžå¤±è´¥")}}async function j(){if(t.currentBookId)try{const x=await(await fetch(`/api/manga-insight/${t.currentBookId}/pages`)).json();x.success&&x.pages&&x.pages.forEach(r=>{a.value.set(r,!0)})}catch(B){console.error("åŠ è½½å·²åˆ†æžé¡µé¢å¤±è´¥:",B)}}return qe(async()=>{await j(),i.value.length>0&&i.value[0]&&n.value.add(i.value[0].id)}),Be(()=>t.analyzedPageCount,async(B,x)=>{B!==x&&B>0&&(console.log(`å·²åˆ†æžé¡µæ•°å˜åŒ–: ${x} -> ${B}ï¼Œåˆ·æ–°é¡µé¢æ ‡è®°`),a.value.clear(),await j())}),(B,x)=>(d(),p("div",Mi,[e("div",Li,[x[2]||(x[2]=e("h3",{class:"section-title"},"å†…å®¹å¯¼èˆª",-1)),e("span",Ei,$(u.value)+"é¡µ",1)]),e("div",zi,[i.value.length===0?(d(),p(W,{key:0},[u.value===0?(d(),p("div",Di," æš‚æ— é¡µé¢ ")):(d(),p("div",Vi,[(d(!0),p(W,null,te(R(1,Math.min(u.value,s.value)),o=>(d(),p("div",{key:o,class:Z(["tree-page-item",{selected:P(o),analyzed:k(o)}]),"data-page":o,onClick:r=>f(o)},[e("img",{src:U(o),alt:`ç¬¬${o}é¡µ`,class:"tree-page-thumb",loading:"lazy",onError:x[0]||(x[0]=r=>D(r))},null,40,Ki),e("span",qi,$(o),1)],10,Oi))),128))])),u.value>s.value?(d(),p("div",Fi,[e("button",{class:"btn-load-more",onClick:E}," åŠ è½½æ›´å¤š (è¿˜æœ‰ "+$(u.value-s.value)+" é¡µ) ",1)])):M("",!0)],64)):(d(!0),p(W,{key:1},te(i.value,o=>(d(),p("div",{key:o.id,class:Z(["tree-chapter",{expanded:m(o.id)}])},[e("div",{class:"tree-chapter-header",onClick:r=>b(o.id)},[x[3]||(x[3]=e("span",{class:"tree-expand-icon"},[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M8 5l8 7-8 7z"})])],-1)),e("div",ji,[e("span",Gi,$(o.title),1),e("span",Qi,$(o.endPage-o.startPage+1)+"é¡µ",1)]),e("span",{class:Z(["tree-chapter-status",{analyzed:F(o)}])},null,2),e("button",{class:"btn-reanalyze-chapter",title:"é‡æ–°åˆ†æžæ­¤ç« èŠ‚",onClick:fe(r=>q(o.id),["stop"])}," ðŸ”„ ",8,Hi)],8,Ni),e("div",Ji,[(d(!0),p(W,null,te(R(o.startPage,o.endPage),r=>(d(),p("div",{key:r,class:Z(["tree-page-item",{selected:P(r),analyzed:k(r)}]),"data-page":r,onClick:g=>f(r)},[e("img",{src:U(r),alt:`ç¬¬${r}é¡µ`,class:"tree-page-thumb",loading:"lazy",onError:x[1]||(x[1]=g=>D(g))},null,40,Wi),e("span",Xi,$(r),1)],10,Zi))),128))])],2))),128))])]))}}),eu=Se(Yi,[["__scopeId","data-v-3a1c7721"]]),Vs=[{value:"gemini",label:"Google Gemini"},{value:"openai",label:"OpenAI"},{value:"qwen",label:"é˜¿é‡Œé€šä¹‰åƒé—®"},{value:"siliconflow",label:"SiliconFlow"},{value:"deepseek",label:"DeepSeek"},{value:"volcano",label:"ç«å±±å¼•æ“Ž"},{value:"custom",label:"è‡ªå®šä¹‰ OpenAI å…¼å®¹"}],tu=[{value:"openai",label:"OpenAI"},{value:"siliconflow",label:"SiliconFlow"},{value:"custom",label:"è‡ªå®šä¹‰"}],su=[{value:"jina",label:"Jina AI"},{value:"cohere",label:"Cohere"},{value:"siliconflow",label:"SiliconFlow"},{value:"custom",label:"è‡ªå®šä¹‰"}],nu=[{value:"simple",label:"ç®€æ´æ¨¡å¼ - æ‰¹é‡åˆ†æž â†’ å…¨ä¹¦æ€»ç»“ï¼ˆçŸ­ç¯‡ï¼‰"},{value:"standard",label:"æ ‡å‡†æ¨¡å¼ - æ‰¹é‡åˆ†æž â†’ æ®µè½æ€»ç»“ â†’ å…¨ä¹¦æ€»ç»“"},{value:"chapter_based",label:"ç« èŠ‚æ¨¡å¼ - æ‰¹é‡åˆ†æž â†’ ç« èŠ‚æ€»ç»“ â†’ å…¨ä¹¦æ€»ç»“"},{value:"full",label:"å®Œæ•´æ¨¡å¼ - æ‰¹é‡åˆ†æž â†’ å°æ€»ç»“ â†’ ç« èŠ‚æ€»ç»“ â†’ å…¨ä¹¦æ€»ç»“"},{value:"custom",label:"è‡ªå®šä¹‰æ¨¡å¼ - å®Œå…¨è‡ªå®šä¹‰å±‚çº§æž¶æž„"}],au=[{value:"batch_analysis",label:"ðŸ“„ æ‰¹é‡åˆ†æžæç¤ºè¯"},{value:"segment_summary",label:"ðŸ“‘ æ®µè½æ€»ç»“æç¤ºè¯"},{value:"chapter_summary",label:"ðŸ“– ç« èŠ‚æ€»ç»“æç¤ºè¯"},{value:"qa_response",label:"ðŸ’¬ é—®ç­”å“åº”æç¤ºè¯"}],lu={gemini:"gemini-2.0-flash",openai:"gpt-4o",qwen:"qwen-vl-max",deepseek:"deepseek-chat",siliconflow:"Qwen/Qwen2.5-VL-72B-Instruct",volcano:"doubao-1.5-vision-pro-32k"},ou={gemini:"gemini-2.0-flash",openai:"gpt-4o-mini",qwen:"qwen-turbo",deepseek:"deepseek-chat",siliconflow:"Qwen/Qwen2.5-72B-Instruct",volcano:"doubao-1.5-pro-32k"},ru={openai:"text-embedding-3-small",siliconflow:"BAAI/bge-m3"},iu={jina:"jina-reranker-v2-base-multilingual",cohere:"rerank-multilingual-v3.0",siliconflow:"BAAI/bge-reranker-v2-m3"},Yt={simple:{name:"ç®€æ´æ¨¡å¼",description:"é€‚åˆ100é¡µä»¥å†…çš„çŸ­ç¯‡æ¼«ç”»",layers:[{name:"æ‰¹é‡åˆ†æž",units:5,align:!1},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]},standard:{name:"æ ‡å‡†æ¨¡å¼",description:"é€‚åˆå¤§å¤šæ•°æ¼«ç”»ï¼Œå¹³è¡¡æ•ˆæžœä¸Žé€Ÿåº¦",layers:[{name:"æ‰¹é‡åˆ†æž",units:5,align:!1},{name:"æ®µè½æ€»ç»“",units:5,align:!1},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]},chapter_based:{name:"ç« èŠ‚æ¨¡å¼",description:"é€‚åˆæœ‰æ˜Žç¡®ç« èŠ‚åˆ’åˆ†çš„æ¼«ç”»ï¼Œä¼šåœ¨ç« èŠ‚è¾¹ç•Œå¤„åˆ‡åˆ†",layers:[{name:"æ‰¹é‡åˆ†æž",units:5,align:!0},{name:"ç« èŠ‚æ€»ç»“",units:0,align:!0},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]},full:{name:"å®Œæ•´æ¨¡å¼",description:"é€‚åˆé•¿ç¯‡è¿žè½½ï¼Œæä¾›æœ€è¯¦ç»†çš„åˆ†å±‚æ€»ç»“",layers:[{name:"æ‰¹é‡åˆ†æž",units:5,align:!1},{name:"å°æ€»ç»“",units:5,align:!1},{name:"ç« èŠ‚æ€»ç»“",units:0,align:!0},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]}},kt=["siliconflow","deepseek","volcano","gemini","qwen","openai","custom"],uu=[{value:"openai",label:"OpenAI DALL-E"},{value:"siliconflow",label:"SiliconFlow"},{value:"qwen",label:"é˜¿é‡Œé€šä¹‰ä¸‡ç›¸"},{value:"volcano",label:"ç«å±±å¼•æ“Ž"},{value:"custom",label:"è‡ªå®šä¹‰ API"}],cu={openai:"dall-e-3",siliconflow:"stabilityai/stable-diffusion-3-5-large",qwen:"wanx-v1",volcano:"high_aes_general_v21"},du={openai:"https://api.openai.com/v1",siliconflow:"https://api.siliconflow.cn/v1",qwen:"https://dashscope.aliyuncs.com/api/v1",volcano:"https://visual.volcengineapi.com"},pu={class:"insight-settings-content"},vu={class:"form-group"},mu={class:"form-group"},gu={class:"form-group"},fu={class:"model-input-row"},hu=["disabled"],bu={key:0,class:"model-select-container"},ku=["value"],yu=["value"],_u={class:"model-count"},$u={key:0,class:"form-group"},wu={class:"form-row"},xu={class:"form-group"},Cu={class:"form-group"},Su={class:"form-group"},Pu={class:"checkbox-label"},Iu={class:"form-group"},Ru={class:"checkbox-label"},Tu={class:"form-group"},Au=["disabled"],Uu=ge({__name:"VlmSettingsTab",emits:["showMessage"],setup(l,{expose:t,emit:n}){const a=n,s=he(),i=h(!1),u=h(!1),b=h([]),m=h(!1),f=h(s.config.vlm.provider),k=h(s.config.vlm.apiKey),P=h(s.config.vlm.model),R=h(s.config.vlm.baseUrl),U=h(s.config.vlm.rpmLimit),E=h(s.config.vlm.temperature),D=h(s.config.vlm.forceJson),F=h(s.config.vlm.useStream),q=h(s.config.vlm.imageMaxSize),j=N(()=>f.value==="custom");function B(){const T=f.value;if(s.config.vlm.provider!==T&&(s.config.vlm.apiKey=k.value,s.config.vlm.model=P.value,s.config.vlm.baseUrl=R.value,s.config.vlm.rpmLimit=U.value,s.config.vlm.temperature=E.value,s.config.vlm.forceJson=D.value,s.config.vlm.useStream=F.value,s.config.vlm.imageMaxSize=q.value),s.setVlmProvider(T),k.value=s.config.vlm.apiKey,P.value=s.config.vlm.model,R.value=s.config.vlm.baseUrl,U.value=s.config.vlm.rpmLimit,E.value=s.config.vlm.temperature,D.value=s.config.vlm.forceJson,F.value=s.config.vlm.useStream,q.value=s.config.vlm.imageMaxSize,!P.value){const V=lu[T];V&&(P.value=V)}}async function x(){if(!k.value){a("showMessage","è¯·å…ˆå¡«å†™ API Key","error");return}if(!kt.includes(f.value)){a("showMessage",`${f.value} ä¸æ”¯æŒè‡ªåŠ¨èŽ·å–æ¨¡åž‹åˆ—è¡¨`,"error");return}if(f.value==="custom"&&!R.value){a("showMessage","è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL","error");return}const T=f.value==="custom"?"custom_openai":f.value;u.value=!0;try{const C=await ht(T,k.value,R.value||void 0);C.success&&C.models&&C.models.length>0?(b.value=C.models,m.value=!0,a("showMessage",`èŽ·å–åˆ° ${C.models.length} ä¸ªæ¨¡åž‹`,"success")):(a("showMessage",C.message||"æœªèŽ·å–åˆ°æ¨¡åž‹åˆ—è¡¨","error"),m.value=!1)}catch(C){a("showMessage","èŽ·å–æ¨¡åž‹åˆ—è¡¨å¤±è´¥: "+(C instanceof Error?C.message:"ç½‘ç»œé”™è¯¯"),"error"),m.value=!1}finally{u.value=!1}}function o(T){T&&(P.value=T)}async function r(){if(!i.value){i.value=!0;try{const T=await yn({provider:f.value,api_key:k.value,model:P.value,base_url:R.value||void 0});T.success?a("showMessage","VLM è¿žæŽ¥æˆåŠŸ","success"):a("showMessage","è¿žæŽ¥å¤±è´¥: "+(T.error||"æœªçŸ¥é”™è¯¯"),"error")}catch(T){a("showMessage","æµ‹è¯•å¤±è´¥: "+(T instanceof Error?T.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{i.value=!1}}}function g(){return{provider:f.value,apiKey:k.value,model:P.value,baseUrl:f.value==="custom"?R.value:"",rpmLimit:U.value,temperature:E.value,forceJson:D.value,useStream:F.value,imageMaxSize:q.value}}function S(){f.value=s.config.vlm.provider,k.value=s.config.vlm.apiKey,P.value=s.config.vlm.model,R.value=s.config.vlm.baseUrl,U.value=s.config.vlm.rpmLimit,E.value=s.config.vlm.temperature,D.value=s.config.vlm.forceJson,F.value=s.config.vlm.useStream,q.value=s.config.vlm.imageMaxSize}return t({getConfig:g,syncFromStore:S}),(T,C)=>(d(),p("div",pu,[C[25]||(C[25]=e("p",{class:"settings-hint"},"VLMï¼ˆè§†è§‰è¯­è¨€æ¨¡åž‹ï¼‰ç”¨äºŽåˆ†æžæ¼«ç”»å›¾ç‰‡å†…å®¹ï¼Œæå–å¯¹è¯å’Œåœºæ™¯ä¿¡æ¯ã€‚",-1)),e("div",vu,[C[10]||(C[10]=e("label",null,"æœåŠ¡å•†",-1)),ie(xe,{modelValue:f.value,"onUpdate:modelValue":C[0]||(C[0]=V=>f.value=V),options:pe(Vs),onChange:B},null,8,["modelValue","options"])]),e("div",mu,[C[11]||(C[11]=e("label",null,"API Key",-1)),K(e("input",{"onUpdate:modelValue":C[1]||(C[1]=V=>k.value=V),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[G,k.value]])]),e("div",gu,[C[13]||(C[13]=e("label",null,"æ¨¡åž‹",-1)),e("div",fu,[K(e("input",{"onUpdate:modelValue":C[2]||(C[2]=V=>P.value=V),type:"text",placeholder:"ä¾‹å¦‚: gemini-2.0-flash"},null,512),[[G,P.value]]),e("button",{class:"btn btn-secondary btn-sm fetch-btn",disabled:u.value,onClick:x},$(u.value?"èŽ·å–ä¸­...":"ðŸ” èŽ·å–æ¨¡åž‹"),9,hu)]),m.value&&b.value.length>0?(d(),p("div",bu,[e("select",{class:"model-select",value:P.value,onChange:C[3]||(C[3]=V=>o(V.target.value))},[C[12]||(C[12]=e("option",{value:""},"-- é€‰æ‹©æ¨¡åž‹ --",-1)),(d(!0),p(W,null,te(b.value,V=>(d(),p("option",{key:V.id,value:V.id},$(V.name||V.id),9,yu))),128))],40,ku),e("span",_u,"å…± "+$(b.value.length)+" ä¸ªæ¨¡åž‹",1)])):M("",!0)]),j.value?(d(),p("div",$u,[C[14]||(C[14]=e("label",null,"Base URL",-1)),K(e("input",{"onUpdate:modelValue":C[4]||(C[4]=V=>R.value=V),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[G,R.value]])])):M("",!0),e("div",wu,[e("div",xu,[C[15]||(C[15]=e("label",null,"RPM é™åˆ¶",-1)),K(e("input",{"onUpdate:modelValue":C[5]||(C[5]=V=>U.value=V),type:"number",min:"1",max:"100"},null,512),[[G,U.value,void 0,{number:!0}]]),C[16]||(C[16]=e("p",{class:"form-hint"},"æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ•°",-1))]),e("div",Cu,[C[17]||(C[17]=e("label",null,"æ¸©åº¦",-1)),K(e("input",{"onUpdate:modelValue":C[6]||(C[6]=V=>E.value=V),type:"number",min:"0",max:"1",step:"0.1"},null,512),[[G,E.value,void 0,{number:!0}]]),C[18]||(C[18]=e("p",{class:"form-hint"},"0-1ï¼Œè¶Šä½Žè¶Šç¡®å®š",-1))])]),e("div",Su,[e("label",Pu,[K(e("input",{"onUpdate:modelValue":C[7]||(C[7]=V=>D.value=V),type:"checkbox"},null,512),[[it,D.value]]),C[19]||(C[19]=e("span",null,"å¼ºåˆ¶ JSON è¾“å‡º",-1))]),C[20]||(C[20]=e("p",{class:"form-hint"},"å¯¹ OpenAI å…¼å®¹ API å¯ç”¨ response_format: json_object",-1))]),e("div",Iu,[e("label",Ru,[K(e("input",{"onUpdate:modelValue":C[8]||(C[8]=V=>F.value=V),type:"checkbox"},null,512),[[it,F.value]]),C[21]||(C[21]=e("span",null,"ä½¿ç”¨æµå¼è¯·æ±‚",-1))]),C[22]||(C[22]=e("p",{class:"form-hint"},"æµå¼è¯·æ±‚å¯é¿å…é•¿æ—¶é—´ç­‰å¾…å¯¼è‡´çš„è¶…æ—¶é—®é¢˜",-1))]),e("div",Tu,[C[23]||(C[23]=e("label",null,"å›¾ç‰‡åŽ‹ç¼©ï¼ˆæœ€å¤§è¾¹é•¿ï¼‰",-1)),K(e("input",{"onUpdate:modelValue":C[9]||(C[9]=V=>q.value=V),type:"number",min:"0",max:"4096",step:"128",placeholder:"0 è¡¨ç¤ºä¸åŽ‹ç¼©"},null,512),[[G,q.value,void 0,{number:!0}]]),C[24]||(C[24]=e("p",{class:"form-hint"},"å‘é€å‰å°†å›¾ç‰‡ç­‰æ¯”ä¾‹ç¼©æ”¾åˆ°æŒ‡å®šæœ€å¤§è¾¹é•¿ï¼ˆåƒç´ ï¼‰ï¼Œ0 è¡¨ç¤ºä¸åŽ‹ç¼©",-1))]),e("button",{class:"btn btn-secondary",disabled:i.value,onClick:r},$(i.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿žæŽ¥"),9,Au)]))}}),Bu={class:"insight-settings-content"},Mu={class:"form-group"},Lu={class:"form-group"},Eu={class:"form-group"},zu={class:"model-input-row"},Du=["disabled"],Vu={key:0,class:"model-select-container"},Ou=["value"],Ku=["value"],qu={class:"model-count"},Fu={key:0,class:"form-group"},Nu={class:"form-group"},ju={class:"checkbox-label"},Gu=["disabled"],Qu=ge({__name:"LlmSettingsTab",emits:["showMessage"],setup(l,{expose:t,emit:n}){const a=n,s=he(),i=h(!1),u=h(!1),b=h([]),m=h(!1),f=h(s.config.llm.provider),k=h(s.config.llm.apiKey),P=h(s.config.llm.model),R=h(s.config.llm.baseUrl),U=h(s.config.llm.useStream),E=N(()=>f.value==="custom");function D(){const o=f.value;if(s.config.llm.provider!==o&&(s.config.llm.apiKey=k.value,s.config.llm.model=P.value,s.config.llm.baseUrl=R.value,s.config.llm.useStream=U.value),s.setLlmProvider(o),k.value=s.config.llm.apiKey,P.value=s.config.llm.model,R.value=s.config.llm.baseUrl,U.value=s.config.llm.useStream,!P.value){const g=ou[o];g&&(P.value=g)}}async function F(){if(!k.value){a("showMessage","è¯·å…ˆå¡«å†™ API Key","error");return}if(!kt.includes(f.value)){a("showMessage",`${f.value} ä¸æ”¯æŒè‡ªåŠ¨èŽ·å–æ¨¡åž‹åˆ—è¡¨`,"error");return}if(f.value==="custom"&&!R.value){a("showMessage","è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL","error");return}const o=f.value==="custom"?"custom_openai":f.value;u.value=!0;try{const r=await ht(o,k.value,R.value||void 0);r.success&&r.models&&r.models.length>0?(b.value=r.models,m.value=!0,a("showMessage",`èŽ·å–åˆ° ${r.models.length} ä¸ªæ¨¡åž‹`,"success")):(a("showMessage",r.message||"æœªèŽ·å–åˆ°æ¨¡åž‹åˆ—è¡¨","error"),m.value=!1)}catch{a("showMessage","èŽ·å–æ¨¡åž‹åˆ—è¡¨å¤±è´¥","error"),m.value=!1}finally{u.value=!1}}function q(o){o&&(P.value=o)}async function j(){if(!i.value){i.value=!0;try{const o=await wn({provider:f.value,api_key:k.value,model:P.value,base_url:R.value||void 0});o.success?a("showMessage","LLM è¿žæŽ¥æˆåŠŸ","success"):a("showMessage","è¿žæŽ¥å¤±è´¥: "+(o.error||"æœªçŸ¥é”™è¯¯"),"error")}catch{a("showMessage","æµ‹è¯•å¤±è´¥","error")}finally{i.value=!1}}}function B(){return{useSameAsVlm:!1,provider:f.value,apiKey:k.value,model:P.value,baseUrl:f.value==="custom"?R.value:"",useStream:U.value}}function x(){f.value=s.config.llm.provider,k.value=s.config.llm.apiKey,P.value=s.config.llm.model,R.value=s.config.llm.baseUrl,U.value=s.config.llm.useStream}return t({getConfig:B,syncFromStore:x}),(o,r)=>(d(),p("div",Bu,[r[12]||(r[12]=e("p",{class:"settings-hint"},"LLMï¼ˆå¯¹è¯æ¨¡åž‹ï¼‰ç”¨äºŽç”Ÿæˆæ•…äº‹æ¦‚è¦ã€æ™ºèƒ½é—®ç­”ç­‰æ–‡æœ¬ç”Ÿæˆä»»åŠ¡ã€‚",-1)),e("div",Mu,[r[6]||(r[6]=e("label",null,"æœåŠ¡å•†",-1)),ie(xe,{modelValue:f.value,"onUpdate:modelValue":r[0]||(r[0]=g=>f.value=g),options:pe(Vs),onChange:D},null,8,["modelValue","options"])]),e("div",Lu,[r[7]||(r[7]=e("label",null,"API Key",-1)),K(e("input",{"onUpdate:modelValue":r[1]||(r[1]=g=>k.value=g),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[G,k.value]])]),e("div",Eu,[r[9]||(r[9]=e("label",null,"æ¨¡åž‹",-1)),e("div",zu,[K(e("input",{"onUpdate:modelValue":r[2]||(r[2]=g=>P.value=g),type:"text",placeholder:"ä¾‹å¦‚: gpt-4o-mini"},null,512),[[G,P.value]]),e("button",{class:"btn btn-secondary btn-sm fetch-btn",disabled:u.value,onClick:F},$(u.value?"èŽ·å–ä¸­...":"ðŸ” èŽ·å–æ¨¡åž‹"),9,Du)]),m.value&&b.value.length>0?(d(),p("div",Vu,[e("select",{class:"model-select",value:P.value,onChange:r[3]||(r[3]=g=>q(g.target.value))},[r[8]||(r[8]=e("option",{value:""},"-- é€‰æ‹©æ¨¡åž‹ --",-1)),(d(!0),p(W,null,te(b.value,g=>(d(),p("option",{key:g.id,value:g.id},$(g.name||g.id),9,Ku))),128))],40,Ou),e("span",qu,"å…± "+$(b.value.length)+" ä¸ªæ¨¡åž‹",1)])):M("",!0)]),E.value?(d(),p("div",Fu,[r[10]||(r[10]=e("label",null,"Base URL",-1)),K(e("input",{"onUpdate:modelValue":r[4]||(r[4]=g=>R.value=g),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[G,R.value]])])):M("",!0),e("div",Nu,[e("label",ju,[K(e("input",{"onUpdate:modelValue":r[5]||(r[5]=g=>U.value=g),type:"checkbox"},null,512),[[it,U.value]]),r[11]||(r[11]=e("span",null,"ä½¿ç”¨æµå¼è¯·æ±‚",-1))])]),e("button",{class:"btn btn-secondary",disabled:i.value,onClick:j},$(i.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿žæŽ¥"),9,Gu)]))}}),Hu={class:"insight-settings-content"},Ju={class:"form-group"},Zu={class:"form-hint"},Wu={class:"form-group"},Xu={class:"form-group"},Yu={class:"form-hint"},ec={key:0,style:{"margin-top":"16px"}},tc={style:{"margin-bottom":"8px"}},sc={style:{"min-width":"50px",color:"#666","font-size":"13px"}},nc=["value","disabled","onChange"],ac=["value","disabled","title","onChange"],lc={style:{display:"flex","flex-direction":"column","align-items":"center",gap:"2px","font-size":"11px",cursor:"pointer","min-width":"40px","text-align":"center"}},oc=["checked","onChange"],rc=["onClick"],ic={class:"batch-info-box"},uc={class:"layers-preview-list"},cc={key:0,class:"align-badge"},dc={class:"batch-estimate-box"},pc=ge({__name:"BatchSettingsTab",setup(l,{expose:t}){const n=he(),a=h(n.config.batch.pagesPerBatch),s=h(n.config.batch.contextBatchCount),i=h(n.config.batch.architecturePreset),u=h(n.config.batch.customLayers?.length>0?n.config.batch.customLayers.map(o=>({name:o.name,units:o.units_per_group??o.units??5,align:o.align_to_chapter??o.align??!1})):[{name:"æ‰¹é‡åˆ†æž",units:5,align:!1},{name:"æ®µè½æ€»ç»“",units:5,align:!1},{name:"å…¨ä¹¦æ€»ç»“",units:0,align:!1}]),b=N(()=>`æ¯æ‰¹æ¬¡åˆ†æž ${a.value||5} é¡µ`),m=N(()=>i.value==="custom"),f=N(()=>i.value==="custom"?"å®Œå…¨è‡ªå®šä¹‰å±‚çº§æž¶æž„ï¼Œçµæ´»é…ç½®åˆ†æžæµç¨‹":Yt[i.value]?.description||"æ ¹æ®æ¼«ç”»ç±»åž‹é€‰æ‹©åˆé€‚çš„åˆ†æžæž¶æž„"),k=N(()=>i.value==="custom"?u.value:Yt[i.value]?.layers||Yt.standard.layers);function P(){const o=u.value.length-1;u.value.splice(o,0,{name:`æ±‡æ€»å±‚${o}`,units:5,align:!1})}function R(o){o>0&&o<u.value.length-1&&u.value.splice(o,1)}function U(o,r,g){u.value[o]&&(u.value[o][r]=g,o===0&&r==="units"&&(a.value=g))}function E(){u.value.length>0&&u.value[0]&&(u.value[0].units=a.value)}function D(o){return o>0&&o<u.value.length-1&&u.value.length>2}function F(o){return o>0&&o<u.value.length-1}function q(o){return o<u.value.length-1}function j(o){return o===0?"æ¯æ‰¹åˆ†æžçš„é¡µæ•°":"æ¯ç»„åŒ…å«å•å…ƒæ•°ï¼ˆ0=å…¨éƒ¨æ±‡æ€»ï¼‰"}function B(){return{pagesPerBatch:a.value,contextBatchCount:s.value,architecturePreset:i.value,customLayers:u.value.map(o=>({name:o.name,units:o.units,align:o.align}))}}function x(){a.value=n.config.batch.pagesPerBatch,s.value=n.config.batch.contextBatchCount,i.value=n.config.batch.architecturePreset,n.config.batch.customLayers?.length>0&&(u.value=n.config.batch.customLayers.map(o=>({name:o.name,units:o.units_per_group??o.units??5,align:o.align_to_chapter??o.align??!1})))}return t({getConfig:B,syncFromStore:x}),(o,r)=>(d(),p("div",Hu,[r[13]||(r[13]=e("p",{class:"settings-hint"},"é…ç½®æ‰¹é‡åˆ†æžçš„å‚æ•°ï¼Œå½±å“åˆ†æžé€Ÿåº¦å’Œè´¨é‡ã€‚",-1)),e("div",Ju,[r[3]||(r[3]=e("label",null,"æ¯æ‰¹æ¬¡åˆ†æžé¡µæ•°",-1)),K(e("input",{"onUpdate:modelValue":r[0]||(r[0]=g=>a.value=g),type:"number",min:"1",max:"10",onChange:E},null,544),[[G,a.value,void 0,{number:!0}]]),e("p",Zu,"æ¯æ¬¡å‘é€ç»™ VLM çš„å›¾ç‰‡æ•°é‡ï¼Œå»ºè®® 3-5 å¼ ã€‚"+$(b.value),1)]),e("div",Wu,[r[4]||(r[4]=e("label",null,"ä¸Šæ–‡å‚è€ƒæ‰¹æ¬¡æ•°",-1)),K(e("input",{"onUpdate:modelValue":r[1]||(r[1]=g=>s.value=g),type:"number",min:"0",max:"5"},null,512),[[G,s.value,void 0,{number:!0}]]),r[5]||(r[5]=e("p",{class:"form-hint"},"æ¯æ‰¹åˆ†æžæ—¶å‚è€ƒå‰å‡ æ‰¹çš„ç»“æžœä½œä¸ºä¸Šä¸‹æ–‡ï¼Œ0 è¡¨ç¤ºä¸å‚è€ƒ",-1))]),e("div",Xu,[r[6]||(r[6]=e("label",null,"åˆ†æžæž¶æž„",-1)),ie(xe,{modelValue:i.value,"onUpdate:modelValue":r[2]||(r[2]=g=>i.value=g),options:pe(nu)},null,8,["modelValue","options"]),e("p",Yu,$(f.value),1)]),m.value?(d(),p("div",ec,[r[8]||(r[8]=e("label",{style:{display:"block","margin-bottom":"8px","font-weight":"500","font-size":"14px"}},"è‡ªå®šä¹‰å±‚çº§",-1)),e("div",tc,[(d(!0),p(W,null,te(u.value,(g,S)=>(d(),p("div",{key:S,style:{display:"flex","flex-direction":"row",gap:"8px","align-items":"center","margin-bottom":"8px",padding:"12px",background:"#f5f5f5","border-radius":"8px",border:"1px solid #e0e0e0"}},[e("span",sc,"ç¬¬"+$(S+1)+"å±‚",1),e("input",{type:"text",value:g.name,disabled:!F(S),placeholder:"å±‚çº§åç§°",style:{flex:"1",padding:"8px 12px",border:"1px solid #e0e0e0","border-radius":"6px","font-size":"14px"},onChange:T=>U(S,"name",T.target.value)},null,40,nc),e("input",{type:"number",value:g.units,disabled:!q(S),title:j(S),min:"0",max:"20",style:{width:"70px",padding:"8px 12px",border:"1px solid #e0e0e0","border-radius":"6px","font-size":"14px"},onChange:T=>U(S,"units",parseInt(T.target.value)||0)},null,40,ac),e("label",lc,[e("input",{type:"checkbox",checked:g.align,style:{width:"16px",height:"16px"},onChange:T=>U(S,"align",T.target.checked)},null,40,oc),r[7]||(r[7]=e("span",{style:{"line-height":"1.2"}},[ae("ç« èŠ‚"),e("br"),ae("å¯¹é½")],-1))]),D(S)?(d(),p("button",{key:0,type:"button",style:{padding:"6px 12px",background:"#ef4444",color:"white",border:"none","border-radius":"6px",cursor:"pointer","font-size":"13px","font-weight":"500"},onClick:T=>R(S)},"åˆ é™¤",8,rc)):M("",!0)]))),128))]),e("button",{type:"button",class:"btn btn-sm",style:{"margin-top":"4px",border:"1px solid #e0e0e0"},onClick:P},"+ æ·»åŠ å±‚çº§"),r[9]||(r[9]=e("p",{class:"form-hint"},"ç¬¬ä¸€å±‚å›ºå®šä¸ºæ‰¹é‡åˆ†æžï¼Œæœ€åŽä¸€å±‚å›ºå®šä¸ºå…¨ä¹¦æ€»ç»“ã€‚ä¸­é—´å¯æ·»åŠ ä»»æ„æ±‡æ€»å±‚çº§ã€‚",-1))])):M("",!0),e("div",ic,[r[10]||(r[10]=e("h4",null,"å½“å‰æž¶æž„é¢„è§ˆ",-1)),e("ul",uc,[(d(!0),p(W,null,te(k.value,(g,S)=>(d(),p("li",{key:S},[e("strong",null,"ç¬¬"+$(S+1)+"å±‚ - "+$(g.name),1),ae(" "+$(g.units>0?` - æ¯${g.units}ä¸ªå•å…ƒæ±‡æ€»`:" - æ±‡æ€»å…¨éƒ¨")+" ",1),g.align?(d(),p("span",cc,"(æŒ‰ç« èŠ‚å¯¹é½)")):M("",!0)]))),128))])]),e("div",dc,[e("p",null,[r[11]||(r[11]=ae("å½“å‰é…ç½®ï¼šæ¯ ",-1)),e("strong",null,$(a.value),1),r[12]||(r[12]=ae(" é¡µä¸€æ‰¹",-1))])])]))}}),vc={class:"insight-settings-content"},mc={class:"form-group"},gc={class:"form-group"},fc={class:"form-group"},hc={class:"model-input-row"},bc=["disabled"],kc={key:0,class:"model-select-container"},yc=["value"],_c=["value"],$c={class:"model-count"},wc={key:0,class:"form-group"},xc={class:"form-group"},Cc=["disabled"],Sc=ge({__name:"EmbeddingSettingsTab",emits:["showMessage"],setup(l,{expose:t,emit:n}){const a=n,s=he(),i=h(!1),u=h(!1),b=h([]),m=h(!1),f=h(s.config.embedding.provider),k=h(s.config.embedding.apiKey),P=h(s.config.embedding.model),R=h(s.config.embedding.baseUrl),U=h(s.config.embedding.rpmLimit),E=N(()=>f.value==="custom");function D(){const o=f.value;if(s.config.embedding.provider!==o&&(s.config.embedding.apiKey=k.value,s.config.embedding.model=P.value,s.config.embedding.baseUrl=R.value,s.config.embedding.rpmLimit=U.value),s.setEmbeddingProvider(o),k.value=s.config.embedding.apiKey,P.value=s.config.embedding.model,R.value=s.config.embedding.baseUrl,U.value=s.config.embedding.rpmLimit,!P.value){const g=ru[o];g&&(P.value=g)}}async function F(){if(!k.value){a("showMessage","è¯·å…ˆå¡«å†™ API Key","error");return}if(!kt.includes(f.value)){a("showMessage",`${f.value} ä¸æ”¯æŒè‡ªåŠ¨èŽ·å–æ¨¡åž‹åˆ—è¡¨`,"error");return}if(f.value==="custom"&&!R.value){a("showMessage","è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL","error");return}const o=f.value==="custom"?"custom_openai":f.value;u.value=!0;try{const r=await ht(o,k.value,R.value||void 0);r.success&&r.models?.length?(b.value=r.models,m.value=!0,a("showMessage",`èŽ·å–åˆ° ${r.models.length} ä¸ªæ¨¡åž‹`,"success")):(a("showMessage",r.message||"æœªèŽ·å–åˆ°æ¨¡åž‹åˆ—è¡¨","error"),m.value=!1)}catch{a("showMessage","èŽ·å–æ¨¡åž‹åˆ—è¡¨å¤±è´¥","error"),m.value=!1}finally{u.value=!1}}function q(o){o&&(P.value=o)}async function j(){if(!i.value){i.value=!0;try{const o=await _n({provider:f.value,api_key:k.value,model:P.value,base_url:R.value||void 0});a("showMessage",o.success?"Embedding è¿žæŽ¥æˆåŠŸ":"è¿žæŽ¥å¤±è´¥: "+(o.error||"æœªçŸ¥é”™è¯¯"),o.success?"success":"error")}catch{a("showMessage","æµ‹è¯•å¤±è´¥","error")}finally{i.value=!1}}}function B(){return{provider:f.value,apiKey:k.value,model:P.value,baseUrl:f.value==="custom"?R.value:"",rpmLimit:U.value}}function x(){f.value=s.config.embedding.provider,k.value=s.config.embedding.apiKey,P.value=s.config.embedding.model,R.value=s.config.embedding.baseUrl,U.value=s.config.embedding.rpmLimit}return t({getConfig:B,syncFromStore:x}),(o,r)=>(d(),p("div",vc,[r[13]||(r[13]=e("p",{class:"settings-hint"},"Embeddingï¼ˆå‘é‡åŒ–æ¨¡åž‹ï¼‰ç”¨äºŽå°†æ–‡æœ¬è½¬æ¢ä¸ºå‘é‡ï¼Œæ”¯æŒè¯­ä¹‰æœç´¢å’Œé—®ç­”åŠŸèƒ½ã€‚",-1)),e("div",mc,[r[6]||(r[6]=e("label",null,"æœåŠ¡å•†",-1)),ie(xe,{modelValue:f.value,"onUpdate:modelValue":r[0]||(r[0]=g=>f.value=g),options:pe(tu),onChange:D},null,8,["modelValue","options"])]),e("div",gc,[r[7]||(r[7]=e("label",null,"API Key",-1)),K(e("input",{"onUpdate:modelValue":r[1]||(r[1]=g=>k.value=g),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[G,k.value]])]),e("div",fc,[r[9]||(r[9]=e("label",null,"æ¨¡åž‹",-1)),e("div",hc,[K(e("input",{"onUpdate:modelValue":r[2]||(r[2]=g=>P.value=g),type:"text",placeholder:"ä¾‹å¦‚: text-embedding-3-small"},null,512),[[G,P.value]]),e("button",{class:"btn btn-secondary btn-sm fetch-btn",disabled:u.value,onClick:F},$(u.value?"èŽ·å–ä¸­...":"ðŸ” èŽ·å–æ¨¡åž‹"),9,bc)]),m.value&&b.value.length>0?(d(),p("div",kc,[e("select",{class:"model-select",value:P.value,onChange:r[3]||(r[3]=g=>q(g.target.value))},[r[8]||(r[8]=e("option",{value:""},"-- é€‰æ‹©æ¨¡åž‹ --",-1)),(d(!0),p(W,null,te(b.value,g=>(d(),p("option",{key:g.id,value:g.id},$(g.name||g.id),9,_c))),128))],40,yc),e("span",$c,"å…± "+$(b.value.length)+" ä¸ªæ¨¡åž‹",1)])):M("",!0)]),E.value?(d(),p("div",wc,[r[10]||(r[10]=e("label",null,"Base URL",-1)),K(e("input",{"onUpdate:modelValue":r[4]||(r[4]=g=>R.value=g),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[G,R.value]])])):M("",!0),e("div",xc,[r[11]||(r[11]=e("label",null,"RPM é™åˆ¶",-1)),K(e("input",{"onUpdate:modelValue":r[5]||(r[5]=g=>U.value=g),type:"number",min:"0",max:"1000"},null,512),[[G,U.value,void 0,{number:!0}]]),r[12]||(r[12]=e("p",{class:"form-hint"},"æ¯åˆ†é’Ÿæœ€å¤§è¯·æ±‚æ•°ï¼Œ0 è¡¨ç¤ºä¸é™åˆ¶",-1))]),e("button",{class:"btn btn-secondary",disabled:i.value,onClick:j},$(i.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿žæŽ¥"),9,Cc)]))}}),Pc={class:"insight-settings-content"},Ic={class:"form-group"},Rc={class:"form-group"},Tc={class:"form-group"},Ac={class:"model-input-row"},Uc=["disabled"],Bc={key:0,class:"model-select-container"},Mc=["value"],Lc=["value"],Ec={class:"model-count"},zc={key:0,class:"form-group"},Dc={class:"form-group"},Vc=["disabled"],Oc=ge({__name:"RerankerSettingsTab",emits:["showMessage"],setup(l,{expose:t,emit:n}){const a=n,s=he(),i=h(!1),u=h(!1),b=h([]),m=h(!1),f=h(s.config.reranker.provider),k=h(s.config.reranker.apiKey),P=h(s.config.reranker.model),R=h(s.config.reranker.baseUrl),U=h(s.config.reranker.topK),E=N(()=>f.value==="custom");function D(){const o=f.value;if(s.config.reranker.provider!==o&&(s.config.reranker.apiKey=k.value,s.config.reranker.model=P.value,s.config.reranker.baseUrl=R.value,s.config.reranker.topK=U.value),s.setRerankerProvider(o),k.value=s.config.reranker.apiKey,P.value=s.config.reranker.model,R.value=s.config.reranker.baseUrl,U.value=s.config.reranker.topK,!P.value){const g=iu[o];g&&(P.value=g)}}async function F(){if(!k.value){a("showMessage","è¯·å…ˆå¡«å†™ API Key","error");return}if(!kt.includes(f.value)){a("showMessage",`${f.value} ä¸æ”¯æŒè‡ªåŠ¨èŽ·å–æ¨¡åž‹åˆ—è¡¨`,"error");return}if(f.value==="custom"&&!R.value){a("showMessage","è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL","error");return}const o=f.value==="custom"?"custom_openai":f.value;u.value=!0;try{const r=await ht(o,k.value,R.value||void 0);r.success&&r.models?.length?(b.value=r.models,m.value=!0,a("showMessage",`èŽ·å–åˆ° ${r.models.length} ä¸ªæ¨¡åž‹`,"success")):(a("showMessage",r.message||"æœªèŽ·å–åˆ°æ¨¡åž‹åˆ—è¡¨","error"),m.value=!1)}catch{a("showMessage","èŽ·å–æ¨¡åž‹åˆ—è¡¨å¤±è´¥","error"),m.value=!1}finally{u.value=!1}}function q(o){o&&(P.value=o)}async function j(){if(!i.value){i.value=!0;try{const o=await $n({provider:f.value,api_key:k.value,model:P.value,base_url:R.value||void 0});a("showMessage",o.success?"Reranker è¿žæŽ¥æˆåŠŸ":"è¿žæŽ¥å¤±è´¥: "+(o.error||"æœªçŸ¥é”™è¯¯"),o.success?"success":"error")}catch{a("showMessage","æµ‹è¯•å¤±è´¥","error")}finally{i.value=!1}}}function B(){return{provider:f.value,apiKey:k.value,model:P.value,baseUrl:f.value==="custom"?R.value:"",topK:U.value}}function x(){f.value=s.config.reranker.provider,k.value=s.config.reranker.apiKey,P.value=s.config.reranker.model,R.value=s.config.reranker.baseUrl,U.value=s.config.reranker.topK}return t({getConfig:B,syncFromStore:x}),(o,r)=>(d(),p("div",Pc,[r[13]||(r[13]=e("p",{class:"settings-hint"},"Rerankerï¼ˆé‡æŽ’åºæ¨¡åž‹ï¼‰ç”¨äºŽå¯¹æœç´¢ç»“æžœè¿›è¡Œé‡æ–°æŽ’åºï¼Œæé«˜é—®ç­”å‡†ç¡®æ€§ã€‚",-1)),e("div",Ic,[r[6]||(r[6]=e("label",null,"æœåŠ¡å•†",-1)),ie(xe,{modelValue:f.value,"onUpdate:modelValue":r[0]||(r[0]=g=>f.value=g),options:pe(su),onChange:D},null,8,["modelValue","options"])]),e("div",Rc,[r[7]||(r[7]=e("label",null,"API Key",-1)),K(e("input",{"onUpdate:modelValue":r[1]||(r[1]=g=>k.value=g),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[G,k.value]])]),e("div",Tc,[r[9]||(r[9]=e("label",null,"æ¨¡åž‹",-1)),e("div",Ac,[K(e("input",{"onUpdate:modelValue":r[2]||(r[2]=g=>P.value=g),type:"text",placeholder:"ä¾‹å¦‚: jina-reranker-v2-base-multilingual"},null,512),[[G,P.value]]),e("button",{class:"btn btn-secondary btn-sm fetch-btn",disabled:u.value,onClick:F},$(u.value?"èŽ·å–ä¸­...":"ðŸ” èŽ·å–æ¨¡åž‹"),9,Uc)]),m.value&&b.value.length>0?(d(),p("div",Bc,[e("select",{class:"model-select",value:P.value,onChange:r[3]||(r[3]=g=>q(g.target.value))},[r[8]||(r[8]=e("option",{value:""},"-- é€‰æ‹©æ¨¡åž‹ --",-1)),(d(!0),p(W,null,te(b.value,g=>(d(),p("option",{key:g.id,value:g.id},$(g.name||g.id),9,Lc))),128))],40,Mc),e("span",Ec,"å…± "+$(b.value.length)+" ä¸ªæ¨¡åž‹",1)])):M("",!0)]),E.value?(d(),p("div",zc,[r[10]||(r[10]=e("label",null,"Base URL",-1)),K(e("input",{"onUpdate:modelValue":r[4]||(r[4]=g=>R.value=g),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[G,R.value]])])):M("",!0),e("div",Dc,[r[11]||(r[11]=e("label",null,"Top K",-1)),K(e("input",{"onUpdate:modelValue":r[5]||(r[5]=g=>U.value=g),type:"number",min:"1",max:"20"},null,512),[[G,U.value,void 0,{number:!0}]]),r[12]||(r[12]=e("p",{class:"form-hint"},"é‡æŽ’åºåŽè¿”å›žçš„ç»“æžœæ•°é‡",-1))]),e("button",{class:"btn btn-secondary",disabled:i.value,onClick:j},$(i.value?"æµ‹è¯•ä¸­...":"æµ‹è¯•è¿žæŽ¥"),9,Vc)]))}}),Kc={class:"insight-settings-content prompts-settings"},qc={class:"form-group"},Fc={class:"form-hint"},Nc={class:"form-group"},jc={class:"prompts-library-section"},Gc={class:"library-header"},Qc={class:"library-actions"},Hc={class:"saved-prompts-list"},Jc={key:0,class:"loading-text"},Zc={key:1,class:"placeholder-text"},Wc=["onClick"],Xc={class:"prompt-name"},Yc={class:"prompt-type-badge"},ed=["onClick"],td=ge({__name:"PromptsSettingsTab",emits:["showMessage"],setup(l,{expose:t,emit:n}){const a=n,s=he(),i=h("batch_analysis"),u=h(""),b=h({}),m=h([]),f=h(!1),k=h({batch_analysis:"",segment_summary:"",chapter_summary:"",qa_response:""});async function P(){try{const S=await xn();S.success&&S.prompts&&(k.value=S.prompts)}catch(S){console.error("åŠ è½½é»˜è®¤æç¤ºè¯å¤±è´¥:",S)}}async function R(){f.value=!0;try{const S=await Cn();S.success&&S.library&&(m.value=S.library)}catch{m.value=[]}finally{f.value=!1}}function U(){confirm("ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯å—ï¼Ÿå½“å‰ç¼–è¾‘çš„å†…å®¹å°†ä¸¢å¤±ã€‚")&&(u.value=k.value[i.value]||"",delete b.value[i.value],a("showMessage","å·²é‡ç½®ä¸ºé»˜è®¤æç¤ºè¯","success"))}async function E(){try{await navigator.clipboard.writeText(u.value),a("showMessage","å·²å¤åˆ¶åˆ°å‰ªè´´æ¿","success")}catch{a("showMessage","å¤åˆ¶å¤±è´¥","error")}}async function D(){const S=u.value.trim();if(!S){a("showMessage","æç¤ºè¯å†…å®¹ä¸èƒ½ä¸ºç©º","error");return}const T=prompt("è¯·è¾“å…¥æç¤ºè¯åç§°ï¼š");if(!T?.trim())return;const C={id:Date.now().toString(),name:T.trim(),type:i.value,content:S,created_at:new Date().toISOString()};try{(await Sn(C)).success?(m.value.push(C),a("showMessage","æç¤ºè¯å·²ä¿å­˜åˆ°åº“","success")):a("showMessage","ä¿å­˜å¤±è´¥","error")}catch{a("showMessage","ä¿å­˜å¤±è´¥","error")}}function F(S){i.value=S.type,u.value=S.content,b.value[S.type]=S.content,a("showMessage",`å·²åŠ è½½æç¤ºè¯: ${S.name}`,"success")}async function q(S){if(confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæç¤ºè¯å—ï¼Ÿ"))try{(await Pn(S)).success?(m.value=m.value.filter(C=>C.id!==S),a("showMessage","æç¤ºè¯å·²åˆ é™¤","success")):a("showMessage","åˆ é™¤å¤±è´¥","error")}catch{a("showMessage","åˆ é™¤å¤±è´¥","error")}}function j(){u.value&&(b.value[i.value]=u.value);const S={version:"1.0",exported_at:new Date().toISOString(),prompts:b.value,library:m.value},T=new Blob([JSON.stringify(S,null,2)],{type:"application/json"}),C=URL.createObjectURL(T),V=document.createElement("a");V.href=C,V.download=`manga-insight-prompts-${new Date().toISOString().slice(0,10)}.json`,V.click(),URL.revokeObjectURL(C),a("showMessage","æç¤ºè¯å·²å¯¼å‡º","success")}function B(){document.getElementById("promptsFileInput")?.click()}async function x(S){const T=S.target,C=T.files?.[0];if(C){try{const V=await C.text(),se=JSON.parse(V);if(se.prompts&&(b.value={...b.value,...se.prompts}),se.library&&Array.isArray(se.library)){const Q=new Set(m.value.map(I=>I.id));for(const I of se.library)Q.has(I.id)||m.value.push(I);await In(m.value)}a("showMessage","æç¤ºè¯å¯¼å…¥æˆåŠŸ","success")}catch{a("showMessage","å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼","error")}T.value=""}}Be(i,(S,T)=>{T&&u.value&&(b.value[T]=u.value),S&&(u.value=b.value[S]||k.value[S]||"")});function o(){return u.value&&(b.value[i.value]=u.value),b.value}function r(){s.config.prompts?b.value={...s.config.prompts}:b.value={},u.value=b.value[i.value]||k.value[i.value]||""}async function g(){await P(),await R()}return qe(g),t({getCustomPrompts:o,syncFromStore:r,initialize:g}),(S,T)=>(d(),p("div",Kc,[T[5]||(T[5]=e("p",{class:"settings-hint"},"è‡ªå®šä¹‰åˆ†æžè¿‡ç¨‹ä¸­ä½¿ç”¨çš„æç¤ºè¯æ¨¡æ¿ã€‚",-1)),e("div",qc,[T[2]||(T[2]=e("label",null,"æç¤ºè¯ç±»åž‹",-1)),ie(xe,{modelValue:i.value,"onUpdate:modelValue":T[0]||(T[0]=C=>i.value=C),options:pe(au)},null,8,["modelValue","options"]),e("p",Fc,$(vs[i.value]?.hint),1)]),e("div",Nc,[T[3]||(T[3]=e("label",null,"æç¤ºè¯å†…å®¹",-1)),K(e("textarea",{"onUpdate:modelValue":T[1]||(T[1]=C=>u.value=C),class:"prompt-editor",rows:"12",placeholder:"è¾“å…¥æç¤ºè¯å†…å®¹..."},null,512),[[G,u.value]])]),e("div",{class:"prompt-actions-bar"},[e("button",{class:"btn btn-secondary btn-sm",onClick:U,title:"é‡ç½®ä¸ºé»˜è®¤"},"ðŸ”„ é‡ç½®"),e("button",{class:"btn btn-secondary btn-sm",onClick:E,title:"å¤åˆ¶åˆ°å‰ªè´´æ¿"},"ðŸ“‹ å¤åˆ¶"),e("button",{class:"btn btn-primary btn-sm",onClick:D,title:"ä¿å­˜åˆ°åº“"},"ðŸ’¾ ä¿å­˜åˆ°åº“")]),T[6]||(T[6]=e("hr",{class:"section-divider"},null,-1)),e("div",jc,[e("div",Gc,[T[4]||(T[4]=e("h4",null,"ðŸ“š æç¤ºè¯åº“",-1)),e("div",Qc,[e("button",{class:"btn btn-secondary btn-sm",onClick:j,title:"å¯¼å‡ºæ‰€æœ‰æç¤ºè¯"},"ðŸ“¤ å¯¼å‡º"),e("button",{class:"btn btn-secondary btn-sm",onClick:B,title:"å¯¼å…¥æç¤ºè¯"},"ðŸ“¥ å¯¼å…¥"),e("input",{id:"promptsFileInput",type:"file",accept:".json",style:{display:"none"},onChange:x},null,32)])]),e("div",Hc,[f.value?(d(),p("div",Jc,"åŠ è½½ä¸­...")):m.value.length===0?(d(),p("div",Zc,"æš‚æ— ä¿å­˜çš„æç¤ºè¯")):(d(!0),p(W,{key:2},te(m.value,C=>(d(),p("div",{key:C.id,class:"saved-prompt-item",onClick:V=>F(C)},[e("span",Xc,$(C.name),1),e("span",Yc,$(vs[C.type]?.label||C.type),1),e("button",{class:"btn-icon-sm",onClick:fe(V=>q(C.id),["stop"]),title:"åˆ é™¤"},"ðŸ—‘ï¸",8,ed)],8,Wc))),128))])])]))}}),sd={class:"insight-settings-content"},nd={class:"form-group"},ad={class:"form-group"},ld={class:"form-group"},od={class:"model-input-row"},rd=["disabled"],id={key:0,class:"model-select-container"},ud=["value"],cd=["value"],dd={class:"model-count"},pd={key:0,class:"form-group"},vd={class:"form-group"},md=ge({__name:"ImageGenSettingsTab",emits:["showMessage"],setup(l,{expose:t,emit:n}){const a=n,s=he(),i=h(!1),u=h([]),b=h(!1),m=h(s.config.imageGen?.provider||"siliconflow"),f=h(s.config.imageGen?.apiKey||""),k=h(s.config.imageGen?.model||"stabilityai/stable-diffusion-3-5-large"),P=h(s.config.imageGen?.baseUrl||""),R=h(s.config.imageGen?.maxRetries||3),U=N(()=>m.value==="custom");function E(){const B=m.value,x=cu[B];x&&(k.value=x),B!=="custom"&&(P.value=du[B]||""),u.value=[],b.value=!1}async function D(){if(!f.value){a("showMessage","è¯·å…ˆå¡«å†™ API Key","error");return}if(!kt.includes(m.value)){a("showMessage",`${m.value} ä¸æ”¯æŒè‡ªåŠ¨èŽ·å–æ¨¡åž‹åˆ—è¡¨`,"error");return}if(m.value==="custom"&&!P.value){a("showMessage","è‡ªå®šä¹‰æœåŠ¡éœ€è¦å…ˆå¡«å†™ Base URL","error");return}const B=m.value==="custom"?"custom_openai":m.value;i.value=!0;try{const x=await ht(B,f.value,P.value||void 0);x.success&&x.models&&x.models.length>0?(u.value=x.models,b.value=!0,a("showMessage",`èŽ·å–åˆ° ${x.models.length} ä¸ªæ¨¡åž‹`,"success")):(a("showMessage",x.message||"æœªèŽ·å–åˆ°æ¨¡åž‹åˆ—è¡¨","error"),b.value=!1)}catch(x){a("showMessage","èŽ·å–æ¨¡åž‹åˆ—è¡¨å¤±è´¥: "+(x instanceof Error?x.message:"ç½‘ç»œé”™è¯¯"),"error"),b.value=!1}finally{i.value=!1}}function F(B){B&&(k.value=B)}function q(){return{provider:m.value,apiKey:f.value,model:k.value,baseUrl:m.value==="custom"?P.value:"",maxRetries:R.value}}function j(){const B=s.config.imageGen;B&&(m.value=B.provider||"siliconflow",f.value=B.apiKey||"",k.value=B.model||"stabilityai/stable-diffusion-3-5-large",P.value=B.baseUrl||"",R.value=B.maxRetries||3)}return t({getConfig:q,syncFromStore:j}),(B,x)=>(d(),p("div",sd,[x[14]||(x[14]=e("p",{class:"settings-hint"},"ç”Ÿå›¾æ¨¡åž‹ç”¨äºŽç»­å†™åŠŸèƒ½ä¸­ç”Ÿæˆæ¼«ç”»é¡µé¢å›¾ç‰‡ã€‚",-1)),e("div",nd,[x[6]||(x[6]=e("label",null,"æœåŠ¡å•†",-1)),ie(xe,{modelValue:m.value,"onUpdate:modelValue":x[0]||(x[0]=o=>m.value=o),options:pe(uu),onChange:E},null,8,["modelValue","options"])]),e("div",ad,[x[7]||(x[7]=e("label",null,"API Key",-1)),K(e("input",{"onUpdate:modelValue":x[1]||(x[1]=o=>f.value=o),type:"password",placeholder:"è¾“å…¥ API Key"},null,512),[[G,f.value]])]),e("div",ld,[x[9]||(x[9]=e("label",null,"æ¨¡åž‹",-1)),e("div",od,[K(e("input",{"onUpdate:modelValue":x[2]||(x[2]=o=>k.value=o),type:"text",placeholder:"ä¾‹å¦‚: dall-e-3"},null,512),[[G,k.value]]),e("button",{class:"btn btn-secondary btn-sm fetch-btn",disabled:i.value,onClick:D},$(i.value?"èŽ·å–ä¸­...":"ðŸ” èŽ·å–æ¨¡åž‹"),9,rd)]),b.value&&u.value.length>0?(d(),p("div",id,[e("select",{class:"model-select",value:k.value,onChange:x[3]||(x[3]=o=>F(o.target.value))},[x[8]||(x[8]=e("option",{value:""},"-- é€‰æ‹©æ¨¡åž‹ --",-1)),(d(!0),p(W,null,te(u.value,o=>(d(),p("option",{key:o.id,value:o.id},$(o.name||o.id),9,cd))),128))],40,ud),e("span",dd,"å…± "+$(u.value.length)+" ä¸ªæ¨¡åž‹",1)])):M("",!0),x[10]||(x[10]=e("p",{class:"form-hint"},"ä¸åŒæœåŠ¡å•†æ”¯æŒçš„æ¨¡åž‹ä¸åŒï¼Œè¯·å‚è€ƒå„æœåŠ¡å•†æ–‡æ¡£",-1))]),U.value?(d(),p("div",pd,[x[11]||(x[11]=e("label",null,"Base URL",-1)),K(e("input",{"onUpdate:modelValue":x[4]||(x[4]=o=>P.value=o),type:"text",placeholder:"è‡ªå®šä¹‰ API åœ°å€"},null,512),[[G,P.value]])])):M("",!0),e("div",vd,[x[12]||(x[12]=e("label",null,"å¤±è´¥é‡è¯•æ¬¡æ•°",-1)),K(e("input",{"onUpdate:modelValue":x[5]||(x[5]=o=>R.value=o),type:"number",min:"1",max:"10"},null,512),[[G,R.value,void 0,{number:!0}]]),x[13]||(x[13]=e("p",{class:"form-hint"},"æ¯å¼ å›¾ç‰‡ç”Ÿæˆå¤±è´¥åŽçš„é‡è¯•æ¬¡æ•°",-1))]),x[15]||(x[15]=Hs('<div class="info-box" data-v-f2e6ae1b><h4 data-v-f2e6ae1b>ðŸ’¡ æœåŠ¡å•†è¯´æ˜Ž</h4><ul data-v-f2e6ae1b><li data-v-f2e6ae1b><strong data-v-f2e6ae1b>OpenAI DALL-E</strong>: é«˜è´¨é‡ç”Ÿæˆï¼Œä½†ä»·æ ¼è¾ƒé«˜</li><li data-v-f2e6ae1b><strong data-v-f2e6ae1b>SiliconFlow</strong>: æ”¯æŒ SD3.5 ç­‰å¼€æºæ¨¡åž‹ï¼Œæ€§ä»·æ¯”é«˜</li><li data-v-f2e6ae1b><strong data-v-f2e6ae1b>é€šä¹‰ä¸‡ç›¸</strong>: é˜¿é‡Œäº‘ç”Ÿå›¾æœåŠ¡ï¼Œéœ€ç”³è¯·ç™½åå•</li><li data-v-f2e6ae1b><strong data-v-f2e6ae1b>ç«å±±å¼•æ“Ž</strong>: å­—èŠ‚è·³åŠ¨ç”Ÿå›¾æœåŠ¡</li></ul></div>',1))]))}}),gd=Se(md,[["__scopeId","data-v-f2e6ae1b"]]),fd={class:"settings-tabs"},hd=["disabled"],bd=ge({__name:"InsightSettingsModal",emits:["close"],setup(l,{emit:t}){const n=t,a=he(),s=h("vlm"),i=h(!1),u=h(""),b=h(""),m=h(null),f=h(null),k=h(null),P=h(null),R=h(null),U=h(null),E=h(null);function D(o){s.value=o,u.value="",b.value=""}function F(){n("close")}function q(o,r){u.value=o,b.value=r,setTimeout(()=>{u.value="",b.value=""},3e3)}async function j(){if(!i.value){i.value=!0;try{m.value&&a.updateVlmConfig(m.value.getConfig()),f.value&&a.updateLlmConfig(f.value.getConfig()),k.value&&a.updateBatchConfig(k.value.getConfig()),P.value&&a.updateEmbeddingConfig(P.value.getConfig()),R.value&&a.updateRerankerConfig(R.value.getConfig()),U.value&&a.updatePrompts(U.value.getCustomPrompts()),E.value&&a.updateImageGenConfig(E.value.getConfig());const o=a.getConfigForApi(),r=await kn(o);r.success?(q("è®¾ç½®å·²ä¿å­˜","success"),setTimeout(()=>{F()},500)):q("ä¿å­˜å¤±è´¥: "+(r.error||"æœªçŸ¥é”™è¯¯"),"error")}catch(o){q("ä¿å­˜å¤±è´¥: "+(o instanceof Error?o.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{i.value=!1}}}async function B(){try{a.loadConfigFromStorage();const o=await bn();o.success&&o.config&&a.setConfigFromApi(o.config),x()}catch(o){console.error("åŠ è½½é…ç½®å¤±è´¥:",o),x()}}function x(){m.value?.syncFromStore(),f.value?.syncFromStore(),k.value?.syncFromStore(),P.value?.syncFromStore(),R.value?.syncFromStore(),U.value?.syncFromStore(),E.value?.syncFromStore()}return qe(async()=>{await B()}),(o,r)=>(d(),rt(tn,{title:"æ¼«ç”»åˆ†æžè®¾ç½®",size:"large","custom-class":"insight-settings-modal",onClose:F},{footer:Pt(()=>[e("button",{class:"btn btn-secondary",onClick:F},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",disabled:i.value,onClick:j},$(i.value?"ä¿å­˜ä¸­...":"ä¿å­˜"),9,hd)]),default:Pt(()=>[e("div",fd,[e("button",{class:Z(["settings-tab",{active:s.value==="vlm"}]),onClick:r[0]||(r[0]=g=>D("vlm"))}," ðŸ–¼ï¸ VLM å¤šæ¨¡æ€ ",2),e("button",{class:Z(["settings-tab",{active:s.value==="llm"}]),onClick:r[1]||(r[1]=g=>D("llm"))}," ðŸ’¬ LLM å¯¹è¯ ",2),e("button",{class:Z(["settings-tab",{active:s.value==="batch"}]),onClick:r[2]||(r[2]=g=>D("batch"))}," ðŸ“Š æ‰¹é‡åˆ†æž ",2),e("button",{class:Z(["settings-tab",{active:s.value==="embedding"}]),onClick:r[3]||(r[3]=g=>D("embedding"))}," ðŸ”¢ å‘é‡æ¨¡åž‹ ",2),e("button",{class:Z(["settings-tab",{active:s.value==="reranker"}]),onClick:r[4]||(r[4]=g=>D("reranker"))}," ðŸ”„ é‡æŽ’åº ",2),e("button",{class:Z(["settings-tab",{active:s.value==="imagegen"}]),onClick:r[5]||(r[5]=g=>D("imagegen"))}," ðŸŽ¨ ç”Ÿå›¾æ¨¡åž‹ ",2),e("button",{class:Z(["settings-tab",{active:s.value==="prompts"}]),onClick:r[6]||(r[6]=g=>D("prompts"))}," ðŸ“ æç¤ºè¯ ",2)]),u.value?(d(),p("div",{key:0,class:Z(["test-message",b.value])},$(u.value),3)):M("",!0),K(ie(Uu,{ref_key:"vlmTabRef",ref:m,onShowMessage:q},null,512),[[_e,s.value==="vlm"]]),K(ie(Qu,{ref_key:"llmTabRef",ref:f,onShowMessage:q},null,512),[[_e,s.value==="llm"]]),K(ie(pc,{ref_key:"batchTabRef",ref:k},null,512),[[_e,s.value==="batch"]]),K(ie(Sc,{ref_key:"embeddingTabRef",ref:P,onShowMessage:q},null,512),[[_e,s.value==="embedding"]]),K(ie(Oc,{ref_key:"rerankerTabRef",ref:R,onShowMessage:q},null,512),[[_e,s.value==="reranker"]]),K(ie(td,{ref_key:"promptsTabRef",ref:U,onShowMessage:q},null,512),[[_e,s.value==="prompts"]]),K(ie(gd,{ref_key:"imageGenTabRef",ref:E,onShowMessage:q},null,512),[[_e,s.value==="imagegen"]])]),_:1}))}}),kd={class:"modal chapter-select-modal show"},yd={class:"modal-content"},_d={class:"modal-body"},$d={class:"chapters-list"},wd=["onClick"],xd={class:"chapter-info"},Cd={class:"chapter-title"},Sd={key:0,class:"chapter-pages"},Pd={key:0,class:"check-icon"},Id={class:"modal-footer"},Rd=["disabled"],Td=ge({__name:"ChapterSelectModal",props:{chapters:{}},emits:["close","select"],setup(l,{emit:t}){const n=t,a=h("");function s(b){a.value=b}function i(){a.value&&n("select",a.value)}function u(){n("close")}return(b,m)=>(d(),p("div",kd,[e("div",{class:"modal-overlay",onClick:u}),e("div",yd,[e("div",{class:"modal-header"},[m[0]||(m[0]=e("h2",null,"ðŸ“– é€‰æ‹©ç« èŠ‚",-1)),e("button",{class:"modal-close",onClick:u},"Ã—")]),e("div",_d,[m[1]||(m[1]=e("p",{class:"hint-text"},"è¯·é€‰æ‹©è¦ç¿»è¯‘çš„ç« èŠ‚ï¼š",-1)),e("div",$d,[(d(!0),p(W,null,te(l.chapters,f=>(d(),p("div",{key:f.id,class:Z(["chapter-item",{selected:a.value===f.id}]),onClick:k=>s(f.id)},[e("div",xd,[e("span",Cd,$(f.title),1),f.startPage&&f.endPage?(d(),p("span",Sd," ç¬¬ "+$(f.startPage)+"-"+$(f.endPage)+" é¡µ ",1)):M("",!0)]),a.value===f.id?(d(),p("span",Pd,"âœ“")):M("",!0)],10,wd))),128))])]),e("div",Id,[e("button",{class:"btn btn-secondary",onClick:u},"å–æ¶ˆ"),e("button",{class:"btn btn-primary",disabled:!a.value,onClick:i}," ç¡®å®š ",8,Rd)])])]))}}),Ad=Se(Td,[["__scopeId","data-v-5f4c62c9"]]);async function Ud(l){return H.get(`/api/manga-insight/${l}/continuation/prepare`)}async function Bd(l){return H.get(`/api/manga-insight/${l}/continuation/characters`)}async function Md(l,t){return H.post(`/api/manga-insight/${l}/continuation/characters`,t)}async function Ld(l,t){return H.delete(`/api/manga-insight/${l}/continuation/characters/${encodeURIComponent(t)}`)}async function Ed(l,t,n){return H.put(`/api/manga-insight/${l}/continuation/characters/${encodeURIComponent(t)}`,n)}async function zd(l,t,n){return H.post(`/api/manga-insight/${l}/continuation/characters/${encodeURIComponent(t)}/forms`,n)}async function Dd(l,t,n,a){return H.put(`/api/manga-insight/${l}/continuation/characters/${encodeURIComponent(t)}/forms/${encodeURIComponent(n)}`,a)}async function Vd(l,t,n){return H.delete(`/api/manga-insight/${l}/continuation/characters/${encodeURIComponent(t)}/forms/${encodeURIComponent(n)}`)}async function Od(l,t,n){return H.post(`/api/manga-insight/${l}/continuation/characters/${encodeURIComponent(t)}/toggle`,{enabled:n})}async function Kd(l,t,n,a){return H.post(`/api/manga-insight/${l}/continuation/characters/${encodeURIComponent(t)}/forms/${encodeURIComponent(n)}/toggle`,{enabled:a})}async function qd(l,t,n,a){return H.upload(`/api/manga-insight/${l}/continuation/characters/${encodeURIComponent(t)}/forms/${encodeURIComponent(n)}/image`,a)}async function Fd(l,t,n){return H.delete(`/api/manga-insight/${l}/continuation/characters/${encodeURIComponent(t)}/forms/${encodeURIComponent(n)}/image`)}async function Nd(l,t,n,a){const s=new FormData;return a.forEach(i=>{s.append("images",i)}),H.post(`/api/manga-insight/${l}/continuation/characters/${encodeURIComponent(t)}/forms/${encodeURIComponent(n)}/orthographic`,s,{headers:{"Content-Type":"multipart/form-data"},timeout:0})}async function jd(l,t,n,a){return H.post(`/api/manga-insight/${l}/continuation/characters/${encodeURIComponent(t)}/forms/${encodeURIComponent(n)}/set-reference`,{image_path:a})}async function Gd(l,t,n){return H.post(`/api/manga-insight/${l}/continuation/script`,{direction:t,page_count:n},{timeout:0})}async function ot(l,t){return H.post(`/api/manga-insight/${l}/continuation/save-pages`,{pages:t})}async function Qd(l,t){return H.post(`/api/manga-insight/${l}/continuation/save-config`,t)}async function Hd(l){return H.delete(`/api/manga-insight/${l}/continuation/clear`)}async function Jd(l,t,n){return H.post(`/api/manga-insight/${l}/continuation/pages/${n}`,{script:t},{timeout:0})}async function Zd(l,t){return H.post(`/api/manga-insight/${l}/continuation/prompts`,{pages:t},{timeout:0})}async function _s(l,t,n){return H.post(`/api/manga-insight/${l}/continuation/prompts/${n}`,{page:t},{timeout:0})}async function $s(l,t=3){return H.get(`/api/manga-insight/${l}/continuation/style-references?count=${t}`)}async function Wd(l,t,n,a,s,i=3){return H.post(`/api/manga-insight/${l}/continuation/generate/${t}`,{page:n,style_reference_images:a,session_id:s,style_ref_count:i},{timeout:0})}async function Xd(l,t,n,a,s,i=3){return H.post(`/api/manga-insight/${l}/continuation/regenerate/${t}`,{page:n,style_reference_images:a,session_id:s,style_ref_count:i},{timeout:0})}async function Yd(l){const t=await fetch(`/api/manga-insight/${l}/continuation/export/images`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!t.ok){const n=await t.json().catch(()=>({}));throw new Error(n.error||"å¯¼å‡ºå¤±è´¥")}return t.blob()}async function ep(l){const t=await fetch(`/api/manga-insight/${l}/continuation/export/pdf`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!t.ok){const n=await t.json().catch(()=>({}));throw new Error(n.error||"å¯¼å‡ºå¤±è´¥")}return t.blob()}const tp={class:"continuation-panel"},sp={key:0,class:"message error"},np={key:1,class:"message success"},ap={class:"step-indicator"},lp=["onClick"],op={class:"step-number"},rp={class:"step-name"},ip={class:"step-content"},up={class:"step-panel"},cp={class:"form-group"},dp={class:"form-group"},pp={class:"form-group"},vp={class:"characters-section"},mp={key:0,class:"empty-state"},gp={key:0},fp={key:1},hp={key:1,class:"character-panel-layout"},bp={class:"character-grid-panel"},kp=["onClick"],yp={class:"tile-avatar"},_p=["src"],$p={key:1,class:"tile-avatar-placeholder"},wp={key:2,class:"tile-form-badge"},xp={key:3,class:"tile-disabled-badge"},Cp={class:"tile-name"},Sp={class:"detail-header"},Pp={class:"detail-main-info"},Ip={class:"detail-avatar"},Rp=["src"],Tp={key:1,class:"detail-avatar-placeholder"},Ap={class:"detail-info"},Up={key:0,class:"detail-aliases"},Bp={class:"detail-actions"},Mp={class:"toggle-switch",title:"å¯ç”¨/ç¦ç”¨è§’è‰²"},Lp=["checked"],Ep={class:"detail-forms-section"},zp={class:"forms-header"},Dp={class:"forms-grid"},Vp={class:"form-tile-image"},Op=["src"],Kp={key:1,class:"form-tile-placeholder"},qp={class:"form-upload-overlay"},Fp=["onChange"],Np={class:"form-tile-info"},jp={class:"form-tile-name"},Gp={key:0,class:"disabled-tag"},Qp={key:0,class:"form-tile-desc"},Hp={class:"form-tile-actions"},Jp={class:"toggle-switch-mini",title:"å¯ç”¨/ç¦ç”¨å½¢æ€"},Zp=["checked","onChange"],Wp=["onClick"],Xp=["onClick"],Yp=["onClick"],ev=["onClick"],tv={key:1,class:"detail-empty"},sv={class:"actions"},nv=["disabled"],av=["disabled"],lv={class:"step-panel"},ov={key:0,class:"generate-prompt"},rv=["disabled"],iv={key:1,class:"script-editor"},uv={class:"script-header"},cv={class:"meta"},dv={class:"script-actions"},pv=["disabled"],vv={class:"actions"},mv=["disabled"],gv={class:"step-panel"},fv={key:0,class:"generate-prompt"},hv=["disabled"],bv={key:1,class:"pages-list"},kv={class:"page-header"},yv={class:"page-number"},_v={class:"page-mood"},$v={class:"page-content"},wv={class:"page-field"},xv=["value","onChange"],Cv={class:"page-field"},Sv=["onUpdate:modelValue"],Pv={key:0,class:"page-field"},Iv={class:"page-dialogues-list"},Rv=["onUpdate:modelValue"],Tv=["onUpdate:modelValue"],Av={class:"page-prompt"},Uv={class:"prompt-header"},Bv=["disabled","onClick"],Mv=["onUpdate:modelValue"],Lv={class:"pages-actions"},Ev=["disabled"],zv={class:"actions"},Dv=["disabled"],Vv={class:"step-panel"},Ov={class:"generation-controls"},Kv=["disabled"],qv={class:"progress-info"},Fv={key:0,class:"progress-bar"},Nv={class:"generated-pages"},jv={class:"card-header"},Gv={class:"page-num"},Qv={class:"card-body"},Hv={class:"image-area"},Jv=["src"],Zv={key:1,class:"placeholder"},Wv={class:"prompt-area"},Xv=["onUpdate:modelValue","disabled"],Yv={class:"card-actions"},em=["disabled","onClick"],tm=["onClick"],sm={class:"actions"},nm=["disabled"],am={class:"step-panel"},lm={class:"export-options"},om={class:"export-summary"},rm={class:"export-formats"},im=["disabled"],um={class:"actions"},cm={class:"modal-dialog ortho-dialog"},dm={class:"modal-header"},pm={key:0},vm={class:"modal-body"},mm={class:"ortho-upload-section"},gm={class:"upload-placeholder"},fm={class:"upload-icon"},hm={key:0},bm={key:1},km={key:0,class:"source-images"},ym=["src","alt"],_m={class:"image-index"},$m={key:0,class:"generating-state"},wm={class:"progress-message"},xm={key:1,class:"ortho-result"},Cm={class:"result-preview"},Sm=["src"],Pm={class:"modal-footer"},Im=["disabled"],Rm={key:1,class:"result-actions"},Tm={class:"modal-dialog edit-char-dialog"},Am={class:"modal-body"},Um={class:"form-group"},Bm={class:"form-group"},Mm={class:"modal-dialog add-char-dialog"},Lm={class:"modal-body"},Em={class:"form-group"},zm={class:"form-group"},Dm={class:"form-group"},Vm={class:"modal-footer"},Om=["disabled"],Km={class:"modal-dialog add-form-dialog"},qm={class:"modal-body"},Fm={class:"form-group"},Nm={class:"form-group"},jm={class:"form-group"},Gm={class:"modal-footer"},Qm=["disabled"],Hm={class:"modal-dialog edit-form-dialog"},Jm={class:"modal-body"},Zm={class:"form-group"},Wm={class:"form-group"},Xm={class:"modal-footer"},Ym=["disabled"],eg=ge({__name:"ContinuationPanel",setup(l){const t=he(),n=h(0),a=["è®¾ç½®","è„šæœ¬","é¡µé¢","ç”Ÿæˆ","å¯¼å‡º"],s=h(!1),i=h(""),u=h(""),b=h(15),m=h(3),f=h(""),k=h([]),P=h(!1),R=h(!1),U=h(null),E=h(""),D=h(""),F=h([]),q=h(!1),j=h(""),B=h(null),x=h(Date.now()),o=h(!1),r=h(!1),g=h(null),S=h(""),T=h(""),C=h(!1),V=h(""),se=h(""),Q=h(""),I=h(!1),w=h(null),z=h(!1),ne=h(null),ce=h(""),be=h(""),Ce=h(""),Me=h(!1),Fe=h(!1),Le=h(null),Ee=h(""),Ue=h(""),Ne=h(""),et=h(!1),ke=h(null),je=h(!1),X=h([]),tt=h(!1),De=h(!1),st=h(null),Ge=h(0),Qe=h(!1),He=h(""),Je=h("images"),yt=N(()=>P.value&&b.value>0),_t=N(()=>ke.value!==null),Bt=N(()=>X.value.length>0&&X.value.every(y=>y.image_prompt)),Mt=N(()=>X.value.some(y=>y.status==="generated")),$t=N(()=>X.value.filter(y=>y.status==="generated").length);function O(y,c){c==="success"?(u.value=y,setTimeout(()=>{u.value=""},3e3)):c==="info"?u.value=y:(i.value=y,setTimeout(()=>{i.value=""},5e3))}function Pe(y){y>=0&&y<=4&&(n.value=y)}async function ut(){if(!t.currentBookId){O("è¯·å…ˆé€‰æ‹©ä¹¦ç±","error");return}s.value=!0,i.value="";try{const y=await Ud(t.currentBookId);if(y.success&&y.ready){P.value=!0;const c=await Bd(t.currentBookId);if(c.success&&c.characters&&(k.value=c.characters),y.saved_data?.has_data){const v=y.saved_data;v.config&&(v.config.page_count&&(b.value=v.config.page_count),v.config.style_reference_pages&&(m.value=v.config.style_reference_pages),v.config.continuation_direction&&(f.value=v.config.continuation_direction)),v.script&&(ke.value=v.script),v.pages&&v.pages.length>0&&(X.value=v.pages),O("å·²æ¢å¤ä¸Šæ¬¡çš„ç»­å†™è¿›åº¦","success")}else O("æ•°æ®å‡†å¤‡å°±ç»ª","success")}else O(y.message||"æ•°æ®è¿˜åœ¨å‡†å¤‡ä¸­ï¼Œè¯·ç¨åŽé‡è¯•","error")}catch(y){O("åˆå§‹åŒ–å¤±è´¥: "+(y instanceof Error?y.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{s.value=!1}}function Lt(y){g.value=y,S.value=y.name,T.value=y.aliases.join(", "),r.value=!0}function nt(){r.value=!1,g.value=null}async function Et(){if(!g.value)return;const y=g.value.name,c=S.value.trim(),v=T.value.split(/[,ï¼Œ]/).map(L=>L.trim()).filter(L=>L.length>0);if(!c){O("è§’è‰²åä¸èƒ½ä¸ºç©º","error");return}try{const L=await Ed(t.currentBookId,y,{name:c,aliases:v});if(L.success){const J=k.value.find(ee=>ee.name===y);J&&L.character&&(J.name=L.character.name,J.aliases=L.character.aliases),O("è§’è‰²ä¿¡æ¯å·²æ›´æ–°","success"),nt()}else O("ä¿å­˜å¤±è´¥: "+L.error,"error")}catch(L){O("ä¿å­˜å¤±è´¥: "+(L instanceof Error?L.message:"ç½‘ç»œé”™è¯¯"),"error")}}function zt(){V.value="",se.value="",Q.value="",C.value=!0}function at(){C.value=!1}async function Dt(){const y=V.value.trim();if(!y){O("è§’è‰²åä¸èƒ½ä¸ºç©º","error");return}const c=se.value.split(/[,ï¼Œ]/).map(v=>v.trim()).filter(v=>v.length>0);I.value=!0;try{const v=await Md(t.currentBookId,{name:y,aliases:c,description:Q.value.trim()});v.success&&v.character?(k.value.push(v.character),O(`è§’è‰² "${y}" å·²æ·»åŠ `,"success"),at()):O("æ·»åŠ å¤±è´¥: "+v.error,"error")}catch(v){O("æ·»åŠ å¤±è´¥: "+(v instanceof Error?v.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{I.value=!1}}async function Vt(y){if(confirm(`ç¡®å®šè¦åˆ é™¤è§’è‰² "${y.name}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`))try{const c=await Ld(t.currentBookId,y.name);if(c.success){const v=k.value.findIndex(L=>L.name===y.name);v!==-1&&k.value.splice(v,1),O(`è§’è‰² "${y.name}" å·²åˆ é™¤`,"success")}else O("åˆ é™¤å¤±è´¥: "+c.error,"error")}catch(c){O("åˆ é™¤å¤±è´¥: "+(c instanceof Error?c.message:"ç½‘ç»œé”™è¯¯"),"error")}}function Ot(y){w.value=w.value===y?null:y}function de(){return w.value&&k.value.find(y=>y.name===w.value)||null}function Kt(y){ne.value=y,ce.value="",be.value="",Ce.value="",z.value=!0}function lt(){z.value=!1,ne.value=null}async function Ze(){if(!ne.value||!ce.value.trim()||!be.value.trim()){O("è¯·å¡«å†™å½¢æ€IDå’Œåç§°","error");return}Me.value=!0;try{const y=await zd(t.currentBookId,ne.value,{form_id:ce.value.trim(),form_name:be.value.trim(),description:Ce.value.trim()});if(y.success&&y.form){const c=k.value.find(v=>v.name===ne.value);c&&c.forms&&c.forms.push(y.form),O(`å½¢æ€ "${be.value}" å·²æ·»åŠ `,"success"),lt()}else O("æ·»åŠ å½¢æ€å¤±è´¥: "+y.error,"error")}catch(y){O("æ·»åŠ å½¢æ€å¤±è´¥: "+(y instanceof Error?y.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{Me.value=!1}}function qt(y,c){Ee.value=y,Le.value=c,Ue.value=c.form_name,Ne.value=c.description,Fe.value=!0}function Ve(){Fe.value=!1,Le.value=null,Ee.value=""}async function Ft(){if(!(!Le.value||!Ee.value)){et.value=!0;try{const y=await Dd(t.currentBookId,Ee.value,Le.value.form_id,{form_name:Ue.value.trim(),description:Ne.value.trim()});if(y.success){const c=k.value.find(v=>v.name===Ee.value);if(c&&c.forms){const v=c.forms.find(L=>L.form_id===Le.value?.form_id);v&&(v.form_name=Ue.value.trim(),v.description=Ne.value.trim())}O("å½¢æ€ä¿¡æ¯å·²æ›´æ–°","success"),Ve()}else O("æ›´æ–°å¤±è´¥: "+y.error,"error")}catch(y){O("æ›´æ–°å¤±è´¥: "+(y instanceof Error?y.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{et.value=!1}}}async function ct(y,c){if(c.form_id==="default"){O("é»˜è®¤å½¢æ€æ— æ³•åˆ é™¤","error");return}if(confirm(`ç¡®å®šè¦åˆ é™¤å½¢æ€ "${c.form_name}" å—ï¼Ÿ`))try{const v=await Vd(t.currentBookId,y,c.form_id);if(v.success){const L=k.value.find(J=>J.name===y);if(L&&L.forms){const J=L.forms.findIndex(ee=>ee.form_id===c.form_id);J!==-1&&L.forms.splice(J,1)}O(`å½¢æ€ "${c.form_name}" å·²åˆ é™¤`,"success")}else O("åˆ é™¤å¤±è´¥: "+v.error,"error")}catch(v){O("åˆ é™¤å¤±è´¥: "+(v instanceof Error?v.message:"ç½‘ç»œé”™è¯¯"),"error")}}async function Nt(y,c,v){const L=v.target;if(!L.files?.length)return;const J=L.files[0];if(!J)return;const ee=new FormData;ee.append("image",J);try{const ve=await qd(t.currentBookId,y,c,ee);if(ve.success&&ve.image_path){const xt=k.value.find(Ct=>Ct.name===y);if(xt&&xt.forms){const Ct=xt.forms.find(Gs=>Gs.form_id===c);Ct&&(Ct.reference_image=ve.image_path),c==="default"&&(xt.reference_image=ve.image_path)}x.value=Date.now(),O("å½¢æ€å‚è€ƒå›¾å·²ä¸Šä¼ ","success")}else O("ä¸Šä¼ å¤±è´¥: "+ve.error,"error")}catch(ve){O("ä¸Šä¼ å¤±è´¥: "+(ve instanceof Error?ve.message:"ç½‘ç»œé”™è¯¯"),"error")}L.value=""}async function dt(y,c){if(confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå½¢æ€çš„å‚è€ƒå›¾å—ï¼Ÿ"))try{const v=await Fd(t.currentBookId,y,c);if(v.success){const L=k.value.find(J=>J.name===y);if(L&&L.forms){const J=L.forms.find(ee=>ee.form_id===c);J&&(J.reference_image=""),c==="default"&&(L.reference_image="")}x.value=Date.now(),O("å‚è€ƒå›¾å·²åˆ é™¤","success")}else O("åˆ é™¤å¤±è´¥: "+v.error,"error")}catch(v){O("åˆ é™¤å¤±è´¥: "+(v instanceof Error?v.message:"ç½‘ç»œé”™è¯¯"),"error")}}async function jt(y,c){try{const v=await Od(t.currentBookId,y,c);if(v.success){const L=k.value.find(J=>J.name===y);L&&(L.enabled=c),O(`è§’è‰²å·²${c?"å¯ç”¨":"ç¦ç”¨"}`,"success")}else O("æ“ä½œå¤±è´¥: "+v.error,"error")}catch(v){O("æ“ä½œå¤±è´¥: "+(v instanceof Error?v.message:"ç½‘ç»œé”™è¯¯"),"error")}}async function pt(y,c,v){try{const L=await Kd(t.currentBookId,y,c,v);if(L.success){const J=k.value.find(ee=>ee.name===y);if(J&&J.forms){const ee=J.forms.find(ve=>ve.form_id===c);ee&&(ee.enabled=v)}O(`å½¢æ€å·²${v?"å¯ç”¨":"ç¦ç”¨"}`,"success")}else O("æ“ä½œå¤±è´¥: "+L.error,"error")}catch(L){O("æ“ä½œå¤±è´¥: "+(L instanceof Error?L.message:"ç½‘ç»œé”™è¯¯"),"error")}}function Gt(y,c){const v=k.value.find(J=>J.name===y);if(!v||!v.forms)return"";const L=v.forms.find(J=>J.form_id===c);return!L||!L.reference_image?"":`/api/manga-insight/file?path=${encodeURIComponent(L.reference_image)}&t=${x.value}`}function Qt(y,c,v){U.value=y,E.value=c,D.value=v,F.value=[],B.value=null,j.value="",R.value=!0}function me(){R.value=!1,U.value=null,E.value="",D.value="",F.value=[],B.value=null,j.value=""}function Ht(y){const c=y.target;if(!c.files)return;const v=Array.from(c.files).slice(0,5);F.value=v}function Jt(y){y.preventDefault(),y.stopPropagation(),o.value=!0}function Zt(y){y.preventDefault(),y.stopPropagation(),o.value=!0}function Wt(y){y.preventDefault(),y.stopPropagation(),o.value=!1}function Xt(y){y.preventDefault(),y.stopPropagation(),o.value=!1;const c=y.dataTransfer?.files;if(!c||c.length===0)return;const v=Array.from(c).filter(L=>L.type.startsWith("image/")).slice(0,5);v.length>0?F.value=v:O("è¯·æ‹–æ‹½å›¾ç‰‡æ–‡ä»¶","error")}async function wt(){if(!U.value||!E.value||F.value.length===0){O("è¯·è‡³å°‘ä¸Šä¼ ä¸€å¼ å›¾ç‰‡","error");return}q.value=!0,i.value="",j.value=`æ­£åœ¨ä¸Šä¼  ${F.value.length} å¼ å›¾ç‰‡...`;try{setTimeout(()=>{q.value&&(j.value="AI æ­£åœ¨åˆ†æžè§’è‰²ç‰¹å¾...")},500),setTimeout(()=>{q.value&&(j.value="æ­£åœ¨ç”Ÿæˆä¸‰è§†å›¾ï¼Œè¯·è€å¿ƒç­‰å¾…...")},2e3);const y=await Nd(t.currentBookId,U.value.name,E.value,F.value);y.success&&y.image_path?(B.value=y.image_path,O("ä¸‰è§†å›¾ç”ŸæˆæˆåŠŸ","success")):O("ç”Ÿæˆå¤±è´¥: "+y.error,"error")}catch(y){O("ç”Ÿæˆå¤±è´¥: "+(y instanceof Error?y.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{q.value=!1}}async function _(){if(!(!U.value||!E.value||!B.value))try{const y=await jd(t.currentBookId,U.value.name,E.value,B.value);y.success?(x.value=Date.now(),await ut(),O("ä¸‰è§†å›¾å·²è®¾ç½®ä¸ºå½¢æ€å‚è€ƒå›¾","success"),me()):O("è®¾ç½®å¤±è´¥: "+y.error,"error")}catch(y){O("è®¾ç½®å¤±è´¥: "+(y instanceof Error?y.message:"ç½‘ç»œé”™è¯¯"),"error")}}function A(y){return t.currentBookId?`/api/manga-insight/${t.currentBookId}/continuation/characters/${encodeURIComponent(y)}/image?t=${x.value}`:""}function Y(y){return window.URL.createObjectURL(y)}function we(){return!t.currentBookId||!B.value?"":`/api/manga-insight/${t.currentBookId}/continuation/generated-image?path=${encodeURIComponent(B.value)}`}function ye(y){return!t.currentBookId||!y?"":`/api/manga-insight/${t.currentBookId}/continuation/generated-image?path=${encodeURIComponent(y)}`}async function ue(){if(t.currentBookId){je.value=!0,i.value="";try{const y=await Gd(t.currentBookId,f.value,b.value);if(y.success&&y.script){ke.value=y.script;try{await Qd(t.currentBookId,{page_count:b.value,style_reference_pages:m.value,continuation_direction:f.value}),console.log("é…ç½®å·²ä¿å­˜")}catch(c){console.error("ä¿å­˜é…ç½®å¤±è´¥:",c)}O("è„šæœ¬ç”ŸæˆæˆåŠŸ","success")}else O("è„šæœ¬ç”Ÿæˆå¤±è´¥: "+y.error,"error")}catch(y){O("è„šæœ¬ç”Ÿæˆå¤±è´¥: "+(y instanceof Error?y.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{je.value=!1}}}async function We(){if(!t.currentBookId||!ke.value)return;tt.value=!0,De.value=!0,i.value="";const y=ke.value.page_count||b.value;X.value=[];try{for(let c=1;c<=y;c++){O(`æ­£åœ¨ç”Ÿæˆç¬¬ ${c}/${y} é¡µè¯¦æƒ…...`,"info");const v=await Jd(t.currentBookId,ke.value,c);if(!v.success||!v.page){X.value.push({page_number:c,scene:"",characters:[],description:`ç”Ÿæˆå¤±è´¥: ${v.error||"æœªçŸ¥é”™è¯¯"}`,dialogues:[],mood:"",image_prompt:"",image_url:"",previous_url:"",status:"failed"}),console.error(`ç¬¬ ${c} é¡µè¯¦æƒ…ç”Ÿæˆå¤±è´¥:`,v.error);continue}O(`æ­£åœ¨ç”Ÿæˆç¬¬ ${c}/${y} é¡µæç¤ºè¯...`,"info");const L=await _s(t.currentBookId,v.page,c);if(L.success&&L.page)X.value.push(L.page);else{const J={...v.page};J.image_prompt=`æç¤ºè¯ç”Ÿæˆå¤±è´¥: ${L.error||"æœªçŸ¥é”™è¯¯"}`,X.value.push(J),console.error(`ç¬¬ ${c} é¡µæç¤ºè¯ç”Ÿæˆå¤±è´¥:`,L.error)}}try{await ot(t.currentBookId,X.value),console.log("é¡µé¢æ•°æ®å·²è‡ªåŠ¨ä¿å­˜")}catch(c){console.error("è‡ªåŠ¨ä¿å­˜é¡µé¢æ•°æ®å¤±è´¥:",c)}O(`é¡µé¢è¯¦æƒ…å’Œæç¤ºè¯ç”Ÿæˆå®Œæˆ (${X.value.length} é¡µ)`,"success")}catch(c){O("ç”Ÿæˆå¤±è´¥: "+(c instanceof Error?c.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{tt.value=!1,De.value=!1}}async function Oe(){if(!(!t.currentBookId||X.value.length===0)){De.value=!0,i.value="";try{const y=await Zd(t.currentBookId,X.value);y.success&&y.pages?(X.value=y.pages,O("æç¤ºè¯ç”ŸæˆæˆåŠŸ","success")):O("æç¤ºè¯ç”Ÿæˆå¤±è´¥: "+y.error,"error")}catch(y){O("æç¤ºè¯ç”Ÿæˆå¤±è´¥: "+(y instanceof Error?y.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{De.value=!1}}}function Ie(y,c){const L=c.target.value;y.characters=L.split(",").map(J=>J.trim()).filter(J=>J),Ke()}function Ke(){console.log("é¡µé¢æ•°æ®å·²ä¿®æ”¹")}async function Re(){if(!(!t.currentBookId||X.value.length===0))try{await ot(t.currentBookId,X.value),O("é¡µé¢æ•°æ®ä¿å­˜æˆåŠŸ","success")}catch(y){O("ä¿å­˜å¤±è´¥: "+(y instanceof Error?y.message:"ç½‘ç»œé”™è¯¯"),"error")}}async function re(y){if(!t.currentBookId)return;const c=X.value.find(v=>v.page_number===y);if(c){st.value=y;try{const v=await _s(t.currentBookId,c,y);v.success&&v.page?(c.image_prompt=v.page.image_prompt,await ot(t.currentBookId,X.value),O(`ç¬¬ ${y} é¡µæç¤ºè¯å·²æ›´æ–°`,"success")):O("ç”Ÿæˆå¤±è´¥: "+v.error,"error")}catch(v){O("ç”Ÿæˆå¤±è´¥: "+(v instanceof Error?v.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{st.value=null}}}async function Os(){if(!(!t.currentBookId||X.value.length===0)){Qe.value=!0,Ge.value=0,i.value="";try{let y=[];const c=await $s(t.currentBookId,m.value);c.success&&c.images&&(y=[...c.images]),console.log(`åˆå§‹å‚è€ƒå›¾ (${m.value}å¼ ):`,y);const v=X.value.length;for(let J=0;J<v;J++){const ee=X.value[J];if(ee){if(ee.image_url&&ee.status!=="failed"){y.push(ee.image_url),y.length>m.value&&(y=y.slice(-m.value)),Ge.value=Math.round((J+1)/v*100);continue}O(`æ­£åœ¨ç”Ÿæˆç¬¬ ${ee.page_number}/${v} é¡µå›¾ç‰‡...`,"info"),ee.status="generating",console.log(`ç¬¬ ${ee.page_number} é¡µä½¿ç”¨å‚è€ƒå›¾ (${y.length}å¼ ):`,y.slice(-3));try{const ve=await Wd(t.currentBookId,ee.page_number,ee,y,He.value,m.value);ve.success&&ve.image_path?(ee.image_url=ve.image_path,ee.status="generated",y.push(ve.image_path),y.length>m.value&&(y=y.slice(-m.value)),ve.session_id&&(He.value=ve.session_id)):(ee.status="failed",console.error(`ç¬¬ ${ee.page_number} é¡µå›¾ç‰‡ç”Ÿæˆå¤±è´¥:`,ve.error))}catch(ve){ee.status="failed",console.error(`ç¬¬ ${ee.page_number} é¡µå›¾ç‰‡ç”Ÿæˆå¼‚å¸¸:`,ve)}Ge.value=Math.round((J+1)/v*100)}}try{await ot(t.currentBookId,X.value),console.log("é¡µé¢æ•°æ®ï¼ˆå«å›¾ç‰‡ï¼‰å·²è‡ªåŠ¨ä¿å­˜")}catch(J){console.error("è‡ªåŠ¨ä¿å­˜é¡µé¢æ•°æ®å¤±è´¥:",J)}const L=X.value.filter(J=>J.status==="generated").length;O(`å›¾ç‰‡ç”Ÿæˆå®Œæˆ (${L}/${v} é¡µæˆåŠŸ)`,"success")}catch(y){O("å›¾ç‰‡ç”Ÿæˆå¤±è´¥: "+(y instanceof Error?y.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{Qe.value=!1,Ge.value=100}}}async function Ks(y){if(!t.currentBookId)return;const c=X.value.find(v=>v.page_number===y);if(c){c.status="generating";try{let v=[];const L=await $s(t.currentBookId,m.value);L.success&&L.images&&(v=L.images);const J=await Xd(t.currentBookId,y,c,v,He.value,m.value);if(J.success&&J.image_path){c.previous_url=c.image_url,c.image_url=J.image_path,c.status="generated";try{await ot(t.currentBookId,X.value)}catch(ee){console.error("è‡ªåŠ¨ä¿å­˜é¡µé¢æ•°æ®å¤±è´¥:",ee)}O(`ç¬¬ ${y} é¡µé‡æ–°ç”ŸæˆæˆåŠŸ`,"success")}else c.status="failed",O("é‡æ–°ç”Ÿæˆå¤±è´¥: "+J.error,"error")}catch(v){c.status="failed",O("é‡æ–°ç”Ÿæˆå¤±è´¥: "+(v instanceof Error?v.message:"ç½‘ç»œé”™è¯¯"),"error")}}}async function qs(y){const c=X.value.find(v=>v.page_number===y);if(c&&c.previous_url){const v=c.image_url;if(c.image_url=c.previous_url,c.previous_url=v,t.currentBookId)try{await ot(t.currentBookId,X.value)}catch(L){console.error("è‡ªåŠ¨ä¿å­˜é¡µé¢æ•°æ®å¤±è´¥:",L)}O("å·²åˆ‡æ¢åˆ°ä¸Šä¸€ç‰ˆæœ¬","success")}}async function Fs(){if(!t.currentBookId||X.value.length===0){O("æ²¡æœ‰å¯å¯¼å‡ºçš„é¡µé¢","error");return}s.value=!0;try{const y=await Yd(t.currentBookId),c=window.URL.createObjectURL(y),v=document.createElement("a");v.href=c,v.download=`continuation_${Date.now()}.zip`,document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(c),O("å¯¼å‡ºæˆåŠŸ","success")}catch(y){O("å¯¼å‡ºå¤±è´¥: "+(y instanceof Error?y.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{s.value=!1}}async function Ns(){if(!t.currentBookId||X.value.length===0){O("æ²¡æœ‰å¯å¯¼å‡ºçš„é¡µé¢","error");return}s.value=!0;try{const y=await ep(t.currentBookId),c=window.URL.createObjectURL(y),v=document.createElement("a");v.href=c,v.download=`continuation_${Date.now()}.pdf`,document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(c),O("å¯¼å‡ºæˆåŠŸ","success")}catch(y){O("å¯¼å‡ºå¤±è´¥: "+(y instanceof Error?y.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{s.value=!1}}async function js(){if(t.currentBookId&&confirm("ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ç»­å†™æ•°æ®å¹¶é‡æ–°å¼€å§‹å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚")){s.value=!0;try{const y=await Hd(t.currentBookId);y.success?(ke.value=null,X.value=[],He.value="",n.value=0,O("ç»­å†™æ•°æ®å·²æ¸…é™¤ï¼Œå¯ä»¥é‡æ–°å¼€å§‹","success")):O("æ¸…é™¤å¤±è´¥: "+y.error,"error")}catch(y){O("æ¸…é™¤å¤±è´¥: "+(y instanceof Error?y.message:"ç½‘ç»œé”™è¯¯"),"error")}finally{s.value=!1}}}return qe(()=>{t.currentBookId&&ut()}),Be(()=>t.currentBookId,y=>{y&&(n.value=0,P.value=!1,k.value=[],ke.value=null,X.value=[],He.value="",ut())}),(y,c)=>(d(),p("div",tp,[i.value?(d(),p("div",sp,$(i.value),1)):M("",!0),u.value?(d(),p("div",np,$(u.value),1)):M("",!0),e("div",ap,[(d(),p(W,null,te(a,(v,L)=>e("div",{key:L,class:Z(["step",{active:n.value===L,completed:n.value>L,clickable:L<=n.value||L===1&&yt.value}]),onClick:J=>Pe(L)},[e("span",op,$(L+1),1),e("span",rp,$(v),1)],10,lp)),64))]),e("div",ip,[K(e("div",up,[c[40]||(c[40]=e("h3",null,"ðŸ“ ç»­å†™è®¾ç½®",-1)),e("div",cp,[c[29]||(c[29]=e("label",null,"ç»­å†™é¡µæ•°",-1)),K(e("input",{"onUpdate:modelValue":c[0]||(c[0]=v=>b.value=v),type:"number",min:"5",max:"50"},null,512),[[G,b.value,void 0,{number:!0}]]),c[30]||(c[30]=e("p",{class:"hint"},"å»ºè®® 10-20 é¡µ",-1))]),e("div",dp,[c[31]||(c[31]=e("label",null,"ç”»é£Žå‚è€ƒé¡µæ•°",-1)),K(e("input",{"onUpdate:modelValue":c[1]||(c[1]=v=>m.value=v),type:"number",min:"1",max:"10"},null,512),[[G,m.value,void 0,{number:!0}]]),c[32]||(c[32]=e("p",{class:"hint"},"ç”¨äºŽç»´æŒç”»é£Žä¸€è‡´æ€§",-1))]),e("div",pp,[c[33]||(c[33]=e("label",null,"ç»­å†™æ–¹å‘ï¼ˆå¯é€‰ï¼‰",-1)),K(e("textarea",{"onUpdate:modelValue":c[2]||(c[2]=v=>f.value=v),rows:"4",placeholder:"ä¾‹å¦‚ï¼šå»¶ç»­ä¸»çº¿å‰§æƒ…ï¼ŒæŽ¢ç´¢æ–°çš„å†’é™©..."},null,512),[[G,f.value]]),c[34]||(c[34]=e("p",{class:"hint"},"ç•™ç©ºå°†è‡ªåŠ¨æ ¹æ®å‰§æƒ…å‘å±•ç”Ÿæˆ",-1))]),e("div",vp,[e("div",{class:"section-header"},[c[35]||(c[35]=e("div",{class:"section-title"},[e("h4",null,"ðŸŽ­ è§’è‰²æ¡£æ¡ˆ"),e("p",{class:"hint"},"ç‚¹å‡»è§’è‰²æŸ¥çœ‹å’Œç®¡ç†å½¢æ€")],-1)),e("button",{class:"btn small primary",onClick:zt}," âž• æ–°å¢žè§’è‰² ")]),k.value.length===0?(d(),p("div",mp,[s.value?(d(),p("span",gp,"åŠ è½½ä¸­...")):(d(),p("span",fp,'æš‚æ— è§’è‰²æ•°æ®ï¼Œç‚¹å‡»"æ–°å¢žè§’è‰²"æ·»åŠ '))])):(d(),p("div",hp,[e("div",bp,[(d(!0),p(W,null,te(k.value,v=>(d(),p("div",{key:v.name,class:Z(["character-tile",{selected:w.value===v.name,disabled:v.enabled===!1}]),onClick:L=>Ot(v.name)},[e("div",yp,[v.reference_image?(d(),p("img",{key:0,src:A(v.name),alt:""},null,8,_p)):(d(),p("div",$p,[e("span",null,$(v.name.charAt(0)),1)])),v.forms&&v.forms.length>1?(d(),p("div",wp,$(v.forms.length),1)):M("",!0),v.enabled===!1?(d(),p("div",xp,"ç¦ç”¨")):M("",!0)]),e("div",Cp,$(v.name),1)],10,kp))),128))]),e("div",{class:Z(["character-detail-panel",{"has-selection":w.value}])},[de()?(d(),p(W,{key:0},[e("div",Sp,[e("div",Pp,[e("div",Ip,[de()?.reference_image?(d(),p("img",{key:0,src:A(de().name),alt:""},null,8,Rp)):(d(),p("div",Tp,$(de()?.name.charAt(0)),1))]),e("div",Ap,[e("h4",null,$(de()?.name),1),de()?.aliases?.length?(d(),p("p",Up," åˆ«åï¼š"+$(de()?.aliases.join("ã€")),1)):M("",!0)])]),e("div",Bp,[e("label",Mp,[e("input",{type:"checkbox",checked:de()?.enabled!==!1,onChange:c[3]||(c[3]=v=>jt(de().name,v.target.checked))},null,40,Lp),c[36]||(c[36]=e("span",{class:"toggle-slider"},null,-1))]),e("button",{class:"icon-btn-lg",onClick:c[4]||(c[4]=v=>Lt(de())),title:"ç¼–è¾‘è§’è‰²"},"âœï¸"),e("button",{class:"icon-btn-lg danger",onClick:c[5]||(c[5]=v=>Vt(de())),title:"åˆ é™¤è§’è‰²"},"ðŸ—‘ï¸")])]),e("div",Ep,[e("div",zp,[e("h5",null,"è§’è‰²å½¢æ€ ("+$(de()?.forms?.length||1)+")",1),e("button",{class:"btn small secondary",onClick:c[6]||(c[6]=v=>Kt(de().name))}," âž• æ·»åŠ å½¢æ€ ")]),e("div",Dp,[(d(!0),p(W,null,te(de()?.forms||[],v=>(d(),p("div",{key:v.form_id,class:Z(["form-tile",{disabled:v.enabled===!1}])},[e("div",Vp,[v.reference_image?(d(),p("img",{key:0,src:Gt(de().name,v.form_id),alt:""},null,8,Op)):(d(),p("div",Kp,[...c[37]||(c[37]=[e("span",null,"ðŸ“·",-1),e("p",null,"æœªä¸Šä¼ ",-1)])])),e("label",qp,[e("span",null,$(v.reference_image?"æ›´æ¢":"ä¸Šä¼ "),1),e("input",{type:"file",accept:"image/*",hidden:"",onChange:L=>Nt(de().name,v.form_id,L)},null,40,Fp)])]),e("div",Np,[e("div",jp,[ae($(v.form_name)+" ",1),v.enabled===!1?(d(),p("span",Gp,"ç¦ç”¨")):M("",!0)]),v.description?(d(),p("p",Qp,$(v.description),1)):M("",!0)]),e("div",Hp,[e("label",Jp,[e("input",{type:"checkbox",checked:v.enabled!==!1,onChange:L=>pt(de().name,v.form_id,L.target.checked)},null,40,Zp),c[38]||(c[38]=e("span",{class:"toggle-slider"},null,-1))]),e("button",{class:"mini-btn primary",onClick:L=>Qt(de(),v.form_id,v.form_name),title:"ç”Ÿæˆä¸‰è§†å›¾"},"ðŸŽ¨",8,Wp),v.reference_image?(d(),p("button",{key:0,class:"mini-btn",onClick:L=>dt(de().name,v.form_id)},"ðŸ—‘ï¸",8,Xp)):M("",!0),e("button",{class:"mini-btn",onClick:L=>qt(de().name,v)},"ç¼–è¾‘",8,Yp),e("button",{class:"mini-btn danger",onClick:L=>ct(de().name,v)},"åˆ é™¤",8,ev)])],2))),128))])])],64)):(d(),p("div",tv,[...c[39]||(c[39]=[e("div",{class:"detail-empty-icon"},"ðŸ‘ˆ",-1),e("p",null,"é€‰æ‹©å·¦ä¾§è§’è‰²æŸ¥çœ‹è¯¦æƒ…",-1)])]))],2)]))]),e("div",sv,[ke.value||X.value.length>0?(d(),p("button",{key:0,class:"btn danger",disabled:s.value,onClick:js}," ðŸ—‘ï¸ æ¸…é™¤æ•°æ®é‡æ–°å¼€å§‹ ",8,nv)):M("",!0),e("button",{class:"btn primary",disabled:!yt.value||s.value,onClick:c[7]||(c[7]=v=>Pe(1))}," ä¸‹ä¸€æ­¥ï¼šç”Ÿæˆè„šæœ¬ â†’ ",8,av)])],512),[[_e,n.value===0]]),K(e("div",lv,[c[42]||(c[42]=e("h3",null,"ðŸ“œ å…¨è¯è„šæœ¬",-1)),ke.value?(d(),p("div",iv,[e("div",uv,[e("h4",null,$(ke.value.chapter_title),1),e("span",cv,"å…± "+$(ke.value.page_count)+" é¡µ",1)]),K(e("textarea",{"onUpdate:modelValue":c[8]||(c[8]=v=>ke.value.script_text=v),class:"script-textarea",rows:"20"},null,512),[[G,ke.value.script_text]]),e("div",dv,[e("button",{class:"btn secondary",onClick:ue,disabled:je.value}," ðŸ”„ é‡æ–°ç”Ÿæˆ ",8,pv)])])):(d(),p("div",ov,[c[41]||(c[41]=e("p",null,"æ ¹æ®å·²åˆ†æžçš„æ¼«ç”»å†…å®¹å’Œæ‚¨çš„è®¾ç½®ï¼Œç”Ÿæˆç»­å†™è„šæœ¬ã€‚",-1)),e("button",{class:"btn primary",disabled:je.value,onClick:ue},$(je.value?"ç”Ÿæˆä¸­...":"ðŸŽ¬ ç”Ÿæˆè„šæœ¬"),9,rv)])),e("div",vv,[e("button",{class:"btn secondary",onClick:c[9]||(c[9]=v=>Pe(0))},"â† ä¸Šä¸€æ­¥"),e("button",{class:"btn primary",disabled:!_t.value,onClick:c[10]||(c[10]=v=>Pe(2))}," ä¸‹ä¸€æ­¥ï¼šé¡µé¢ç»†åŒ– â†’ ",8,mv)])],512),[[_e,n.value===1]]),K(e("div",gv,[c[49]||(c[49]=e("h3",null,"ðŸ“„ é¡µé¢å‰§æƒ…",-1)),X.value.length===0?(d(),p("div",fv,[c[43]||(c[43]=e("p",null,"å°†è„šæœ¬æ‹†åˆ†ä¸ºæ¯é¡µè¯¦ç»†å†…å®¹å’Œç”Ÿå›¾æç¤ºè¯ã€‚",-1)),e("button",{class:"btn primary",disabled:tt.value,onClick:We},$(tt.value?"ç”Ÿæˆä¸­...":"ðŸ“‘ ç”Ÿæˆé¡µé¢è¯¦æƒ…"),9,hv)])):(d(),p("div",bv,[(d(!0),p(W,null,te(X.value,v=>(d(),p("div",{key:v.page_number,class:"page-card"},[e("div",kv,[e("span",yv,"ç¬¬ "+$(v.page_number)+" é¡µ",1),e("span",_v,$(v.mood),1)]),e("div",$v,[e("div",wv,[c[44]||(c[44]=e("label",null,"äººç‰©ï¼š",-1)),e("input",{type:"text",value:v.characters.join(", "),class:"page-input",onChange:L=>Ie(v,L)},null,40,xv)]),e("div",Cv,[c[45]||(c[45]=e("label",null,"æè¿°ï¼š",-1)),K(e("textarea",{"onUpdate:modelValue":L=>v.description=L,class:"page-textarea",rows:"3",onChange:Ke},null,40,Sv),[[G,v.description]])]),v.dialogues.length?(d(),p("div",Pv,[c[47]||(c[47]=e("label",null,"å¯¹è¯ï¼š",-1)),e("div",Iv,[(d(!0),p(W,null,te(v.dialogues,(L,J)=>(d(),p("div",{key:J,class:"dialogue-item"},[K(e("input",{type:"text","onUpdate:modelValue":ee=>L.character=ee,class:"dialogue-speaker",placeholder:"è§’è‰²",onChange:Ke},null,40,Rv),[[G,L.character]]),c[46]||(c[46]=e("span",{class:"dialogue-sep"},":",-1)),K(e("input",{type:"text","onUpdate:modelValue":ee=>L.text=ee,class:"dialogue-text",placeholder:"å¯¹è¯å†…å®¹",onChange:Ke},null,40,Tv),[[G,L.text]])]))),128))])])):M("",!0)]),e("div",Av,[e("div",Uv,[c[48]||(c[48]=e("label",null,"ç”Ÿå›¾æç¤ºè¯ï¼š",-1)),e("button",{class:"btn-small",disabled:st.value===v.page_number,onClick:L=>re(v.page_number)},$(st.value===v.page_number?"ç”Ÿæˆä¸­...":"ðŸ”„ é‡æ–°ç”Ÿæˆ"),9,Bv)]),K(e("textarea",{"onUpdate:modelValue":L=>v.image_prompt=L,class:"page-textarea prompt-textarea",rows:"4",onChange:Ke},null,40,Mv),[[G,v.image_prompt]])])]))),128)),e("div",Lv,[e("button",{class:"btn secondary",disabled:De.value,onClick:Oe},$(De.value?"ç”Ÿæˆä¸­...":"ðŸŽ¨ é‡æ–°ç”Ÿæˆæç¤ºè¯"),9,Ev),e("button",{class:"btn secondary",onClick:Re}," ðŸ’¾ ä¿å­˜ä¿®æ”¹ ")])])),e("div",zv,[e("button",{class:"btn secondary",onClick:c[11]||(c[11]=v=>Pe(1))},"â† ä¸Šä¸€æ­¥"),e("button",{class:"btn primary",disabled:!Bt.value,onClick:c[12]||(c[12]=v=>Pe(3))}," ä¸‹ä¸€æ­¥ï¼šç”Ÿæˆå›¾ç‰‡ â†’ ",8,Dv)])],512),[[_e,n.value===2]]),K(e("div",Vv,[c[51]||(c[51]=e("h3",null,"ðŸŽ¨ å›¾ç‰‡ç”Ÿæˆ",-1)),e("div",Ov,[e("button",{class:"btn primary large",disabled:Qe.value,onClick:Os},$(Qe.value?"ç”Ÿæˆä¸­...":"ðŸš€ å¼€å§‹æ‰¹é‡ç”Ÿæˆ"),9,Kv),e("div",qv,[e("span",null,"å·²å®Œæˆï¼š"+$($t.value)+" / "+$(X.value.length)+" é¡µ",1)])]),Qe.value?(d(),p("div",Fv,[e("div",{class:"progress-fill",style:ws({width:Ge.value+"%"})},null,4)])):M("",!0),e("div",Nv,[(d(!0),p(W,null,te(X.value,v=>(d(),p("div",{key:v.page_number,class:"generated-card"},[e("div",jv,[e("span",Gv,"ç¬¬ "+$(v.page_number)+" é¡µ",1),e("span",{class:Z(["status",v.status])},$(v.status==="pending"?"ç­‰å¾…ä¸­":v.status==="generating"?"ç”Ÿæˆä¸­":v.status==="generated"?"å·²å®Œæˆ":"å¤±è´¥"),3)]),e("div",Qv,[e("div",Hv,[v.image_url?(d(),p("img",{key:0,src:ye(v.image_url),alt:"ç”Ÿæˆå›¾ç‰‡"},null,8,Jv)):(d(),p("div",Zv,$(v.status==="generating"?"â³ ç”Ÿæˆä¸­...":"ç­‰å¾…ç”Ÿæˆ"),1))]),e("div",Wv,[c[50]||(c[50]=e("label",null,"æç¤ºè¯ï¼š",-1)),K(e("textarea",{"onUpdate:modelValue":L=>v.image_prompt=L,rows:"4",disabled:v.status==="generating"},null,8,Xv),[[G,v.image_prompt]])])]),e("div",Yv,[e("button",{class:"btn small",disabled:v.status==="generating",onClick:L=>Ks(v.page_number)}," ðŸ”„ é‡æ–°ç”Ÿæˆ ",8,em),v.previous_url?(d(),p("button",{key:0,class:"btn small secondary",onClick:L=>qs(v.page_number)}," â—€ ä¸Šä¸€ç‰ˆæœ¬ ",8,tm)):M("",!0)])]))),128))]),e("div",sm,[e("button",{class:"btn secondary",onClick:c[13]||(c[13]=v=>Pe(2))},"â† ä¸Šä¸€æ­¥"),e("button",{class:"btn primary",disabled:!Mt.value,onClick:c[14]||(c[14]=v=>Pe(4))}," ä¸‹ä¸€æ­¥ï¼šå¯¼å‡º â†’ ",8,nm)])],512),[[_e,n.value===3]]),K(e("div",am,[c[56]||(c[56]=e("h3",null,"ðŸ“¦ å¯¼å‡ºæˆå“",-1)),e("div",lm,[e("div",om,[e("p",null,[c[52]||(c[52]=ae("å…±ç”Ÿæˆ ",-1)),e("strong",null,$($t.value),1),c[53]||(c[53]=ae(" é¡µå›¾ç‰‡ï¼Œå¯å¯¼å‡ºä¸ºä»¥ä¸‹æ ¼å¼ï¼š",-1))])]),e("div",rm,[e("div",{class:Z(["format-card",{selected:Je.value==="images"}]),onClick:c[15]||(c[15]=v=>Je.value="images")},[...c[54]||(c[54]=[e("span",{class:"format-icon"},"ðŸ–¼ï¸",-1),e("span",{class:"format-name"},"å›¾ç‰‡ ZIP",-1),e("span",{class:"format-desc"},"æ‰€æœ‰é¡µé¢æ‰“åŒ…ä¸‹è½½",-1)])],2),e("div",{class:Z(["format-card",{selected:Je.value==="pdf"}]),onClick:c[16]||(c[16]=v=>Je.value="pdf")},[...c[55]||(c[55]=[e("span",{class:"format-icon"},"ðŸ“„",-1),e("span",{class:"format-name"},"PDF æ–‡æ¡£",-1),e("span",{class:"format-desc"},"æ–¹ä¾¿é˜…è¯»å’Œåˆ†äº«",-1)])],2)]),e("button",{class:"btn primary large",disabled:s.value,onClick:c[17]||(c[17]=v=>Je.value==="images"?Fs():Ns())},$(s.value?"å¯¼å‡ºä¸­...":"ðŸ“¥ ä¸‹è½½"),9,im)]),e("div",um,[e("button",{class:"btn secondary",onClick:c[18]||(c[18]=v=>Pe(3))},"â† è¿”å›žç”Ÿæˆ")])],512),[[_e,n.value===4]])]),R.value?(d(),p("div",{key:2,class:"modal-overlay",onClick:fe(me,["self"])},[e("div",cm,[e("div",dm,[e("h3",null,[ae("ðŸŽ¨ ç”Ÿæˆä¸‰è§†å›¾ - "+$(U.value?.name)+" ",1),D.value&&D.value!=="é»˜è®¤"?(d(),p("span",pm,"("+$(D.value)+")",1)):M("",!0)]),e("button",{class:"close-btn",onClick:me},"Ã—")]),e("div",vm,[e("div",mm,[e("label",{class:Z(["upload-area",{"drag-over":o.value}]),onDragenter:Jt,onDragover:Zt,onDragleave:Wt,onDrop:Xt},[e("input",{type:"file",accept:"image/*",multiple:"",hidden:"",onChange:Ht},null,32),e("div",gm,[e("span",fm,$(o.value?"ðŸ“¥":"ðŸ“"),1),o.value?(d(),p("p",hm,"é‡Šæ”¾ä»¥ä¸Šä¼ å›¾ç‰‡")):(d(),p("p",bm,"ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ‹½è§’è‰²å›¾ç‰‡ï¼ˆ1-5å¼ ï¼‰")),c[57]||(c[57]=e("p",{class:"hint"},"å¯ä¸Šä¼ å¤šå¼ å›¾ç‰‡å¸®åŠ©AIç†è§£è§’è‰²ç‰¹å¾",-1))])],34),F.value.length>0?(d(),p("div",km,[(d(!0),p(W,null,te(F.value,(v,L)=>(d(),p("div",{key:L,class:"source-image"},[e("img",{src:Y(v),alt:`æºå›¾${L+1}`},null,8,ym),e("span",_m,$(L+1),1)]))),128))])):M("",!0)]),q.value?(d(),p("div",$m,[c[58]||(c[58]=e("div",{class:"spinner"},null,-1)),e("p",wm,$(j.value),1),c[59]||(c[59]=e("p",{class:"progress-tip"},"â±ï¸ AI ç”Ÿæˆé€šå¸¸éœ€è¦ 30-60 ç§’",-1))])):B.value?(d(),p("div",xm,[c[60]||(c[60]=e("h4",null,"ç”Ÿæˆç»“æžœï¼š",-1)),e("div",Cm,[e("img",{src:we(),alt:"ä¸‰è§†å›¾"},null,8,Sm)])])):M("",!0)]),e("div",Pm,[e("button",{class:"btn secondary",onClick:me},"å–æ¶ˆ"),B.value?(d(),p("div",Rm,[e("button",{class:"btn secondary",onClick:wt},"é‡æ–°ç”Ÿæˆ"),e("button",{class:"btn primary",onClick:_},"âœ“ ä½¿ç”¨ä¸‰è§†å›¾")])):(d(),p("button",{key:0,class:"btn primary",disabled:F.value.length===0||q.value,onClick:wt},$(q.value?"ç”Ÿæˆä¸­...":"ðŸŽ¨ ç”Ÿæˆä¸‰è§†å›¾"),9,Im))])])])):M("",!0),r.value?(d(),p("div",{key:3,class:"modal-overlay",onClick:fe(nt,["self"])},[e("div",Tm,[e("div",{class:"modal-header"},[c[61]||(c[61]=e("h3",null,"âœï¸ ç¼–è¾‘è§’è‰²",-1)),e("button",{class:"close-btn",onClick:nt},"Ã—")]),e("div",Am,[e("div",Um,[c[62]||(c[62]=e("label",null,"è§’è‰²åç§°",-1)),K(e("input",{"onUpdate:modelValue":c[19]||(c[19]=v=>S.value=v),type:"text",class:"form-input",placeholder:"è¾“å…¥è§’è‰²ä¸»åç§°"},null,512),[[G,S.value]])]),e("div",Bm,[c[63]||(c[63]=e("label",null,"åˆ«åï¼ˆç”¨é€—å·åˆ†éš”ï¼‰",-1)),K(e("input",{"onUpdate:modelValue":c[20]||(c[20]=v=>T.value=v),type:"text",class:"form-input",placeholder:"ä¾‹å¦‚: æ¡ä¹ƒ, æ–°åž£å½©ä¸–"},null,512),[[G,T.value]]),c[64]||(c[64]=e("p",{class:"form-hint"},"AIç”Ÿæˆè„šæœ¬æ—¶å¯èƒ½ä½¿ç”¨è¿™äº›åå­—å¼•ç”¨è§’è‰²",-1))])]),e("div",{class:"modal-footer"},[e("button",{class:"btn secondary",onClick:nt},"å–æ¶ˆ"),e("button",{class:"btn primary",onClick:Et},"ðŸ’¾ ä¿å­˜")])])])):M("",!0),C.value?(d(),p("div",{key:4,class:"modal-overlay",onClick:fe(at,["self"])},[e("div",Mm,[e("div",{class:"modal-header"},[c[65]||(c[65]=e("h3",null,"âž• æ–°å¢žè§’è‰²",-1)),e("button",{class:"close-btn",onClick:at},"Ã—")]),e("div",Lm,[e("div",Em,[c[66]||(c[66]=e("label",null,[ae("è§’è‰²åç§° "),e("span",{class:"required"},"*")],-1)),K(e("input",{"onUpdate:modelValue":c[21]||(c[21]=v=>V.value=v),type:"text",class:"form-input",placeholder:"è¾“å…¥è§’è‰²åç§°"},null,512),[[G,V.value]])]),e("div",zm,[c[67]||(c[67]=e("label",null,"åˆ«åï¼ˆç”¨é€—å·åˆ†éš”ï¼Œå¯é€‰ï¼‰",-1)),K(e("input",{"onUpdate:modelValue":c[22]||(c[22]=v=>se.value=v),type:"text",class:"form-input",placeholder:"ä¾‹å¦‚: å°æ˜Ž, é˜¿æ˜Ž"},null,512),[[G,se.value]])]),e("div",Dm,[c[68]||(c[68]=e("label",null,"è§’è‰²æè¿°ï¼ˆå¯é€‰ï¼‰",-1)),K(e("textarea",{"onUpdate:modelValue":c[23]||(c[23]=v=>Q.value=v),rows:"3",class:"form-input",placeholder:"ç®€å•æè¿°è§’è‰²çš„å¤–è§‚ç‰¹å¾..."},null,512),[[G,Q.value]])])]),e("div",Vm,[e("button",{class:"btn secondary",onClick:at},"å–æ¶ˆ"),e("button",{class:"btn primary",disabled:!V.value.trim()||I.value,onClick:Dt},$(I.value?"æ·»åŠ ä¸­...":"âœ“ ç¡®è®¤æ·»åŠ "),9,Om)])])])):M("",!0),z.value?(d(),p("div",{key:5,class:"modal-overlay",onClick:fe(lt,["self"])},[e("div",Km,[e("div",{class:"modal-header"},[c[69]||(c[69]=e("h3",null,"âž• æ–°å¢žå½¢æ€",-1)),e("button",{class:"close-btn",onClick:lt},"Ã—")]),e("div",qm,[e("div",Fm,[c[70]||(c[70]=e("label",null,[ae("å½¢æ€ID "),e("span",{class:"required"},"*")],-1)),K(e("input",{"onUpdate:modelValue":c[24]||(c[24]=v=>ce.value=v),type:"text",class:"form-input",placeholder:"ä¾‹å¦‚: battle, dark, casual"},null,512),[[G,ce.value]]),c[71]||(c[71]=e("p",{class:"form-hint"},"è‹±æ–‡æ ‡è¯†ç¬¦ï¼Œç”¨äºŽç³»ç»Ÿè¯†åˆ«",-1))]),e("div",Nm,[c[72]||(c[72]=e("label",null,[ae("å½¢æ€åç§° "),e("span",{class:"required"},"*")],-1)),K(e("input",{"onUpdate:modelValue":c[25]||(c[25]=v=>be.value=v),type:"text",class:"form-input",placeholder:"ä¾‹å¦‚: æˆ˜æ–—æœã€é»‘åŒ–å½¢æ€"},null,512),[[G,be.value]])]),e("div",jm,[c[73]||(c[73]=e("label",null,"å½¢æ€æè¿°ï¼ˆå¯é€‰ï¼‰",-1)),K(e("textarea",{"onUpdate:modelValue":c[26]||(c[26]=v=>Ce.value=v),rows:"2",class:"form-input",placeholder:"ç®€å•æè¿°è¯¥å½¢æ€çš„ç‰¹å¾..."},null,512),[[G,Ce.value]])])]),e("div",Gm,[e("button",{class:"btn secondary",onClick:lt},"å–æ¶ˆ"),e("button",{class:"btn primary",disabled:!ce.value.trim()||!be.value.trim()||Me.value,onClick:Ze},$(Me.value?"æ·»åŠ ä¸­...":"âœ“ ç¡®è®¤æ·»åŠ "),9,Qm)])])])):M("",!0),Fe.value?(d(),p("div",{key:6,class:"modal-overlay",onClick:fe(Ve,["self"])},[e("div",Hm,[e("div",{class:"modal-header"},[c[74]||(c[74]=e("h3",null,"âœï¸ ç¼–è¾‘å½¢æ€",-1)),e("button",{class:"close-btn",onClick:Ve},"Ã—")]),e("div",Jm,[e("div",Zm,[c[75]||(c[75]=e("label",null,"å½¢æ€åç§°",-1)),K(e("input",{"onUpdate:modelValue":c[27]||(c[27]=v=>Ue.value=v),type:"text",class:"form-input",placeholder:"å½¢æ€æ˜¾ç¤ºå"},null,512),[[G,Ue.value]])]),e("div",Wm,[c[76]||(c[76]=e("label",null,"å½¢æ€æè¿°",-1)),K(e("textarea",{"onUpdate:modelValue":c[28]||(c[28]=v=>Ne.value=v),rows:"2",class:"form-input",placeholder:"å½¢æ€æè¿°..."},null,512),[[G,Ne.value]])])]),e("div",Xm,[e("button",{class:"btn secondary",onClick:Ve},"å–æ¶ˆ"),e("button",{class:"btn primary",disabled:et.value,onClick:Ft},$(et.value?"ä¿å­˜ä¸­...":"ðŸ’¾ ä¿å­˜"),9,Ym)])])])):M("",!0)]))}}),tg=Se(eg,[["__scopeId","data-v-4a58897c"]]),sg={class:"insight-page"},ng={class:"app-header"},ag={class:"header-content"},lg={class:"logo-container"},og={class:"header-links"},rg={class:"insight-main"},ig={class:"sidebar-section book-info-section"},ug={class:"book-cover-wrapper"},cg=["src"],dg={key:1,class:"book-cover-placeholder"},pg=["title"],vg={class:"book-meta"},mg={class:"meta-item"},gg={id:"totalPages"},fg={class:"meta-item"},hg={id:"analyzedPages"},bg={class:"insight-content"},kg={key:0,class:"select-book-prompt"},yg={key:1,class:"content-tabs"},_g={class:"tabs-wrapper"},$g={class:"tab-content"},wg={class:"tab-content"},xg={class:"tab-content"},Cg={class:"tab-content"},Sg=ge({__name:"InsightView",setup(l){const t=Js(),n=Xs(),a=he(),s=xs(),i=h("overview"),u=h(!1),b=h(!1),m=h(!1);let f=null;const k=h(null),P=h(!1),R=N(()=>k.value?k.value:a.currentBookId?s.books.find(w=>w.id===a.currentBookId):null),U=N(()=>!!a.currentBookId),E=N(()=>R.value?.cover?R.value.cover:"");function D(w){i.value=w}async function F(w){if(w){a.setCurrentBook(w),a.setLoading(!0);try{const ne=await(await fetch(`/api/bookshelf/books/${w}`)).json();if(!ne.success)throw new Error(ne.error||"èŽ·å–ä¹¦ç±ä¿¡æ¯å¤±è´¥");if(ne.book&&(k.value={id:ne.book.id,title:ne.book.title,cover:ne.book.cover,total_pages:ne.book.total_pages||0},a.setBookTotalPages(ne.book.total_pages||0),ne.book.chapters&&ne.book.chapters.length>0)){let ce=0;const be=ne.book.chapters.map((Ce,Me)=>{const Fe=Ce.id||Ce.chapter_id||`ch_${Me+1}`,Le=Ce.page_count||Ce.pages?.length||0,Ee=ce+1,Ue=ce+Le;return ce=Ue,{id:Fe,title:Ce.title||`ç¬¬ ${Me+1} ç« `,startPage:Ee,endPage:Ue}});a.setChapters(be)}if(await q(),a.chapters.length===0)try{const ce=await cn(w);ce.success&&ce.chapters&&ce.chapters.length>0&&a.setChapters(ce.chapters.map(be=>({id:be.id,title:be.title,startPage:be.start_page,endPage:be.end_page})))}catch(ce){console.warn("èŽ·å–ç« èŠ‚åˆ—è¡¨å¤±è´¥:",ce)}await a.loadNotesFromAPI(),n.replace({query:{book:w}}),a.isAnalyzing&&j()}catch(z){console.error("åŠ è½½ä¹¦ç±å¤±è´¥:",z),a.setError(z instanceof Error?z.message:"åŠ è½½ä¹¦ç±å¤±è´¥")}finally{a.setLoading(!1)}}}async function q(){if(a.currentBookId)try{const w=await Cs(a.currentBookId);if(w.success)if(w.analyzed_pages_count!==void 0&&a.setAnalyzedPagesCount(w.analyzed_pages_count),w.current_task){const z=w.current_task.status;z==="running"?(a.setAnalysisStatus("running"),w.current_task.progress&&a.updateProgress(w.current_task.progress.analyzed_pages||0,w.current_task.progress.total_pages||0)):z==="paused"?a.setAnalysisStatus("paused"):z==="completed"?a.setAnalysisStatus("completed"):z==="failed"?a.setAnalysisStatus("failed"):a.setAnalysisStatus("idle")}else w.analyzed?a.setAnalysisStatus("completed"):a.setAnalysisStatus("idle")}catch(w){console.error("èŽ·å–åˆ†æžçŠ¶æ€å¤±è´¥:",w)}}function j(){B(),f=setInterval(async()=>{await q();const w=a.analysisStatus;(w==="completed"||w==="failed"||w==="idle")&&(B(),w==="completed"&&(console.log("åˆ†æžå®Œæˆï¼Œç­‰å¾…1ç§’åŽåˆ·æ–°æ•°æ®..."),setTimeout(async()=>{console.log("å¼€å§‹åˆ·æ–°æ¦‚è§ˆå’Œæ—¶é—´çº¿æ•°æ®"),await q(),a.triggerDataRefresh()},1e3)))},3e3)}function B(){f&&(clearInterval(f),f=null)}function x(){u.value=!0}function o(){en("ðŸŒ™ è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼","info")}function r(){u.value=!1}function g(){b.value=!b.value,b.value&&(m.value=!1)}function S(){m.value=!m.value,m.value&&(b.value=!1)}function T(){if(!a.currentBookId){n.push("/translate");return}const w=a.chapters;!w||w.length===0?n.push({path:"/translate",query:{book:a.currentBookId}}):w.length===1?n.push({path:"/translate",query:{book:a.currentBookId,chapter:w[0].id}}):P.value=!0}function C(w){P.value=!1,n.push({path:"/translate",query:{book:a.currentBookId,chapter:w}})}function V(){P.value=!1}let se="",Q="",I="";return qe(async()=>{const w=document.body.style;se=w.padding,Q=w.margin,I=w.overflow,w.padding="0",w.margin="0",w.overflow="hidden",await s.fetchBooks();const z=t.query.book;z&&await F(z)}),Zs(()=>{B();const w=document.body.style;w.padding=se,w.margin=Q,w.overflow=I}),Be(()=>a.isAnalyzing,w=>{w?j():B()}),(w,z)=>{const ne=Ws("router-link");return d(),p("div",sg,[e("header",ng,[e("div",ag,[e("div",lg,[ie(ne,{to:"/",title:"ä¹¦æž¶é¦–é¡µ"},{default:Pt(()=>[...z[4]||(z[4]=[e("img",{src:"/pic/logo.png",alt:"Saber-Translator Logo",class:"app-logo"},null,-1),e("span",{class:"app-name"},"Saber-Translator",-1)])]),_:1})]),e("div",og,[ie(ne,{to:"/",class:"nav-link"},{default:Pt(()=>[...z[5]||(z[5]=[ae("ðŸ“š ä¹¦æž¶",-1)])]),_:1}),e("a",{href:"javascript:void(0)",class:"nav-link",onClick:T},"ðŸŒ ç¿»è¯‘"),z[7]||(z[7]=e("span",{class:"nav-link active"},"ðŸ” åˆ†æž",-1)),z[8]||(z[8]=e("a",{href:"https://www.mashirosaber.top/use/manga-insight.html",target:"_blank",class:"nav-link",title:"ä½¿ç”¨æ•™ç¨‹"},"ðŸ“– æ•™ç¨‹",-1)),e("button",{id:"settingsBtn",class:"btn btn-icon",title:"è®¾ç½®",onClick:x},"âš™ï¸"),e("button",{id:"themeToggle",class:"theme-toggle",title:"åŠŸèƒ½å¼€å‘ä¸­",onClick:o},[...z[6]||(z[6]=[e("span",{class:"theme-icon"},"â˜€ï¸",-1)])])])])]),e("main",rg,[e("aside",{class:Z(["insight-sidebar",{"mobile-visible":b.value}])},[e("div",ig,[e("div",ug,[E.value?(d(),p("img",{key:0,src:E.value,alt:"å°é¢",class:"book-cover"},null,8,cg)):(d(),p("div",dg,[...z[9]||(z[9]=[e("span",null,"ðŸ“–",-1)])]))]),e("h2",{class:"book-title",title:R.value?.title},$(R.value?.title||"é€‰æ‹©ä¹¦ç±"),9,pg),e("div",vg,[e("span",mg,[z[10]||(z[10]=e("span",{class:"meta-icon"},"ðŸ“„",-1)),e("span",gg,$(R.value?.total_pages||0),1),z[11]||(z[11]=ae(" é¡µ ",-1))]),e("span",fg,[z[12]||(z[12]=e("span",{class:"meta-icon"},"ðŸ“Š",-1)),e("span",hg,$(pe(a).analyzedPageCount),1),z[13]||(z[13]=ae(" å·²åˆ†æž ",-1))])])]),U.value?(d(),rt(sa,{key:0,onStartPolling:j,onStopPolling:B})):M("",!0),U.value?(d(),rt(eu,{key:1})):M("",!0)],2),e("div",bg,[U.value?(d(),p("div",yg,[e("button",{class:"mobile-nav-btn",onClick:g,"aria-label":"æ‰“å¼€å¯¼èˆª"}," ðŸ“š "),e("div",_g,[e("button",{class:Z(["tab-btn",{active:i.value==="overview"}]),onClick:z[0]||(z[0]=ce=>D("overview"))},[...z[17]||(z[17]=[e("span",{class:"tab-icon"},"ðŸ“Š",-1),ae(" æ¦‚è§ˆ ",-1)])],2),e("button",{class:Z(["tab-btn",{active:i.value==="qa"}]),onClick:z[1]||(z[1]=ce=>D("qa"))},[...z[18]||(z[18]=[e("span",{class:"tab-icon"},"ðŸ’¬",-1),ae(" æ™ºèƒ½é—®ç­” ",-1)])],2),e("button",{class:Z(["tab-btn",{active:i.value==="timeline"}]),onClick:z[2]||(z[2]=ce=>D("timeline"))},[...z[19]||(z[19]=[e("span",{class:"tab-icon"},"ðŸ“ˆ",-1),ae(" æ—¶é—´çº¿ ",-1)])],2),e("button",{class:Z(["tab-btn",{active:i.value==="continuation"}]),onClick:z[3]||(z[3]=ce=>D("continuation"))},[...z[20]||(z[20]=[e("span",{class:"tab-icon"},"ðŸŽ¨",-1),ae(" ç»­å†™ ",-1)])],2)]),e("button",{class:"mobile-nav-btn",onClick:S,"aria-label":"æ‰“å¼€ç¬”è®°"}," ðŸ“ ")])):(d(),p("div",kg,[z[14]||(z[14]=e("div",{class:"prompt-icon"},"ðŸ“š",-1)),z[15]||(z[15]=e("h2",null,"é€‰æ‹©è¦åˆ†æžçš„ä¹¦ç±",-1)),z[16]||(z[16]=e("p",null,"ä»Žä¸‹æ–¹åˆ—è¡¨ä¸­é€‰æ‹©ä¸€æœ¬ä¹¦ç±å¼€å§‹æ™ºèƒ½åˆ†æž",-1)),ie(An,{onSelect:F})])),K(e("div",$g,[ie(ml)],512),[[_e,i.value==="overview"&&U.value]]),K(e("div",wg,[ie(rr)],512),[[_e,i.value==="qa"&&U.value]]),K(e("div",xg,[ie(ko)],512),[[_e,i.value==="timeline"&&U.value]]),K(e("div",Cg,[ie(tg)],512),[[_e,i.value==="continuation"&&U.value]])]),U.value?(d(),p("aside",{key:0,class:Z(["insight-workspace",{"mobile-visible":m.value}])},[ie(Bi),ie(Xr)],2)):M("",!0)]),u.value?(d(),rt(bd,{key:0,onClose:r})):M("",!0),P.value&&pe(a).currentBookId?(d(),rt(Ad,{key:1,chapters:pe(a).chapters,onSelect:C,onClose:V},null,8,["chapters"])):M("",!0)])}}}),Eg=Se(Sg,[["__scopeId","data-v-de53b84a"]]);export{Eg as default};
