const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/bookshelf.B4ums9uK.js","js/client.Bht704G-.js","js/utils-vendor.B9ygI19o.js"])))=>i.map(i=>d[i]);
import{u as Y,_ as Ie}from"./bookshelfStore.DCAN6Zs_.js";import{a as Q,c as x,e as i,k as a,f as e,h as S,t as _,F,j as O,i as ee,r as b,v as N,z as P,A as X,n as re,o as ie,g as R,m as te,u as Z,p as oe,T as le,y as ge,B as Me,b as ke,l as fe,C as Se,D as me}from"./vue-vendor.DwHUB8Dr.js";import"./client.Bht704G-.js";import{g as Ee}from"./system.DR5RJocQ.js";import{getBookDetail as be}from"./bookshelf.B4ums9uK.js";import{_ as G,s as c,a as xe}from"./index.BDlD_Y71.js";import{B as he}from"./BaseModal.CncnZcl-.js";import"./utils-vendor.B9ygI19o.js";const Ae="/pic/github.jpg",Le={class:"book-cover"},qe=["src","alt"],Ve={key:1,class:"book-cover-placeholder"},Ue={class:"book-info"},Re=["title"],Fe={class:"book-chapter-count"},Ke={key:0,class:"book-tags"},Ne=Q({__name:"BookCard",props:{book:{}},emits:["click"],setup(w,{emit:L}){const v=L,C=Y(),d=x(()=>C.tags);function m(){v("click")}function g(y){return d.value.find(o=>o.name===y)?.color||"#667eea"}function f(y){return!!y.cover&&y.cover.length>0}function p(y){const B=y.target;if(B.parentElement){B.style.display="none";const o=document.createElement("div");o.className="book-cover-placeholder",o.textContent="ðŸ“–",B.parentElement.appendChild(o)}}return(y,B)=>(a(),i("div",{class:"book-card",onClick:m},[e("div",Le,[f(w.book)?(a(),i("img",{key:0,src:w.book.cover,alt:w.book.title,onError:p},null,40,qe)):(a(),i("div",Ve,"ðŸ“–"))]),e("div",Ue,[e("h3",{class:"book-title",title:w.book.title},_(w.book.title),9,Re),e("p",Fe,_(w.book.chapter_count||w.book.chapters?.length||0)+" ç« èŠ‚",1),w.book.tags&&w.book.tags.length>0?(a(),i("div",Ke,[(a(!0),i(F,null,O(w.book.tags,o=>(a(),i("span",{key:o,class:"book-tag",style:ee({background:g(o)})},_(o),5))),128))])):S("",!0)])]))}}),Pe=G(Ne,[["__scopeId","data-v-231a1896"]]),Oe={class:"filter-bar"},ze={class:"search-box"},Qe={key:0,class:"tag-filter"},Ge={class:"tag-chips"},We=["onClick"],je=Q({__name:"BookSearch",props:{tags:{}},emits:["search","filterTag"],setup(w,{emit:L}){const v=L,C=Y(),d=b(""),m=x(()=>d.value.length>0);function g(){v("search",d.value)}function f(){d.value="",v("search","")}let p;function y(){clearTimeout(p),p=setTimeout(()=>{g()},300)}function B(I){v("filterTag",I)}function o(I){return C.selectedTagIds.includes(I)}return(I,M)=>(a(),i("div",Oe,[e("div",ze,[N(e("input",{"onUpdate:modelValue":M[0]||(M[0]=D=>d.value=D),type:"text",placeholder:"æœç´¢ä¹¦ç±åç§°æˆ–æ ‡ç­¾...",autocomplete:"off",onInput:y,onKeypress:X(g,["enter"])},null,544),[[P,d.value]]),e("button",{class:"search-btn",onClick:g},"ðŸ”"),m.value?(a(),i("button",{key:0,class:"clear-search-btn",onClick:f}," âœ• ")):S("",!0)]),w.tags.length>0?(a(),i("div",Qe,[M[1]||(M[1]=e("span",{class:"filter-label"},"æ ‡ç­¾ç­›é€‰:",-1)),e("div",Ge,[(a(!0),i(F,null,O(w.tags,D=>(a(),i("span",{key:D.name,class:re(["tag-chip",{active:o(D.name)}]),style:ee(D.color?{"--tag-color":D.color,backgroundColor:o(D.name)?D.color:""}:{}),onClick:$=>B(D.name)},_(D.name),15,We))),128))])])):S("",!0)]))}}),He=G(je,[["__scopeId","data-v-d3165a84"]]),Je={class:"form-group"},Xe={class:"form-group"},Ye={class:"cover-preview"},Ze=["src"],et={key:1,class:"cover-placeholder"},tt={class:"form-group"},ot={class:"tag-input-container"},st={class:"selected-tags"},at=["onClick"],nt={class:"tag-dropdown"},lt=["onKeypress"],rt={key:0,class:"tag-suggestions"},it=["onClick"],ut=Q({__name:"BookModal",props:{bookId:{default:null}},emits:["close","saved"],setup(w,{emit:L}){const v=w,C=L,d=Y(),m=b(""),g=b(null),f=b([]),p=b(""),y=b(!1),B=x(()=>!!v.bookId),o=x(()=>B.value?"ç¼–è¾‘ä¹¦ç±":"æ–°å»ºä¹¦ç±"),I=x(()=>d.tags),M=x(()=>{if(!p.value)return I.value;const k=p.value.toLowerCase();return I.value.filter(r=>r.name.toLowerCase().includes(k)&&!f.value.includes(r.name))});ie(()=>{if(v.bookId){const k=d.books.find(r=>r.id===v.bookId);k&&(m.value=k.title,g.value=k.cover||null,k.tags&&k.tags.length>0&&(f.value=[...k.tags]))}});function D(k){const l=k.target.files?.[0];if(!l)return;if(!l.type.startsWith("image/")){c("è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶","error");return}const s=new FileReader;s.onload=z=>{g.value=z.target?.result},s.readAsDataURL(l)}function $(k){k.preventDefault();const r=k.dataTransfer?.files[0];if(!r||!r.type.startsWith("image/"))return;const l=new FileReader;l.onload=s=>{g.value=s.target?.result},l.readAsDataURL(r)}function h(k){f.value.includes(k)||f.value.push(k),p.value="",y.value=!1}async function T(){const k=p.value.trim();if(!k)return;const r=I.value.find(l=>l.name===k);if(r){h(r.name);return}try{const l=await d.createTag(k);l&&h(l.name)}catch{c("åˆ›å»ºæ ‡ç­¾å¤±è´¥","error")}}function q(k){f.value=f.value.filter(r=>r!==k)}async function W(){if(!m.value.trim()){c("è¯·è¾“å…¥ä¹¦ç±åç§°","warning");return}const k=f.value;try{B.value&&v.bookId?await d.updateBookApi(v.bookId,{title:m.value.trim(),cover:g.value||void 0,tags:k})?(c("ä¹¦ç±æ›´æ–°æˆåŠŸ","success"),C("saved")):c("æ›´æ–°å¤±è´¥","error"):await d.createBook(m.value.trim(),void 0,g.value||void 0,k.length>0?k:void 0)?(c("ä¹¦ç±åˆ›å»ºæˆåŠŸ","success"),C("saved")):c("åˆ›å»ºå¤±è´¥","error")}catch{c(B.value?"æ›´æ–°å¤±è´¥":"åˆ›å»ºå¤±è´¥","error")}}return(k,r)=>(a(),R(he,{title:o.value,onClose:r[6]||(r[6]=l=>C("close"))},{footer:te(()=>[e("button",{type:"button",class:"btn btn-secondary",onClick:r[5]||(r[5]=l=>C("close"))},"å–æ¶ˆ"),e("button",{type:"button",class:"btn btn-primary",onClick:W},"ä¿å­˜")]),default:te(()=>[e("form",{onSubmit:oe(W,["prevent"])},[e("div",Je,[r[7]||(r[7]=e("label",{for:"bookTitle"},[Z("ä¹¦ç±åç§° "),e("span",{class:"required"},"*")],-1)),N(e("input",{id:"bookTitle","onUpdate:modelValue":r[0]||(r[0]=l=>m.value=l),type:"text",placeholder:"è¯·è¾“å…¥ä¹¦ç±åç§°",required:""},null,512),[[P,m.value]])]),e("div",Xe,[r[9]||(r[9]=e("label",null,"å°é¢å›¾ç‰‡",-1)),e("div",{class:"cover-upload-area",onDragover:r[1]||(r[1]=oe(()=>{},["prevent"])),onDrop:$,onClick:r[2]||(r[2]=l=>k.$refs.coverInput.click())},[e("input",{ref:"coverInput",type:"file",accept:"image/*",hidden:"",onChange:D},null,544),e("div",Ye,[g.value?(a(),i("img",{key:0,src:g.value,alt:"å°é¢é¢„è§ˆ"},null,8,Ze)):(a(),i("div",et,[...r[8]||(r[8]=[e("span",{class:"upload-icon"},"ðŸ“·",-1),e("span",null,"ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ å°é¢",-1)])]))])],32),r[10]||(r[10]=e("p",{class:"form-hint"},"æ”¯æŒ JPGã€PNGã€WebP æ ¼å¼ï¼Œå»ºè®®æ¯”ä¾‹ 3:4",-1))]),e("div",tt,[r[11]||(r[11]=e("label",null,"æ ‡ç­¾",-1)),e("div",ot,[e("div",st,[(a(!0),i(F,null,O(f.value,l=>(a(),i("span",{key:l,class:"selected-tag"},[Z(_(l)+" ",1),e("button",{type:"button",class:"remove-tag",onClick:s=>q(l)},"Ã—",8,at)]))),128))]),e("div",nt,[N(e("input",{"onUpdate:modelValue":r[3]||(r[3]=l=>p.value=l),type:"text",placeholder:"è¾“å…¥æ ‡ç­¾åç§°...",autocomplete:"off",onFocus:r[4]||(r[4]=l=>y.value=!0),onKeypress:X(oe(T,["prevent"]),["enter"])},null,40,lt),[[P,p.value]]),y.value&&M.value.length>0?(a(),i("div",rt,[(a(!0),i(F,null,O(M.value,l=>(a(),i("button",{key:l.name,type:"button",class:"tag-suggestion",onClick:s=>h(l.name)},_(l.name),9,it))),128))])):S("",!0)])]),r[12]||(r[12]=e("p",{class:"form-hint"},"è¾“å…¥åŽæŒ‰å›žè½¦æ·»åŠ æ–°æ ‡ç­¾ï¼Œæˆ–ä»Žå·²æœ‰æ ‡ç­¾ä¸­é€‰æ‹©",-1))])],32)]),_:1},8,["title"]))}}),ct=G(ut,[["__scopeId","data-v-0817d26b"]]),dt={class:"modal active"},vt={class:"modal-content modal-large"},pt={class:"modal-header"},ft={class:"modal-body"},mt={key:0,class:"book-detail-container"},gt={class:"book-info-section"},kt={class:"book-cover-large"},bt=["src"],ht={key:1,class:"book-cover-placeholder"},yt={class:"book-meta"},Ct={class:"meta-item"},_t={key:0,class:"detail-tags"},Tt=["onClick"],wt={key:1,class:"no-tags-hint"},$t={class:"meta-item"},Bt={class:"meta-item"},Dt={class:"meta-item"},It={class:"chapters-section"},Mt={key:0,class:"chapters-list"},St=["onDragstart","onDragover","onDrop"],Et={class:"chapter-info"},xt={class:"chapter-order"},At={class:"chapter-title"},Lt={class:"chapter-meta"},qt={class:"chapter-actions"},Vt=["onClick"],Ut=["disabled","onClick"],Rt=["onClick"],Ft=["onClick"],Kt={key:1,class:"empty-state-small"},Nt={key:0,class:"modal active"},Pt={class:"modal-content modal-small"},Ot={class:"modal-header"},zt={class:"modal-body"},Qt={class:"form-group"},Gt={class:"modal-footer"},Wt={key:0,class:"modal active"},jt={class:"modal-content modal-small"},Ht={class:"modal-body"},Jt={class:"quick-tag-input-wrapper"},Xt={class:"quick-tag-list"},Yt=["onClick"],Zt={class:"quick-tag-name"},eo={key:1,class:"no-tags-hint"},to={key:0,class:"modal active"},oo={class:"modal-content modal-small"},so={class:"modal-header"},ao={class:"modal-body"},no={class:"modal-footer"},lo=Q({__name:"BookDetailModal",emits:["close","edit"],setup(w,{emit:L}){const v=L,C=ge(),d=Y(),m=b(!1),g=b(null),f=b(""),p=b(!1),y=b("book"),B=b(null),o=x(()=>d.currentBook),I=x(()=>o.value?.chapters||[]),M=x(()=>d.tags);function D(n){return n?new Date(n).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}function $(n){return M.value.find(u=>u.name===n)?.color||"#667eea"}function h(){o.value&&(v("edit",o.value.id),v("close"))}function T(){y.value="book",p.value=!0}async function q(){try{y.value==="book"&&o.value?await d.deleteBookApi(o.value.id)?(c("ä¹¦ç±å·²åˆ é™¤","success"),v("close")):c("åˆ é™¤å¤±è´¥","error"):y.value==="chapter"&&B.value&&o.value&&(await d.deleteChapterApi(o.value.id,B.value)?c("ç« èŠ‚å·²åˆ é™¤","success"):c("åˆ é™¤å¤±è´¥","error"))}catch{c("åˆ é™¤å¤±è´¥","error")}p.value=!1,B.value=null}function W(){g.value=null,f.value="",m.value=!0}function k(n){const t=I.value.find(u=>u.id===n);t&&(g.value=n,f.value=t.title,m.value=!0)}async function r(){if(!f.value.trim()||!o.value){c("è¯·è¾“å…¥ç« èŠ‚åç§°","warning");return}try{g.value?await d.updateChapterApi(o.value.id,g.value,f.value.trim())?(c("ç« èŠ‚æ›´æ–°æˆåŠŸ","success"),m.value=!1):c("æ›´æ–°å¤±è´¥","error"):await d.createChapterApi(o.value.id,f.value.trim())?(c("ç« èŠ‚åˆ›å»ºæˆåŠŸ","success"),m.value=!1):c("åˆ›å»ºå¤±è´¥","error")}catch{c("ä¿å­˜å¤±è´¥","error")}}function l(n){y.value="chapter",B.value=n,p.value=!0}function s(n){o.value&&C.push({path:"/translate",query:{book:o.value.id,chapter:n}})}function z(n){o.value&&C.push({path:"/reader",query:{book:o.value.id,chapter:n}})}function V(){o.value&&C.push({path:"/insight",query:{book:o.value.id}})}async function ue(n){if(!o.value)return!1;try{return await d.reorderChaptersApi(o.value.id,n)?(c("ç« èŠ‚æŽ’åºå·²æ›´æ–°","success"),!0):(c("æŽ’åºä¿å­˜å¤±è´¥","error"),await ce(),!1)}catch{return c("æŽ’åºä¿å­˜å¤±è´¥","error"),await ce(),!1}}async function ce(){if(o.value)try{const n=await be(o.value.id);n.success&&n.book&&d.updateBook(o.value.id,n.book)}catch(n){console.error("åˆ·æ–°ä¹¦ç±è¯¦æƒ…å¤±è´¥:",n)}}const K=b(null),j=b(null);function ye(n,t){K.value=t,n.dataTransfer&&(n.dataTransfer.effectAllowed="move",n.dataTransfer.setData("text/plain",t.toString()))}function Ce(n,t){n.preventDefault(),n.dataTransfer&&(n.dataTransfer.dropEffect="move"),j.value=t}function _e(){j.value=null}async function Te(n,t){if(n.preventDefault(),K.value===null||K.value===t||!o.value){K.value=null,j.value=null;return}const u=[...I.value],[E]=u.splice(K.value,1);if(!E)return;u.splice(t,0,E);const A=u.map(J=>J.id);await ue(A),K.value=null,j.value=null}function we(){K.value=null,j.value=null}const se=b(!1),U=b(""),de=b(null),ve=x(()=>{const n=o.value?.tags||[],t=U.value.trim().toLowerCase();return M.value.filter(u=>!n.includes(u.name)&&(t===""||u.name.toLowerCase().includes(t)))}),pe=x(()=>{const n=U.value.trim();return n?!M.value.some(t=>t.name.toLowerCase()===n.toLowerCase()):!1});function $e(){U.value="",se.value=!0,Me(()=>{de.value?.focus()})}function ae(){se.value=!1,U.value=""}async function Be(){const n=U.value.trim();n&&(await ne(n),U.value="")}const H=b(!1);async function De(n){if(!(!o.value||H.value)){H.value=!0;try{const u=(o.value.tags||[]).filter(A=>A!==n);await d.updateBookApi(o.value.id,{tags:u})?(c("æ ‡ç­¾å·²ç§»é™¤","success"),await d.loadBooks(),await d.loadTags()):c("ç§»é™¤æ ‡ç­¾å¤±è´¥","error")}catch(t){c("æ“ä½œå¤±è´¥","error"),console.error("ç§»é™¤æ ‡ç­¾å¤±è´¥:",t)}finally{H.value=!1}}}async function ne(n){if(!(!o.value||!n||H.value)){if(o.value.tags?.includes(n)){c("è¯¥æ ‡ç­¾å·²å­˜åœ¨","info");return}H.value=!0;try{const{createTag:t}=await xe(async()=>{const{createTag:J}=await import("./bookshelf.B4ums9uK.js");return{createTag:J}},__vite__mapDeps([0,1,2]));if(!M.value.some(J=>J.name===n))if((await t(n)).success)await d.loadTags();else{c("åˆ›å»ºæ ‡ç­¾å¤±è´¥","error");return}const E=[...o.value.tags||[],n];await d.updateBookApi(o.value.id,{tags:E})?(c("æ ‡ç­¾å·²æ·»åŠ ","success"),await d.loadBooks(),await d.loadTags()):c("æ·»åŠ æ ‡ç­¾å¤±è´¥","error")}catch(t){c("æ“ä½œå¤±è´¥","error"),console.error("å¿«é€Ÿæ·»åŠ æ ‡ç­¾å¤±è´¥:",t)}finally{H.value=!1}}}return(n,t)=>(a(),i(F,null,[e("div",dt,[e("div",{class:"modal-overlay",onClick:t[0]||(t[0]=u=>v("close"))}),e("div",vt,[e("div",pt,[t[11]||(t[11]=e("h2",null,"ä¹¦ç±è¯¦æƒ…",-1)),e("button",{class:"modal-close",onClick:t[1]||(t[1]=u=>v("close"))},"Ã—")]),e("div",ft,[o.value?(a(),i("div",mt,[e("div",gt,[e("div",kt,[o.value.cover?(a(),i("img",{key:0,src:o.value.cover,alt:"å°é¢"},null,8,bt)):(a(),i("div",ht,"ðŸ“–"))]),e("div",yt,[e("h3",null,_(o.value.title),1),e("p",Ct,[t[12]||(t[12]=e("span",null,"æ ‡ç­¾ï¼š",-1)),o.value.tags&&o.value.tags.length>0?(a(),i("span",_t,[(a(!0),i(F,null,O(o.value.tags,u=>(a(),i("span",{key:u,class:"detail-tag",style:ee({background:$(u)})},[Z(_(u)+" ",1),e("span",{class:"remove-detail-tag",onClick:oe(E=>De(u),["stop"])},"Ã—",8,Tt)],4))),128))])):(a(),i("span",wt,"æš‚æ— æ ‡ç­¾")),e("button",{class:"btn-add-tag",title:"æ·»åŠ æ ‡ç­¾",onClick:$e},"+")]),e("p",$t,[t[13]||(t[13]=e("span",null,"ç« èŠ‚æ•°ï¼š",-1)),e("span",null,_(I.value.length),1)]),e("p",Bt,[t[14]||(t[14]=e("span",null,"åˆ›å»ºæ—¶é—´ï¼š",-1)),e("span",null,_(D(o.value.created_at||o.value.createdAt)),1)]),e("p",Dt,[t[15]||(t[15]=e("span",null,"æœ€åŽæ›´æ–°ï¼š",-1)),e("span",null,_(D(o.value.updated_at||o.value.updatedAt)),1)]),e("div",{class:"book-actions"},[e("button",{class:"btn btn-sm btn-primary",onClick:V},"â— æ¼«ç”»åˆ†æž"),e("button",{class:"btn btn-sm btn-secondary",onClick:h},"ç¼–è¾‘ä¹¦ç±"),e("button",{class:"btn btn-sm btn-danger",onClick:T},"åˆ é™¤ä¹¦ç±")])])]),e("div",It,[e("div",{class:"section-header"},[t[17]||(t[17]=e("h3",null,"ç« èŠ‚åˆ—è¡¨",-1)),e("button",{class:"btn btn-sm btn-primary",onClick:W},[...t[16]||(t[16]=[e("span",{class:"btn-icon"},"+",-1),Z(" æ–°å»ºç« èŠ‚ ",-1)])])]),I.value.length>0?(a(),i("div",Mt,[(a(!0),i(F,null,O(I.value,(u,E)=>(a(),i("div",{key:u.id,class:re(["chapter-item",{dragging:K.value===E,"drag-over":j.value===E&&K.value!==E}]),draggable:"true",onDragstart:A=>ye(A,E),onDragover:A=>Ce(A,E),onDragleave:_e,onDrop:A=>Te(A,E),onDragend:we},[t[18]||(t[18]=e("div",{class:"chapter-drag-handle",title:"æ‹–æ‹½æŽ’åº"},"â‹®â‹®",-1)),e("div",Et,[e("span",xt,"#"+_(E+1),1),e("span",At,_(u.title),1),e("span",Lt,_(u.image_count||u.imageCount||0)+" å¼ å›¾ç‰‡",1)]),e("div",qt,[e("button",{class:"chapter-action-btn chapter-enter-btn",onClick:A=>s(u.id)}," è¿›å…¥ç¿»è¯‘ ",8,Vt),e("button",{class:"chapter-action-btn chapter-read-btn",disabled:(u.image_count||u.imageCount||0)===0,onClick:A=>z(u.id)}," è¿›å…¥é˜…è¯» ",8,Ut),e("button",{class:"chapter-action-btn",onClick:A=>k(u.id)}," ç¼–è¾‘ ",8,Rt),e("button",{class:"chapter-action-btn danger",onClick:A=>l(u.id)}," åˆ é™¤ ",8,Ft)])],42,St))),128))])):(a(),i("div",Kt,[...t[19]||(t[19]=[e("p",null,"æš‚æ— ç« èŠ‚ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ›å»º",-1)])]))])])):S("",!0)])])]),(a(),R(le,{to:"body"},[m.value?(a(),i("div",Nt,[e("div",{class:"modal-overlay",onClick:t[2]||(t[2]=u=>m.value=!1)}),e("div",Pt,[e("div",Ot,[e("h2",null,_(g.value?"ç¼–è¾‘ç« èŠ‚":"æ–°å»ºç« èŠ‚"),1),e("button",{class:"modal-close",onClick:t[3]||(t[3]=u=>m.value=!1)},"Ã—")]),e("div",zt,[e("div",Qt,[t[20]||(t[20]=e("label",{for:"chapterTitleInput"},[Z("ç« èŠ‚åç§° "),e("span",{class:"required"},"*")],-1)),N(e("input",{id:"chapterTitleInput","onUpdate:modelValue":t[4]||(t[4]=u=>f.value=u),type:"text",placeholder:"ä¾‹å¦‚ï¼šç¬¬1è¯ã€åºç« ",onKeypress:X(r,["enter"])},null,544),[[P,f.value]])])]),e("div",Gt,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[5]||(t[5]=u=>m.value=!1)},"å–æ¶ˆ"),e("button",{type:"button",class:"btn btn-primary",onClick:r},"ä¿å­˜")])])])):S("",!0)])),(a(),R(le,{to:"body"},[se.value?(a(),i("div",Wt,[e("div",{class:"modal-overlay",onClick:ae}),e("div",jt,[e("div",{class:"modal-header"},[t[21]||(t[21]=e("h2",null,"å¿«é€Ÿæ·»åŠ æ ‡ç­¾",-1)),e("button",{class:"modal-close",onClick:ae},"Ã—")]),e("div",Ht,[e("div",Jt,[N(e("input",{ref_key:"quickTagInputRef",ref:de,"onUpdate:modelValue":t[6]||(t[6]=u=>U.value=u),type:"text",class:"quick-tag-input",placeholder:"è¾“å…¥æ ‡ç­¾åç§°è¿›è¡Œæœç´¢æˆ–åˆ›å»º...",onKeypress:X(Be,["enter"])},null,544),[[P,U.value]])]),e("div",Xt,[(a(!0),i(F,null,O(ve.value,u=>(a(),i("div",{key:u.name,class:"quick-tag-item",onClick:E=>ne(u.name)},[e("span",{class:"tag-color-dot",style:ee({background:u.color||"#667eea"})},null,4),e("span",Zt,_(u.name),1),t[22]||(t[22]=e("span",{class:"tag-add-icon"},"+",-1))],8,Yt))),128)),pe.value?(a(),i("div",{key:0,class:"quick-tag-item new-tag",onClick:t[7]||(t[7]=u=>ne(U.value.trim()))},[t[23]||(t[23]=e("span",{class:"tag-icon"},"+",-1)),e("span",null,'åˆ›å»ºå¹¶æ·»åŠ  "'+_(U.value.trim())+'"',1)])):S("",!0),ve.value.length===0&&!pe.value?(a(),i("p",eo,_(U.value?"æœªæ‰¾åˆ°åŒ¹é…çš„æ ‡ç­¾":"æ‰€æœ‰æ ‡ç­¾å·²æ·»åŠ æˆ–æš‚æ— æ ‡ç­¾"),1)):S("",!0)])]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary",onClick:ae},"å…³é—­")])])])):S("",!0)])),(a(),R(le,{to:"body"},[p.value?(a(),i("div",to,[e("div",{class:"modal-overlay",onClick:t[8]||(t[8]=u=>p.value=!1)}),e("div",oo,[e("div",so,[t[24]||(t[24]=e("h2",null,"ç¡®è®¤åˆ é™¤",-1)),e("button",{class:"modal-close",onClick:t[9]||(t[9]=u=>p.value=!1)},"Ã—")]),e("div",ao,[e("p",null,_(y.value==="book"?"ç¡®å®šè¦åˆ é™¤è¿™æœ¬ä¹¦ç±å—ï¼Ÿæ‰€æœ‰ç« èŠ‚æ•°æ®å°†ä¸€å¹¶åˆ é™¤ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚":"ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç« èŠ‚å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚"),1)]),e("div",no,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=u=>p.value=!1)},"å–æ¶ˆ"),e("button",{type:"button",class:"btn btn-danger",onClick:q},"åˆ é™¤")])])])):S("",!0)]))],64))}}),ro=G(lo,[["__scopeId","data-v-fca6abfa"]]),io={class:"tag-manage-form"},uo={class:"form-row"},co={class:"tag-list"},vo={key:0,class:"empty-hint"},po={key:0,class:"tag-view-mode"},fo={class:"tag-name"},mo={class:"tag-book-count"},go=["onClick"],ko=["onClick"],bo={key:1,class:"tag-edit-mode"},ho=Q({__name:"TagManageModal",emits:["close"],setup(w,{emit:L}){const v=L,C=Y(),d=b(""),m=b("#667eea"),g=b(null),f=b(""),p=b(""),y=x(()=>C.tags);async function B(){const $=d.value.trim();if(!$){c("è¯·è¾“å…¥æ ‡ç­¾åç§°","warning");return}if(y.value.some(h=>h.name===$)){c("æ ‡ç­¾å·²å­˜åœ¨","warning");return}try{await C.createTag($,m.value),c("æ ‡ç­¾åˆ›å»ºæˆåŠŸ","success"),d.value="",m.value="#667eea"}catch{c("åˆ›å»ºå¤±è´¥","error")}}function o($){g.value=$.name,f.value=$.name,p.value=$.color||"#667eea"}function I(){g.value=null,f.value="",p.value=""}async function M(){if(!g.value)return;const $=f.value.trim();if(!$){c("æ ‡ç­¾åç§°ä¸èƒ½ä¸ºç©º","warning");return}const h=g.value;if($!==h&&y.value.some(T=>T.name===$)){c("æ ‡ç­¾åç§°å·²å­˜åœ¨","warning");return}try{await C.updateTagApi(h,$,p.value)?(c("æ ‡ç­¾æ›´æ–°æˆåŠŸ","success"),I()):c("æ›´æ–°å¤±è´¥","error")}catch(T){c("æ›´æ–°å¤±è´¥","error"),console.error("æ›´æ–°æ ‡ç­¾å¤±è´¥:",T)}}async function D($){try{await C.deleteTagApi($)?c("æ ‡ç­¾å·²åˆ é™¤","success"):c("åˆ é™¤å¤±è´¥","error")}catch{c("åˆ é™¤å¤±è´¥","error")}}return($,h)=>(a(),R(he,{title:"æ ‡ç­¾ç®¡ç†",onClose:h[5]||(h[5]=T=>v("close"))},{footer:te(()=>[e("button",{class:"btn btn-secondary",onClick:h[4]||(h[4]=T=>v("close"))},"å…³é—­")]),default:te(()=>[e("div",io,[e("div",uo,[N(e("input",{"onUpdate:modelValue":h[0]||(h[0]=T=>d.value=T),type:"text",placeholder:"è¾“å…¥æ–°æ ‡ç­¾åç§°...",onKeypress:X(B,["enter"])},null,544),[[P,d.value]]),N(e("input",{"onUpdate:modelValue":h[1]||(h[1]=T=>m.value=T),type:"color",title:"é€‰æ‹©é¢œè‰²"},null,512),[[P,m.value]]),e("button",{class:"btn btn-primary btn-sm",onClick:B},"æ·»åŠ ")])]),e("div",co,[y.value.length===0?(a(),i("div",vo," æš‚æ— æ ‡ç­¾ï¼Œè¯·åœ¨ä¸Šæ–¹æ·»åŠ  ")):S("",!0),(a(!0),i(F,null,O(y.value,T=>(a(),i("div",{key:T.name,class:"tag-manage-item"},[g.value!==T.name?(a(),i("div",po,[e("span",{class:"tag-color-dot",style:ee({backgroundColor:T.color||"#667eea"})},null,4),e("span",fo,_(T.name),1),e("span",mo,_(T.book_count||0)+" æœ¬",1),e("button",{class:"tag-edit-btn",onClick:q=>o(T)}," ç¼–è¾‘ ",8,go),e("button",{class:"tag-delete-btn",onClick:q=>D(T.name)}," åˆ é™¤ ",8,ko)])):S("",!0),g.value===T.name?(a(),i("div",bo,[N(e("input",{"onUpdate:modelValue":h[2]||(h[2]=q=>p.value=q),type:"color",class:"edit-color-input",title:"é€‰æ‹©é¢œè‰²"},null,512),[[P,p.value]]),N(e("input",{"onUpdate:modelValue":h[3]||(h[3]=q=>f.value=q),type:"text",class:"edit-name-input",placeholder:"æ ‡ç­¾åç§°",onKeypress:X(M,["enter"])},null,544),[[P,f.value]]),e("button",{class:"tag-save-btn",onClick:M}," ä¿å­˜ "),e("button",{class:"tag-cancel-btn",onClick:I}," å–æ¶ˆ ")])):S("",!0)]))),128))])]),_:1}))}}),yo=G(ho,[["__scopeId","data-v-20ab6eb1"]]),Co={class:"modal-content confirm-modal-content"},_o={class:"modal-header"},To={class:"modal-title"},wo={class:"modal-body confirm-modal-body"},$o={class:"confirm-message"},Bo={class:"modal-footer confirm-modal-footer"},Do=Q({__name:"ConfirmModal",props:{message:{},title:{default:"ç¡®è®¤æ“ä½œ"},confirmText:{default:"ç¡®å®š"},cancelText:{default:"å–æ¶ˆ"},confirmType:{default:"primary"}},emits:["confirm","cancel"],setup(w,{emit:L}){const v=L,C=b(null);function d(){v("confirm")}function m(){v("cancel")}function g(p){p.target===p.currentTarget&&v("cancel")}function f(p){p.key==="Escape"?v("cancel"):p.key==="Enter"&&v("confirm")}return ie(()=>{document.addEventListener("keydown",f),C.value?.focus()}),ke(()=>{document.removeEventListener("keydown",f)}),(p,y)=>(a(),i("div",{ref_key:"modalRef",ref:C,class:"modal-overlay confirm-modal-overlay",tabindex:"-1",onClick:g},[e("div",Co,[e("div",_o,[e("h3",To,_(w.title),1),e("button",{class:"modal-close-btn",onClick:m,title:"å…³é—­"},"Ã—")]),e("div",wo,[e("p",$o,_(w.message),1)]),e("div",Bo,[e("button",{class:"btn btn-secondary",onClick:m},_(w.cancelText),1),e("button",{class:re(["btn",w.confirmType==="danger"?"btn-danger":"btn-primary"]),onClick:d},_(w.confirmText),3)])])],512))}}),Io=G(Do,[["__scopeId","data-v-f6f7303a"]]),Mo={class:"bookshelf-page"},So={class:"app-header"},Eo={class:"header-content"},xo={class:"logo-container"},Ao={class:"header-links"},Lo={class:"lan-access-info",title:"å…¶ä»–è®¾å¤‡å¯é€šè¿‡æ­¤åœ°å€è®¿é—®"},qo={id:"lanUrl"},Vo={class:"bookshelf-main"},Uo={class:"books-container"},Ro={key:0,class:"books-grid"},Fo={key:1,class:"empty-state"},Ko={key:2,class:"empty-state"},No=Q({__name:"BookshelfView",setup(w){const L=ge(),v=Y(),C=b("èŽ·å–ä¸­..."),d=b(!1),m=b(!1),g=b(!1),f=b(!1),p=b(null),y=b(""),B=b(null),o=x(()=>v.filteredBooks),I=x(()=>v.tags),M=x(()=>o.value.length===0&&!v.searchQuery);function D(l){l.persisted&&(console.log("[BookshelfView] é¡µé¢ä»Ž BFCache æ¢å¤ï¼Œåˆ·æ–°æ•°æ®"),v.loadBooks(),v.loadTags(),m.value&&v.currentBook&&q(v.currentBook.id))}ie(async()=>{await Promise.all([v.loadBooks(),v.loadTags()]);try{const l=await Ee();l.success&&l.lan_url&&(C.value=l.lan_url)}catch(l){console.error("èŽ·å–æœåŠ¡å™¨ä¿¡æ¯å¤±è´¥:",l),C.value="èŽ·å–å¤±è´¥"}window.addEventListener("pageshow",D)}),ke(()=>{window.removeEventListener("pageshow",D)});async function $(){try{await navigator.clipboard.writeText(C.value),c("å±€åŸŸç½‘åœ°å€å·²å¤åˆ¶ï¼","success")}catch{const l=document.createElement("textarea");l.value=C.value,document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),c("å±€åŸŸç½‘åœ°å€å·²å¤åˆ¶ï¼","success")}}function h(){p.value=null,d.value=!0}function T(l){p.value=l,d.value=!0}async function q(l){try{const s=await be(l);if(!s.success)throw new Error(s.error||"åŠ è½½å¤±è´¥");s.book&&v.updateBook(l,s.book),v.setCurrentBook(l),m.value=!0}catch(s){const z=s instanceof Error?s.message:"æœªçŸ¥é”™è¯¯";console.error("åŠ è½½ä¹¦ç±è¯¦æƒ…å¤±è´¥:",s),c(`åŠ è½½ä¹¦ç±è¯¦æƒ…å¤±è´¥: ${z}`,"error")}}function W(){g.value=!0}function k(){L.push("/translate")}function r(){c("ðŸŒ™ è¯¥åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼","info")}return(l,s)=>{const z=Se("router-link");return a(),i("div",Mo,[e("header",So,[e("div",Eo,[e("div",xo,[fe(z,{to:"/",title:"ä¹¦æž¶é¦–é¡µ"},{default:te(()=>[...s[6]||(s[6]=[e("img",{src:Ie,alt:"Saber-Translator Logo",class:"app-logo"},null,-1),e("span",{class:"app-name"},"Saber-Translator",-1)])]),_:1})]),e("div",Ao,[e("span",Lo,[s[7]||(s[7]=e("span",{class:"lan-icon"},"ðŸŒå±€åŸŸç½‘è®¾å¤‡å¯é€šè¿‡è¯¥ç½‘å€è®¿é—®",-1)),e("span",qo,_(C.value),1),e("button",{class:"copy-btn",title:"å¤åˆ¶åœ°å€",onClick:$},"ðŸ“‹")]),s[9]||(s[9]=e("a",{href:"http://www.mashirosaber.top",target:"_blank",class:"tutorial-link"},"ä½¿ç”¨æ•™ç¨‹",-1)),s[10]||(s[10]=e("a",{href:"https://github.com/MashiroSaber03/Saber-Translator",target:"_blank",class:"github-link"},[e("img",{src:Ae,alt:"GitHub",class:"github-icon"})],-1)),e("button",{class:"theme-toggle",title:"åŠŸèƒ½å¼€å‘ä¸­",onClick:r},[...s[8]||(s[8]=[e("span",{class:"theme-icon"},"â˜€ï¸",-1)])])])])]),e("main",Vo,[e("div",{class:"bookshelf-toolbar"},[s[14]||(s[14]=e("h1",{class:"page-title"},"æˆ‘çš„ä¹¦æž¶",-1)),e("div",{class:"toolbar-actions"},[e("button",{class:"btn btn-primary",onClick:h},[...s[11]||(s[11]=[e("span",{class:"btn-icon"},"+",-1),e("span",null,"æ–°å»ºä¹¦ç±",-1)])]),e("button",{class:"btn btn-secondary",onClick:W},[...s[12]||(s[12]=[e("span",null,"ðŸ·ï¸ ç®¡ç†æ ‡ç­¾",-1)])]),e("button",{class:"btn btn-secondary",onClick:k},[...s[13]||(s[13]=[e("span",null,"å¿«é€Ÿç¿»è¯‘",-1)])])])]),fe(He,{tags:I.value,onSearch:me(v).setSearchQuery,onFilterTag:me(v).toggleTagFilter},null,8,["tags","onSearch","onFilterTag"]),e("div",Uo,[o.value.length>0?(a(),i("div",Ro,[(a(!0),i(F,null,O(o.value,V=>(a(),R(Pe,{key:V.id,book:V,onClick:ue=>q(V.id)},null,8,["book","onClick"]))),128))])):M.value?(a(),i("div",Fo,[s[16]||(s[16]=e("div",{class:"empty-icon"},"ðŸ“š",-1)),s[17]||(s[17]=e("h2",null,"ä¹¦æž¶ç©ºç©ºå¦‚ä¹Ÿ",-1)),s[18]||(s[18]=e("p",null,'ç‚¹å‡»"æ–°å»ºä¹¦ç±"å¼€å§‹ä½ çš„ç¿»è¯‘ä¹‹æ—…',-1)),e("button",{class:"btn btn-primary",onClick:h},[...s[15]||(s[15]=[e("span",{class:"btn-icon"},"+",-1),e("span",null,"æ–°å»ºç¬¬ä¸€æœ¬ä¹¦",-1)])])])):(a(),i("div",Ko,[...s[19]||(s[19]=[e("div",{class:"empty-icon"},"ðŸ”",-1),e("h2",null,"æœªæ‰¾åˆ°åŒ¹é…çš„ä¹¦ç±",-1),e("p",null,"å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–æ ‡ç­¾ç­›é€‰",-1)])]))])]),d.value?(a(),R(ct,{key:0,"book-id":p.value,onClose:s[0]||(s[0]=V=>d.value=!1),onSaved:s[1]||(s[1]=V=>d.value=!1)},null,8,["book-id"])):S("",!0),m.value?(a(),R(ro,{key:1,onClose:s[2]||(s[2]=V=>m.value=!1),onEdit:T})):S("",!0),g.value?(a(),R(yo,{key:2,onClose:s[3]||(s[3]=V=>g.value=!1)})):S("",!0),f.value?(a(),R(Io,{key:3,message:y.value,onConfirm:s[4]||(s[4]=V=>{B.value?.(),f.value=!1}),onCancel:s[5]||(s[5]=V=>f.value=!1)},null,8,["message"])):S("",!0)])}}}),Jo=G(No,[["__scopeId","data-v-6c518e71"]]);export{Jo as default};
