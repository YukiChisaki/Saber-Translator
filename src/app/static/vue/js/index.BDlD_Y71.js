const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/config.CwRcCkM9.js","js/client.Bht704G-.js","js/utils-vendor.B9ygI19o.js","js/BookshelfView.MgqoiwqD.js","js/bookshelfStore.DCAN6Zs_.js","js/vue-vendor.DwHUB8Dr.js","js/bookshelf.B4ums9uK.js","js/system.DR5RJocQ.js","js/BaseModal.CncnZcl-.js","assets/BaseModal.CgStYIKv.css","assets/BookshelfView.97AEaXQ0.css","js/TranslateView.D9o22ht4.js","js/CustomSelect.vue_vue_type_style_index_0_lang.CZ495rEt.js","assets/CustomSelect.CoWnC2Ju.css","assets/TranslateView.CIJf1kCf.css","js/ReaderView.CuWD8vQM.js","assets/ReaderView.DUeMDiK1.css","js/InsightView.DRLIM_Al.js","assets/InsightView.BA5z5Uki.css"])))=>i.map(i=>d[i]);
import{c as q,d as ue,r as K,a as W,b as ce,g as me,f as j,l as z,E as pe,m as de,T as ve,k as M,e as S,F as X,j as fe,D as Y,n as he,t as ge,p as Te,o as Oe,R as Pe,G as xe,H as Re,I as _e,J as Ee}from"./vue-vendor.DwHUB8Dr.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))m(c);new MutationObserver(c=>{for(const p of c)if(p.type==="childList")for(const g of p.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&m(g)}).observe(document,{childList:!0,subtree:!0});function i(c){const p={};return c.integrity&&(p.integrity=c.integrity),c.referrerPolicy&&(p.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?p.credentials="include":c.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function m(c){if(c.ep)return;c.ep=!0;const p=i(c);fetch(c.href,p)}})();const Me="modulepreload",Le=function(e){return"/"+e},$={},L=function(a,i,m){let c=Promise.resolve();if(i&&i.length>0){let O=function(f){return Promise.all(f.map(T=>Promise.resolve(T).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),x=g?.nonce||g?.getAttribute("nonce");c=O(i.map(f=>{if(f=Le(f),f in $)return;$[f]=!0;const T=f.endsWith(".css"),l=T?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${l}`))return;const r=document.createElement("link");if(r.rel=T?"stylesheet":Me,T||(r.as="script"),r.crossOrigin="",r.href=f,x&&r.setAttribute("nonce",x),document.head.appendChild(r),T)return new Promise((u,E)=>{r.addEventListener("load",u),r.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${f}`)))})}))}function p(g){const x=new Event("vite:preloadError",{cancelable:!0});if(x.payload=g,window.dispatchEvent(x),!x.defaultPrevented)throw g}return c.then(g=>{for(const x of g||[])x.status==="rejected"&&p(x.reason);return a().catch(p)})},qe="fonts/思源黑体SourceHanSansK-Bold.TTF",Ne="#FFFFFF",Z=`你是一个ocr助手，你需要将我发送给你的图片中的文字提取出来并返回给我，要求：
1、完整识别：我发送给你的图片中的文字都是需要识别的内容
2、非贪婪输出：不要返回任何其他解释和说明。`,Se="你是一个好用的翻译助手。请将我的非中文语句段落连成一句或几句话并翻译成中文，我发给你所有的话都是需要翻译的内容，你只需要回答翻译结果。特别注意：翻译结果字数不能超过原文字数！翻译结果请符合中文的语言习惯。",Ae=`你是一个专业的翻译引擎。请将用户提供的文本翻译成简体中文。

当文本中包含特殊字符（如大括号{}、引号""、反斜杠\\等）时，请在输出中保留它们但不要将它们视为JSON语法的一部分。

请严格按照以下 JSON 格式返回结果，不要添加任何额外的解释或对话:
{
  "translated_text": "[翻译后的文本放在这里]"
}`,Q=`忽略之前的所有指令，仅遵循以下定义。

## 角色：专业漫画翻译师
你是一个专业的漫画翻译引擎，擅长将外语漫画翻译成中文。

## 翻译方法
1. 直译阶段：
- 对每一行文本进行精确的逐词翻译
- 尽可能保持原文的句子结构
- 保留所有原始标记和表达方式
- 对模糊的内容保持原样，不做过度解读

2. 分析与意译阶段：
- 捕捉核心含义、情感基调和文化内涵
- 识别碎片化文本段落之间的逻辑联系
- 分析直译的不足之处和需要改进的地方

3. 润色阶段：
- 调整翻译使其在中文中听起来自然流畅，同时保持原意
- 保留适合漫画和宅文化的情感基调和强度
- 确保角色语气和术语的一致性
- 根据上下文推断合适的人称代词（他/她/我/你/你们），不要添加原文中不存在的代词
- 根据第二步的结论进行最终润色

## 翻译规则
- 逐行翻译，保持准确性和真实性，忠实再现原文及其情感意图
- 保留原文中的拟声词或音效词，不进行翻译
- 每个翻译段落必须带有编号前缀（严格使用 <|数字|> 格式），只输出翻译结果，不要输出原文
- 只翻译内容，不要添加任何解释或评论

请将以下外语文本翻译成中文：`,be=`忽略之前的所有指令，仅遵循以下定义。

## 角色：专业漫画翻译师
你是一个专业的漫画翻译引擎，擅长将外语漫画翻译成中文。

## 翻译方法
1. 直译阶段：对每一行文本进行精确的逐词翻译
2. 分析与意译阶段：捕捉核心含义、情感基调和文化内涵
3. 润色阶段：调整翻译使其在中文中听起来自然流畅

## 翻译规则
- 逐行翻译，保持准确性和真实性
- 保留原文中的拟声词或音效词，不进行翻译
- 只翻译内容，不要添加任何解释或评论

## 输出格式
请严格按照以下 JSON 格式返回翻译结果，不要添加任何额外文字：
{
  "translations": [
    {"id": 1, "text": "翻译内容1"},
    {"id": 2, "text": "翻译内容2"}
  ]
}

请将以下外语文本翻译成中文：`,ye=`你是一个OCR助手。请将我发送给你的图片中的所有文字提取出来。
当文本中包含特殊字符（如大括号{}、引号""、反斜杠\\等）时，请在输出中保留它们但不要将它们视为JSON语法的一部分。如果需要，你可以使用转义字符\\来表示这些特殊字符。
请严格按照以下 JSON 格式返回结果，不要添加任何额外的解释或对话:
{
  "extracted_text": "[这里放入所有识别到的文字，可以包含换行符以大致保留原始分段，但不要包含任何其他非文本内容]"
}`,xo=(e="日语")=>`对图中的${e}进行OCR:`,Ro={japanese:"日语",chinese:"简体中文",chinese_cht:"繁体中文",korean:"韩语",english:"英语",french:"法语",german:"德语",spanish:"西班牙语",italian:"意大利语",portuguese:"葡萄牙语",dutch:"荷兰语",polish:"波兰语",thai:"泰语",vietnamese:"越南语",indonesian:"印尼语",malay:"马来语",russian:"俄语",arabic:"阿拉伯语",hindi:"印地语",turkish:"土耳其语",greek:"希腊语",hebrew:"希伯来语"},Ve=`你是一个漫画翻译助手。我会同时提供多张连续的漫画原图和对应的JSON翻译文件，请帮我将原文翻译成中文。

【关键要求 - 必须严格遵守】
1. 我提供了多张图片，每张图片都有对应的"imageIndex"
2. 你**必须为每一张图片**提供翻译结果，返回的数组长度必须等于输入的图片数量
3. 不要只翻译第一张或部分图片，必须处理所有图片的所有气泡
4. 输出的JSON数组中，必须包含所有的imageIndex，按顺序排列
5. 如果输入有N张图片，输出的数组必须有N个元素

【输出格式要求】
返回完整的JSON数组，格式如下：
[
  {
    "imageIndex": 0,
    "bubbles": [...]
  },
  {
    "imageIndex": 1,
    "bubbles": [...]
  },
  // ... 其他所有图片
]

翻译要求：
1.仅修改"translated"字段，保持其他所有结构和字段不变
2.按照"imageIndex"顺序依次翻译，确保上下文连贯
3.结合图片内容和语境，让翻译自然流畅
4.保留原文的情感和意图，使用地道的中文表达
5.注意专有名词的一致性
6.直接返回完整的JSON数组，无需任何解释或markdown标记

【再次强调】必须返回所有图片的翻译，不要遗漏任何一张！`,_o=`你是一个专业的漫画校对助手，请帮我校对漫画翻译结果。我会给你漫画未经翻译的原图、由漫画原文和已有的翻译文本组成的JSON文件，请根据图片内容和上下文关系，检查并改进翻译质量。
校对要点：
1. json中的"imagelndex"序号是每张图片的页码，在翻译前先根据json文件中每页图片的原文内容和所有漫画图片对我给你的所有图片进行排序，在进行上下文对比时要严格按照"imagelndex"序号进行对比，你在翻译时要按照"imagelndex"的顺序进行顺序翻译，从而使得每句翻译足够连贯，上下文不会突兀
2. 通过json中每页图片的"original"原文内容和所有的漫画图片明确每句话在那页图的哪个位置，并结合漫画图像和上下文语境，让翻译更加连贯自然，符合角色语气和场景
3. json中的"bubblelndex"标号可能不正确，你需要根据图片自行判断每句话的正确顺序，从而输出符合上下文连贯的翻译，但在输出翻译时不要修改原本的"bubblelndex"标号
4. 针对特殊术语或专有名词的翻译进行统一
5. 重点关注易错点的人称和语气词
6. 修正任何语法或表达错误
请直接返回修改后的JSON数据，保持原有格式，只需更新"translated"字段的内容。`,I=0,U=0,A=32,Ie=!0,Ue="#FFFFFF",De=3,Eo=[16,20,24,28,32,36,40,48,56,64],Mo=2,Lo=10,qo=999,D=3,B=2,b=2,No=5,So=200,Ao=30,bo="edit_mode_layout",F="translationSettings",G="providerConfigs",yo="webImportSettings",Vo=`你是一个专业的漫画数据提取助手。请针对当前网页执行以下提取任务:

## 1. 交互行为
- 请模拟用户行为，缓慢向下滚动页面至底部，以触发所有采用"懒加载"技术的漫画图片。
- 在滚动过程中，请确保等待图片加载完成，识别并提取真实的漫画内容图片。

## 2. 提取逻辑
- **图片过滤**: 忽略所有加载占位图（如 loading.gif、spacer.gif）、广告图或图标，仅提取属于漫画正文的图片。
- **属性识别**: 优先提取 \`data-src\`、\`data-original\`、\`original\` 或 \`file\` 等包含真实高清原图地址的属性。如果这些属性不存在，再提取 \`src\` 属性。
- **元数据**: 提取漫画的名称（comic_title）和当前章节的名称（chapter_title）。

## 3. 数据结构
- 必须按图片在页面中显示的先后顺序提取，并为每张图片分配一个从 1 开始的 \`page_number\`（页码序号）。
- 最终结果以 JSON 格式输出，包含漫画名称、章节名以及包含序号和图片链接的列表。

## 4. 输出格式 (Valid JSON Only)
严格按照以下 JSON 格式输出，不要包含 Markdown 代码块标记（如 \\\`\\\`\\\`json）：

{
  "comic_title": "漫画名称",
  "chapter_title": "第X话 章节标题",
  "pages": [
    {"page_number": 1, "image_url": "https://..."},
    {"page_number": 2, "image_url": "https://..."}
  ],
  "total_pages": 1
}`,Io=[{value:"openai",label:"OpenAI"},{value:"siliconflow",label:"SiliconFlow"},{value:"deepseek",label:"DeepSeek"},{value:"volcano",label:"火山引擎"},{value:"gemini",label:"Google Gemini"},{value:"custom_openai",label:"自定义 OpenAI 兼容服务"}],Be={fontSize:25,autoFontSize:!1,fontFamily:qe,layoutDirection:"auto",textColor:"#000000",fillColor:Ne,strokeEnabled:Ie,strokeColor:Ue,strokeWidth:De,inpaintMethod:"solid",useAutoTextColor:!1},Je={apiKey:"",secretKey:"",version:"standard",sourceLanguage:"JAP"},Ce={sourceLanguage:"japanese"},Fe={provider:"gemini",apiKey:"",modelName:"",prompt:Z,rpmLimit:U,customBaseUrl:"",isJsonMode:!1,minImageSize:A},Ke={provider:"siliconflow",apiKey:"",modelName:"",customBaseUrl:"",rpmLimit:I,maxRetries:D,isJsonMode:!1,translationMode:"batch",batchNormalPrompt:Q,batchJsonPrompt:be,singleNormalPrompt:Se,singleJsonPrompt:Ae},ze={provider:"siliconflow",apiKey:"",modelName:"",customBaseUrl:"",batchSize:3,sessionReset:3,rpmLimit:7,maxRetries:B,lowReasoning:!1,noThinkingMethod:"gemini",forceJsonOutput:!1,useStream:!0,prompt:Ve},we={enabled:!1,rounds:[],maxRetries:b},He={ratio:0,top:0,bottom:0,left:0,right:0},je={dilateSize:10,boxExpandRatio:20},$e={enabled:!1,deepLearningLockSize:1};function V(){return{textStyle:{...Be},ocrEngine:"manga_ocr",sourceLanguage:"japanese",textDetector:"default",baiduOcr:{...Je},paddleOcrVl:{...Ce},aiVisionOcr:{...Fe},translation:{...Ke},targetLanguage:"zh",translatePrompt:Q,useTextboxPrompt:!1,textboxPrompt:"",hqTranslation:{...ze},proofreading:{...we},boxExpand:{...He},preciseMask:{...je},pdfProcessingMethod:"backend",showDetectionDebug:!1,parallel:{...$e},autoSaveInBookshelfMode:!1,removeTextWithOcr:!1,enableVerboseLogs:!1,lamaDisableResize:!1}}function Ge(e,a,i,m){const c=q(()=>e.value.ocrEngine),p=q(()=>e.value.sourceLanguage);function g(v){e.value.ocrEngine=v,i(),console.log(`OCR引擎已设置为: ${v}`)}function x(v){e.value.sourceLanguage=v,i(),console.log(`源语言已设置为: ${v}`)}function O(v){Object.assign(e.value.baiduOcr,v),i()}function f(v){Object.assign(e.value.paddleOcrVl,v),i()}function T(v){Object.assign(e.value.aiVisionOcr,v),i()}function l(v){const P=e.value.aiVisionOcr.provider;P!==v&&(u(P),e.value.aiVisionOcr.provider=v,E(v),i(),console.log(`AI视觉OCR服务商已切换为: ${v}`))}function r(v){e.value.aiVisionOcr.isJsonMode=v;const P=v?ye:Z;e.value.aiVisionOcr.prompt=P,i(),console.log(`AI视觉OCR提示词模式已切换为: ${v?"JSON格式":"普通模式"}`)}function u(v){if(!v)return;const P={apiKey:e.value.aiVisionOcr.apiKey,modelName:e.value.aiVisionOcr.modelName,customBaseUrl:e.value.aiVisionOcr.customBaseUrl,prompt:e.value.aiVisionOcr.prompt,rpmLimit:e.value.aiVisionOcr.rpmLimit,isJsonMode:e.value.aiVisionOcr.isJsonMode,minImageSize:e.value.aiVisionOcr.minImageSize};a.value.aiVisionOcr[v]=P,m(),console.log(`[Settings] 保存AI视觉OCR服务商配置: ${v}`,P)}function E(v){if(!v)return;const P=a.value.aiVisionOcr[v];P?(P.apiKey!==void 0&&(e.value.aiVisionOcr.apiKey=P.apiKey),P.modelName!==void 0&&(e.value.aiVisionOcr.modelName=P.modelName),P.customBaseUrl!==void 0&&(e.value.aiVisionOcr.customBaseUrl=P.customBaseUrl),P.prompt!==void 0&&(e.value.aiVisionOcr.prompt=P.prompt),P.rpmLimit!==void 0&&(e.value.aiVisionOcr.rpmLimit=P.rpmLimit),P.isJsonMode!==void 0&&(e.value.aiVisionOcr.isJsonMode=P.isJsonMode),P.minImageSize!==void 0&&(e.value.aiVisionOcr.minImageSize=P.minImageSize),console.log(`[Settings] 恢复AI视觉OCR服务商配置: ${v}`,P)):(e.value.aiVisionOcr.apiKey="",e.value.aiVisionOcr.modelName="",e.value.aiVisionOcr.customBaseUrl="",console.log(`[Settings] ${v} 无缓存配置，使用默认值`))}return{ocrEngine:c,sourceLanguage:p,setOcrEngine:g,setSourceLanguage:x,updateBaiduOcr:O,updatePaddleOcrVl:f,updateAiVisionOcr:T,setAiVisionOcrProvider:l,setAiVisionOcrPromptMode:r,saveAiVisionOcrProviderConfig:u,restoreAiVisionOcrProviderConfig:E}}function We(e,a,i,m){const c=q(()=>e.value.translation.provider);function p(l){const r=e.value.translation.provider;r!==l&&(f(r),e.value.translation.provider=l,T(l),i())}function g(l){Object.assign(e.value.translation,l),i()}function x(l){e.value.translatePrompt=l,i()}function O(l){e.value.translation.isJsonMode=l;const r=e.value.translation.translationMode==="single";let u;r?u=l?e.value.translation.singleJsonPrompt:e.value.translation.singleNormalPrompt:u=l?e.value.translation.batchJsonPrompt:e.value.translation.batchNormalPrompt,e.value.translatePrompt=u,i(),console.log(`翻译提示词模式已切换为: ${l?"JSON格式":"普通模式"}`)}function f(l){if(!l)return;const r={apiKey:e.value.translation.apiKey,modelName:e.value.translation.modelName,customBaseUrl:e.value.translation.customBaseUrl,rpmLimit:e.value.translation.rpmLimit,maxRetries:e.value.translation.maxRetries,isJsonMode:e.value.translation.isJsonMode,translationMode:e.value.translation.translationMode};a.value.translation[l]=r,m(),console.log(`[Settings] 保存翻译服务商配置: ${l}`,r)}function T(l){if(!l)return;const r=a.value.translation[l];r?(r.apiKey!==void 0&&(e.value.translation.apiKey=r.apiKey),r.modelName!==void 0&&(e.value.translation.modelName=r.modelName),r.customBaseUrl!==void 0&&(e.value.translation.customBaseUrl=r.customBaseUrl),r.rpmLimit!==void 0&&(e.value.translation.rpmLimit=r.rpmLimit),r.maxRetries!==void 0&&(e.value.translation.maxRetries=r.maxRetries),r.isJsonMode!==void 0&&(e.value.translation.isJsonMode=r.isJsonMode),r.translationMode!==void 0&&(e.value.translation.translationMode=r.translationMode),console.log(`[Settings] 恢复翻译服务商配置: ${l}`,r)):(e.value.translation.apiKey="",e.value.translation.modelName="",e.value.translation.customBaseUrl="",console.log(`[Settings] ${l} 无缓存配置，使用默认值`))}return{translationProvider:c,setTranslationProvider:p,updateTranslationService:g,setTranslatePrompt:x,setTranslatePromptMode:O,saveTranslationProviderConfig:f,restoreTranslationProviderConfig:T}}function Xe(e,a){function i(p){e.value.textDetector=p,a(),console.log(`文本检测器已设置为: ${p}`)}function m(p){Object.assign(e.value.boxExpand,p),a()}function c(p){Object.assign(e.value.preciseMask,p),a()}return{setTextDetector:i,updateBoxExpand:m,updatePreciseMask:c}}function Ye(e,a,i,m){const c=q(()=>e.value.hqTranslation.provider);function p(r){const u=e.value.hqTranslation.provider;u!==r&&(T(u),e.value.hqTranslation.provider=r,l(r),i(),console.log(`高质量翻译服务商已切换为: ${r}`))}function g(r){Object.assign(e.value.hqTranslation,r),i()}function x(r){e.value.hqTranslation.useStream=r,i()}function O(r){e.value.hqTranslation.noThinkingMethod=r,i()}function f(r){e.value.hqTranslation.forceJsonOutput=r,i()}function T(r){if(!r)return;const u={apiKey:e.value.hqTranslation.apiKey,modelName:e.value.hqTranslation.modelName,customBaseUrl:e.value.hqTranslation.customBaseUrl,batchSize:e.value.hqTranslation.batchSize,sessionReset:e.value.hqTranslation.sessionReset,rpmLimit:e.value.hqTranslation.rpmLimit,maxRetries:e.value.hqTranslation.maxRetries,lowReasoning:e.value.hqTranslation.lowReasoning,noThinkingMethod:e.value.hqTranslation.noThinkingMethod,forceJsonOutput:e.value.hqTranslation.forceJsonOutput,useStream:e.value.hqTranslation.useStream,prompt:e.value.hqTranslation.prompt};a.value.hqTranslation[r]=u,m(),console.log(`[Settings] 保存高质量翻译服务商配置: ${r}`,u)}function l(r){if(!r)return;const u=a.value.hqTranslation[r];u?(u.apiKey!==void 0&&(e.value.hqTranslation.apiKey=u.apiKey),u.modelName!==void 0&&(e.value.hqTranslation.modelName=u.modelName),u.customBaseUrl!==void 0&&(e.value.hqTranslation.customBaseUrl=u.customBaseUrl),u.batchSize!==void 0&&(e.value.hqTranslation.batchSize=u.batchSize),u.sessionReset!==void 0&&(e.value.hqTranslation.sessionReset=u.sessionReset),u.rpmLimit!==void 0&&(e.value.hqTranslation.rpmLimit=u.rpmLimit),u.maxRetries!==void 0&&(e.value.hqTranslation.maxRetries=u.maxRetries),u.lowReasoning!==void 0&&(e.value.hqTranslation.lowReasoning=u.lowReasoning),u.noThinkingMethod!==void 0&&(e.value.hqTranslation.noThinkingMethod=u.noThinkingMethod),u.forceJsonOutput!==void 0&&(e.value.hqTranslation.forceJsonOutput=u.forceJsonOutput),u.useStream!==void 0&&(e.value.hqTranslation.useStream=u.useStream),u.prompt!==void 0&&(e.value.hqTranslation.prompt=u.prompt),console.log(`[Settings] 恢复高质量翻译服务商配置: ${r}`,u)):(e.value.hqTranslation.apiKey="",e.value.hqTranslation.modelName="",e.value.hqTranslation.customBaseUrl="",console.log(`[Settings] ${r} 无缓存配置，使用默认值`))}return{hqProvider:c,setHqProvider:p,updateHqTranslation:g,setHqUseStream:x,setHqNoThinkingMethod:O,setHqForceJsonOutput:f,saveHqProviderConfig:T,restoreHqProviderConfig:l}}function Ze(e,a){const i=q(()=>e.value.proofreading.enabled);function m(O){e.value.proofreading.enabled=O,a(),console.log(`AI校对已${O?"启用":"禁用"}`)}function c(O){e.value.proofreading.rounds.push(O),a(),console.log(`已添加校对轮次: ${O.name}`)}function p(O,f){if(O>=0&&O<e.value.proofreading.rounds.length){const T=e.value.proofreading.rounds[O];T&&(Object.assign(T,f),a())}}function g(O){if(O>=0&&O<e.value.proofreading.rounds.length){const f=e.value.proofreading.rounds.splice(O,1);a(),console.log(`已删除校对轮次: ${f[0]?.name}`)}}function x(O){e.value.proofreading.maxRetries=O,a()}return{isProofreadingEnabled:i,setProofreadingEnabled:m,addProofreadingRound:c,updateProofreadingRound:p,removeProofreadingRound:g,setProofreadingMaxRetries:x}}function Qe(e,a){function i(c){e.value.textboxPrompt=c,a()}function m(c){e.value.useTextboxPrompt=c,a()}return{setTextboxPrompt:i,setUseTextboxPrompt:m}}function ke(e,a){const i=q(()=>e.value.textStyle);function m(l){Object.assign(e.value,l),a()}function c(l){Object.assign(e.value.textStyle,l)}function p(l){e.value.pdfProcessingMethod=l,a(),console.log(`PDF处理方式已设置为: ${l}`)}function g(l){e.value.showDetectionDebug=l,a()}function x(l){e.value.autoSaveInBookshelfMode=l,a(),console.log(`书架模式自动保存已${l?"启用":"禁用"}`)}function O(l){e.value.removeTextWithOcr=l,a(),console.log(`消除文字模式OCR已${l?"启用":"禁用"}`)}function f(l){e.value.enableVerboseLogs=l,a(),console.log(`详细日志已${l?"启用":"禁用"}`)}function T(l){e.value.lamaDisableResize=l,a(),console.log(`LAMA修复自动缩放已${l?"禁用":"启用"}`)}return{textStyle:i,updateSettings:m,updateTextStyle:c,setPdfProcessingMethod:p,setShowDetectionDebug:g,setAutoSaveInBookshelfMode:x,setRemoveTextWithOcr:O,setEnableVerboseLogs:f,setLamaDisableResize:T}}const eo=ue("settings",()=>{const e=K(V()),a=K({translation:{},hqTranslation:{},aiVisionOcr:{}});function i(){try{const o=JSON.stringify(e.value);localStorage.setItem(F,o)}catch(o){console.error("保存设置到 localStorage 失败:",o)}}function m(){try{const o=JSON.stringify(a.value);localStorage.setItem(G,o)}catch(o){console.error("保存服务商配置缓存失败:",o)}}const c="saber_translator_settings";function p(){try{let o=localStorage.getItem(F);if(!o){const t=localStorage.getItem(c);t&&(console.log("[Settings] 检测到原版设置，正在迁移..."),o=t,localStorage.setItem(F,t),console.log("[Settings] 原版设置已迁移到新存储键"))}if(o){const t=JSON.parse(o),h=V();e.value=O(h,t),x(),e.value.textStyle={...h.textStyle};const n=e.value.translation;n.translationMode==="single"?e.value.translatePrompt=n.isJsonMode?n.singleJsonPrompt:n.singleNormalPrompt:e.value.translatePrompt=n.isJsonMode?n.batchJsonPrompt:n.batchNormalPrompt,console.log("已从 localStorage 加载设置（textStyle 使用默认值）")}}catch(o){console.error("从 localStorage 加载设置失败:",o)}}function g(){try{const o=localStorage.getItem(G);if(o){const t=JSON.parse(o);a.value={translation:t.translation||{},hqTranslation:t.hqTranslation||{},aiVisionOcr:t.aiVisionOcr||{}},console.log("已从 localStorage 加载服务商配置缓存")}}catch(o){console.error("加载服务商配置缓存失败:",o)}}function x(){const o=e.value.boxExpand;o.ratio=Number(o.ratio)||1,o.top=Number(o.top)||0,o.bottom=Number(o.bottom)||0,o.left=Number(o.left)||0,o.right=Number(o.right)||0;const t=e.value.preciseMask;t.dilateSize=Number(t.dilateSize)||5,t.boxExpandRatio=Number(t.boxExpandRatio)||1;const h=e.value.translation;h.rpmLimit=Number(h.rpmLimit)||I,h.maxRetries=Number(h.maxRetries)||D;const n=e.value.hqTranslation;n.batchSize=Number(n.batchSize)||10,n.sessionReset=Number(n.sessionReset)||3,n.rpmLimit=Number(n.rpmLimit)||60,n.maxRetries=Number(n.maxRetries)||B;const s=e.value.aiVisionOcr;s.rpmLimit=Number(s.rpmLimit)||U,s.minImageSize===void 0||s.minImageSize===null||isNaN(Number(s.minImageSize))?s.minImageSize=A:s.minImageSize=Number(s.minImageSize);const d=e.value.proofreading;d.maxRetries=Number(d.maxRetries)||b,h.provider==="baidu"&&(h.provider="baidu_translate"),h.provider==="youdao"&&(h.provider="youdao_translate"),a.value.translation.baidu&&(a.value.translation.baidu_translate={...a.value.translation.baidu},delete a.value.translation.baidu),a.value.translation.youdao&&(a.value.translation.youdao_translate={...a.value.translation.youdao},delete a.value.translation.youdao)}function O(o,t){const h={...o};for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const s=n,d=t[s],y=h[s];d!=null&&typeof d=="object"&&!Array.isArray(d)&&y!==null&&typeof y=="object"&&!Array.isArray(y)?h[s]={...y,...d}:d!==void 0&&(h[s]=d)}return h}const f=Ge(e,a,i,m),T=We(e,a,i,m),l=Xe(e,i),r=Ye(e,a,i,m),u=Ze(e,i),E=Qe(e,i),v=ke(e,i);function P(o,t){o==="translation"?T.saveTranslationProviderConfig(t):o==="hqTranslation"?r.saveHqProviderConfig(t):o==="aiVisionOcr"&&f.saveAiVisionOcrProviderConfig(t)}function oe(o,t){o==="translation"?T.restoreTranslationProviderConfig(t):o==="hqTranslation"?r.restoreHqProviderConfig(t):o==="aiVisionOcr"&&f.restoreAiVisionOcrProviderConfig(t)}function ae(){try{localStorage.removeItem("theme"),typeof document<"u"&&(document.documentElement.setAttribute("data-theme","light"),document.body.setAttribute("data-theme","light"))}catch(o){console.warn("清理旧版主题设置失败:",o)}}function ie(){ae(),p(),g()}function re(){e.value=V(),i(),console.log("设置已重置为默认值")}async function te(){try{console.log("[Settings] 开始从后端加载设置...");const{getUserSettings:o}=await L(async()=>{const{getUserSettings:h}=await import("./config.CwRcCkM9.js");return{getUserSettings:h}},__vite__mapDeps([0,1,2])),t=await o();if(t.success&&t.settings){const h=t.settings;console.log("[Settings] 从后端加载设置:",h),ne(h);const n=V();return e.value.textStyle={...n.textStyle},i(),m(),console.log("[Settings] 后端设置已应用（textStyle 使用默认值）"),!0}else return console.warn("[Settings] 后端无设置数据，使用 localStorage 或默认值"),!1}catch(o){return console.error("[Settings] 从后端加载设置失败:",o),!1}}function ne(o){const t=(n,s)=>{if(n==null||n==="")return s;const d=typeof n=="string"?parseFloat(n):Number(n);return isNaN(d)?s:d};o.ocrEngine&&(e.value.ocrEngine=o.ocrEngine),o.sourceLanguage&&(e.value.sourceLanguage=o.sourceLanguage),o.textDetector&&(e.value.textDetector=o.textDetector),o.baiduApiKey&&(e.value.baiduOcr.apiKey=o.baiduApiKey),o.baiduSecretKey&&(e.value.baiduOcr.secretKey=o.baiduSecretKey),o.baiduVersion&&(e.value.baiduOcr.version=o.baiduVersion),o.baiduSourceLanguage&&(e.value.baiduOcr.sourceLanguage=o.baiduSourceLanguage),o.paddleOcrVlSourceLanguage&&(e.value.paddleOcrVl.sourceLanguage=o.paddleOcrVlSourceLanguage),o.aiVisionProvider&&(e.value.aiVisionOcr.provider=o.aiVisionProvider),o.aiVisionApiKey&&(e.value.aiVisionOcr.apiKey=o.aiVisionApiKey),o.aiVisionModelName&&(e.value.aiVisionOcr.modelName=o.aiVisionModelName),o.aiVisionOcrPrompt&&(e.value.aiVisionOcr.prompt=o.aiVisionOcrPrompt),o.customAiVisionBaseUrl&&(e.value.aiVisionOcr.customBaseUrl=o.customAiVisionBaseUrl),o.rpmAiVisionOcr!==void 0&&(e.value.aiVisionOcr.rpmLimit=t(o.rpmAiVisionOcr,U)),o.aiVisionPromptModeSelect==="json"&&(e.value.aiVisionOcr.isJsonMode=!0),o.aiVisionMinImageSize!==void 0&&(e.value.aiVisionOcr.minImageSize=t(o.aiVisionMinImageSize,A)),o.modelProvider&&(e.value.translation.provider=o.modelProvider),o.apiKey&&(e.value.translation.apiKey=o.apiKey),o.modelName&&(e.value.translation.modelName=o.modelName),o.customBaseUrl&&(e.value.translation.customBaseUrl=o.customBaseUrl),o.rpmTranslation!==void 0&&(e.value.translation.rpmLimit=t(o.rpmTranslation,I)),o.translationMaxRetries!==void 0&&(e.value.translation.maxRetries=t(o.translationMaxRetries,D)),o.translatePromptModeSelect==="json"&&(e.value.translation.isJsonMode=!0),o.translationMode&&(e.value.translation.translationMode=o.translationMode),o.targetLanguage&&(e.value.targetLanguage=o.targetLanguage),o.batchNormalPrompt&&(e.value.translation.batchNormalPrompt=o.batchNormalPrompt),o.batchJsonPrompt&&(e.value.translation.batchJsonPrompt=o.batchJsonPrompt),o.singleNormalPrompt&&(e.value.translation.singleNormalPrompt=o.singleNormalPrompt),o.singleJsonPrompt&&(e.value.translation.singleJsonPrompt=o.singleJsonPrompt);const h=e.value.translation;if(h.translationMode==="single"?e.value.translatePrompt=h.isJsonMode?h.singleJsonPrompt:h.singleNormalPrompt:e.value.translatePrompt=h.isJsonMode?h.batchJsonPrompt:h.batchNormalPrompt,o.enableTextboxPrompt!==void 0&&(e.value.useTextboxPrompt=o.enableTextboxPrompt),o.textboxPromptContent&&(e.value.textboxPrompt=o.textboxPromptContent),o.hqTranslateProvider&&(e.value.hqTranslation.provider=o.hqTranslateProvider),o.hqApiKey&&(e.value.hqTranslation.apiKey=o.hqApiKey),o.hqModelName&&(e.value.hqTranslation.modelName=o.hqModelName),o.hqCustomBaseUrl&&(e.value.hqTranslation.customBaseUrl=o.hqCustomBaseUrl),o.hqBatchSize!==void 0&&(e.value.hqTranslation.batchSize=t(o.hqBatchSize,3)),o.hqSessionReset!==void 0&&(e.value.hqTranslation.sessionReset=t(o.hqSessionReset,3)),o.hqRpmLimit!==void 0&&(e.value.hqTranslation.rpmLimit=t(o.hqRpmLimit,7)),o.hqMaxRetries!==void 0&&(e.value.hqTranslation.maxRetries=t(o.hqMaxRetries,B)),o.hqPrompt&&(e.value.hqTranslation.prompt=o.hqPrompt),o.hqLowReasoning!==void 0&&(e.value.hqTranslation.lowReasoning=o.hqLowReasoning),o.hqNoThinkingMethod&&(e.value.hqTranslation.noThinkingMethod=o.hqNoThinkingMethod),o.hqForceJsonOutput!==void 0&&(e.value.hqTranslation.forceJsonOutput=o.hqForceJsonOutput),o.hqUseStream!==void 0&&(e.value.hqTranslation.useStream=o.hqUseStream),o.proofreadingEnabled!==void 0&&(e.value.proofreading.enabled=o.proofreadingEnabled),o.proofreadingMaxRetries!==void 0&&(e.value.proofreading.maxRetries=t(o.proofreadingMaxRetries,b)),o.proofreading&&typeof o.proofreading=="object"){const n=o.proofreading;n.enabled!==void 0&&(e.value.proofreading.enabled=n.enabled),n.maxRetries!==void 0&&(e.value.proofreading.maxRetries=t(n.maxRetries,b)),Array.isArray(n.rounds)&&(e.value.proofreading.rounds=n.rounds.map(s=>({name:s.name||"轮次",provider:s.provider||"siliconflow",apiKey:s.apiKey||"",modelName:s.modelName||"",customBaseUrl:s.customBaseUrl||"",prompt:s.prompt||"",batchSize:t(s.batchSize,3),sessionReset:t(s.sessionReset,3),rpmLimit:t(s.rpmLimit,7),maxRetries:t(s.maxRetries,b),lowReasoning:s.lowReasoning||!1,noThinkingMethod:s.noThinkingMethod||"gemini",forceJsonOutput:s.forceJsonOutput||!1,useStream:s.useStream!==void 0?s.useStream:!0})))}if(o.boxExpandRatio!==void 0&&(e.value.boxExpand.ratio=t(o.boxExpandRatio,0)),o.boxExpandTop!==void 0&&(e.value.boxExpand.top=t(o.boxExpandTop,0)),o.boxExpandBottom!==void 0&&(e.value.boxExpand.bottom=t(o.boxExpandBottom,0)),o.boxExpandLeft!==void 0&&(e.value.boxExpand.left=t(o.boxExpandLeft,0)),o.boxExpandRight!==void 0&&(e.value.boxExpand.right=t(o.boxExpandRight,0)),o.maskDilateSize!==void 0&&(e.value.preciseMask.dilateSize=t(o.maskDilateSize,5)),o.maskBoxExpandRatio!==void 0&&(e.value.preciseMask.boxExpandRatio=t(o.maskBoxExpandRatio,0)),o.pdfProcessingMethod&&(e.value.pdfProcessingMethod=o.pdfProcessingMethod),o.showDetectionDebug!==void 0&&(e.value.showDetectionDebug=o.showDetectionDebug),o.parallelEnabled!==void 0&&(e.value.parallel.enabled=o.parallelEnabled),o.parallelDeepLearningLockSize!==void 0&&(e.value.parallel.deepLearningLockSize=t(o.parallelDeepLearningLockSize,1)),o.autoSaveInBookshelfMode!==void 0&&(e.value.autoSaveInBookshelfMode=o.autoSaveInBookshelfMode),o.removeTextWithOcr!==void 0&&(e.value.removeTextWithOcr=o.removeTextWithOcr),o.enableVerboseLogs!==void 0&&(e.value.enableVerboseLogs=o.enableVerboseLogs),o.lamaDisableResize!==void 0&&(e.value.lamaDisableResize=o.lamaDisableResize),o.providerSettings&&typeof o.providerSettings=="object"){const n=o.providerSettings;if(n.modelProvider)for(const[s,d]of Object.entries(n.modelProvider))a.value.translation[s]={apiKey:d.apiKey,modelName:d.modelName,customBaseUrl:d.customBaseUrl,rpmLimit:t(d.rpmTranslation,I),maxRetries:t(d.translationMaxRetries,D)};if(n.hqTranslateProvider)for(const[s,d]of Object.entries(n.hqTranslateProvider))a.value.hqTranslation[s]={apiKey:d.hqApiKey,modelName:d.hqModelName,customBaseUrl:d.hqCustomBaseUrl,batchSize:t(d.hqBatchSize,3),sessionReset:t(d.hqSessionReset,3),rpmLimit:t(d.hqRpmLimit,7),maxRetries:t(d.hqMaxRetries,B),lowReasoning:d.hqLowReasoning,noThinkingMethod:d.hqNoThinkingMethod||"gemini",forceJsonOutput:d.hqForceJsonOutput,useStream:d.hqUseStream,prompt:d.hqPrompt};if(n.aiVisionProvider)for(const[s,d]of Object.entries(n.aiVisionProvider))a.value.aiVisionOcr[s]={apiKey:d.aiVisionApiKey,modelName:d.aiVisionModelName,customBaseUrl:d.customAiVisionBaseUrl,prompt:d.aiVisionOcrPrompt,rpmLimit:t(d.rpmAiVisionOcr,U),isJsonMode:d.aiVisionPromptModeSelect==="json",minImageSize:t(d.aiVisionMinImageSize,A)}}console.log("[Settings] 后端设置映射完成")}function se(){const o={},t={},h={};for(const[n,s]of Object.entries(a.value.translation))o[n]={apiKey:s.apiKey||"",modelName:s.modelName||"",customBaseUrl:s.customBaseUrl||"",rpmTranslation:String(s.rpmLimit||0),translationMaxRetries:String(s.maxRetries||3)};for(const[n,s]of Object.entries(a.value.hqTranslation))t[n]={hqApiKey:s.apiKey||"",hqModelName:s.modelName||"",hqCustomBaseUrl:s.customBaseUrl||"",hqBatchSize:String(s.batchSize||3),hqSessionReset:String(s.sessionReset||3),hqRpmLimit:String(s.rpmLimit||7),hqMaxRetries:String(s.maxRetries||2),hqLowReasoning:s.lowReasoning||!1,hqNoThinkingMethod:s.noThinkingMethod||"gemini",hqForceJsonOutput:s.forceJsonOutput??!0,hqUseStream:s.useStream||!1,hqPrompt:s.prompt||""};for(const[n,s]of Object.entries(a.value.aiVisionOcr))h[n]={aiVisionApiKey:s.apiKey||"",aiVisionModelName:s.modelName||"",customAiVisionBaseUrl:s.customBaseUrl||"",aiVisionOcrPrompt:s.prompt||"",rpmAiVisionOcr:String(s.rpmLimit||0),aiVisionPromptModeSelect:s.isJsonMode?"json":"normal",aiVisionMinImageSize:String(s.minImageSize??A)};return{ocrEngine:{},aiVisionProvider:h,modelProvider:o,hqTranslateProvider:t}}async function le(){try{const{saveUserSettings:o}=await L(async()=>{const{saveUserSettings:n}=await import("./config.CwRcCkM9.js");return{saveUserSettings:n}},__vite__mapDeps([0,1,2]));T.saveTranslationProviderConfig(e.value.translation.provider),r.saveHqProviderConfig(e.value.hqTranslation.provider),f.saveAiVisionOcrProviderConfig(e.value.aiVisionOcr.provider);const t={ocrEngine:e.value.ocrEngine,sourceLanguage:e.value.sourceLanguage,textDetector:e.value.textDetector,baiduApiKey:e.value.baiduOcr.apiKey,baiduSecretKey:e.value.baiduOcr.secretKey,baiduVersion:e.value.baiduOcr.version,baiduSourceLanguage:e.value.baiduOcr.sourceLanguage,paddleOcrVlSourceLanguage:e.value.paddleOcrVl.sourceLanguage,aiVisionProvider:e.value.aiVisionOcr.provider,aiVisionApiKey:e.value.aiVisionOcr.apiKey,aiVisionModelName:e.value.aiVisionOcr.modelName,aiVisionOcrPrompt:e.value.aiVisionOcr.prompt,customAiVisionBaseUrl:e.value.aiVisionOcr.customBaseUrl,rpmAiVisionOcr:String(e.value.aiVisionOcr.rpmLimit),aiVisionPromptModeSelect:e.value.aiVisionOcr.isJsonMode?"json":"normal",aiVisionMinImageSize:String(e.value.aiVisionOcr.minImageSize),modelProvider:e.value.translation.provider,apiKey:e.value.translation.apiKey,modelName:e.value.translation.modelName,customBaseUrl:e.value.translation.customBaseUrl,rpmTranslation:String(e.value.translation.rpmLimit),translationMaxRetries:String(e.value.translation.maxRetries),translatePromptModeSelect:e.value.translation.isJsonMode?"json":"normal",translationMode:e.value.translation.translationMode,targetLanguage:e.value.targetLanguage,batchNormalPrompt:e.value.translation.batchNormalPrompt,batchJsonPrompt:e.value.translation.batchJsonPrompt,singleNormalPrompt:e.value.translation.singleNormalPrompt,singleJsonPrompt:e.value.translation.singleJsonPrompt,enableTextboxPrompt:e.value.useTextboxPrompt,textboxPromptContent:e.value.textboxPrompt,hqTranslateProvider:e.value.hqTranslation.provider,hqApiKey:e.value.hqTranslation.apiKey,hqModelName:e.value.hqTranslation.modelName,hqCustomBaseUrl:e.value.hqTranslation.customBaseUrl,hqBatchSize:String(e.value.hqTranslation.batchSize),hqSessionReset:String(e.value.hqTranslation.sessionReset),hqRpmLimit:String(e.value.hqTranslation.rpmLimit),hqMaxRetries:String(e.value.hqTranslation.maxRetries),hqPrompt:e.value.hqTranslation.prompt,hqLowReasoning:e.value.hqTranslation.lowReasoning,hqNoThinkingMethod:e.value.hqTranslation.noThinkingMethod,hqForceJsonOutput:e.value.hqTranslation.forceJsonOutput,hqUseStream:e.value.hqTranslation.useStream,proofreadingEnabled:e.value.proofreading.enabled,proofreadingMaxRetries:String(e.value.proofreading.maxRetries),proofreading:{enabled:e.value.proofreading.enabled,maxRetries:String(e.value.proofreading.maxRetries),rounds:e.value.proofreading.rounds.map(n=>({name:n.name,provider:n.provider,apiKey:n.apiKey,modelName:n.modelName,customBaseUrl:n.customBaseUrl,prompt:n.prompt,batchSize:n.batchSize,sessionReset:n.sessionReset,rpmLimit:n.rpmLimit,maxRetries:n.maxRetries,lowReasoning:n.lowReasoning,noThinkingMethod:n.noThinkingMethod,forceJsonOutput:n.forceJsonOutput,useStream:n.useStream}))},boxExpandRatio:String(e.value.boxExpand.ratio),boxExpandTop:String(e.value.boxExpand.top),boxExpandBottom:String(e.value.boxExpand.bottom),boxExpandLeft:String(e.value.boxExpand.left),boxExpandRight:String(e.value.boxExpand.right),usePreciseMask:!0,maskDilateSize:String(e.value.preciseMask.dilateSize),maskBoxExpandRatio:String(e.value.preciseMask.boxExpandRatio||0),pdfProcessingMethod:e.value.pdfProcessingMethod,showDetectionDebug:e.value.showDetectionDebug,parallelEnabled:e.value.parallel.enabled,parallelDeepLearningLockSize:e.value.parallel.deepLearningLockSize,autoSaveInBookshelfMode:e.value.autoSaveInBookshelfMode,removeTextWithOcr:e.value.removeTextWithOcr,enableVerboseLogs:e.value.enableVerboseLogs,lamaDisableResize:e.value.lamaDisableResize,providerSettings:se()},h=await o(t);return h.success?(console.log("[Settings] 设置已保存到后端"),!0):(console.error("[Settings] 保存设置到后端失败:",h),!1)}catch(o){return console.error("[Settings] 保存设置到后端出错:",o),!1}}return{settings:e,providerConfigs:a,ocrEngine:f.ocrEngine,sourceLanguage:f.sourceLanguage,setOcrEngine:f.setOcrEngine,setSourceLanguage:f.setSourceLanguage,updateBaiduOcr:f.updateBaiduOcr,updatePaddleOcrVl:f.updatePaddleOcrVl,updateAiVisionOcr:f.updateAiVisionOcr,setAiVisionOcrProvider:f.setAiVisionOcrProvider,setAiVisionOcrPromptMode:f.setAiVisionOcrPromptMode,saveAiVisionOcrProviderConfig:f.saveAiVisionOcrProviderConfig,restoreAiVisionOcrProviderConfig:f.restoreAiVisionOcrProviderConfig,translationProvider:T.translationProvider,setTranslationProvider:T.setTranslationProvider,updateTranslationService:T.updateTranslationService,setTranslatePrompt:T.setTranslatePrompt,setTranslatePromptMode:T.setTranslatePromptMode,saveTranslationProviderConfig:T.saveTranslationProviderConfig,restoreTranslationProviderConfig:T.restoreTranslationProviderConfig,setTextDetector:l.setTextDetector,updateBoxExpand:l.updateBoxExpand,updatePreciseMask:l.updatePreciseMask,hqProvider:r.hqProvider,setHqProvider:r.setHqProvider,updateHqTranslation:r.updateHqTranslation,setHqUseStream:r.setHqUseStream,setHqNoThinkingMethod:r.setHqNoThinkingMethod,setHqForceJsonOutput:r.setHqForceJsonOutput,saveHqProviderConfig:r.saveHqProviderConfig,restoreHqProviderConfig:r.restoreHqProviderConfig,isProofreadingEnabled:u.isProofreadingEnabled,setProofreadingEnabled:u.setProofreadingEnabled,addProofreadingRound:u.addProofreadingRound,updateProofreadingRound:u.updateProofreadingRound,removeProofreadingRound:u.removeProofreadingRound,setProofreadingMaxRetries:u.setProofreadingMaxRetries,setTextboxPrompt:E.setTextboxPrompt,setUseTextboxPrompt:E.setUseTextboxPrompt,textStyle:v.textStyle,updateSettings:v.updateSettings,updateTextStyle:v.updateTextStyle,setPdfProcessingMethod:v.setPdfProcessingMethod,setShowDetectionDebug:v.setShowDetectionDebug,setAutoSaveInBookshelfMode:v.setAutoSaveInBookshelfMode,setRemoveTextWithOcr:v.setRemoveTextWithOcr,setEnableVerboseLogs:v.setEnableVerboseLogs,setLamaDisableResize:v.setLamaDisableResize,saveProviderConfig:P,restoreProviderConfig:oe,saveToStorage:i,loadFromStorage:p,initSettings:ie,resetToDefaults:re,loadFromBackend:te,saveToBackend:le}}),_=K([]);let k=0;const oo=3e4,J=e=>{e.timer&&(clearTimeout(e.timer),e.timer=void 0)},N=(e,a="info",i=3e3)=>{const m=++k,c=`msg_${Date.now()}_${Math.floor(Math.random()*1e3)}`,p={id:m,messageId:c,message:e,type:a,isHTML:!1};return i>0&&(p.timer=setTimeout(()=>{w(m)},i)),_.value.push(p),m},w=e=>{const a=_.value.findIndex(i=>i.id===e);if(a!==-1){const i=_.value[a];i&&J(i),_.value.splice(a,1)}},H=()=>{_.value.forEach(e=>{J(e)}),_.value=[]},ao=(e,a)=>N(e,"success",a),io=(e,a)=>N(e,"error",a),ro=(e,a)=>N(e,"info",a),to=(e,a)=>N(e,"warning",a),no=(e,a="info",i=!1,m=5e3,c="")=>{const p=c||`msg_${Date.now()}_${Math.floor(Math.random()*1e3)}`;H();const g=++k,x={id:g,messageId:p,message:e,type:a,isHTML:i},O=Math.max(m,oo);return x.timer=setTimeout(()=>{w(g)},m>0?m:O),_.value.push(x),p},so=e=>{if(!e)return;const a=_.value.findIndex(i=>i.messageId===e);if(a!==-1){const i=_.value[a];i&&J(i),_.value.splice(a,1)}},lo=(e="")=>{if(e==="")H();else{const a=[];_.value.forEach((i,m)=>{i.type===e&&(J(i),a.push(m))});for(let i=a.length-1;i>=0;i--){const m=a[i];m!==void 0&&_.value.splice(m,1)}}},R={toasts:_,addToast:N,removeToast:w,clearAll:H,success:ao,error:io,info:ro,warning:to,showGeneralMessage:no,clearGeneralMessageById:so,clearAllGeneralMessages:lo};function Uo(){return R}function Do(e,a="info",i=3e3){return N(e,a,i)}const uo={class:"vue-toast-container"},co=["innerHTML"],mo={key:1},po=["onClick"],vo=W({__name:"ToastNotification",setup(e,{expose:a}){const i=R.toasts,m=c=>{R.removeToast(c)};return ce(()=>{R.clearAll()}),a({toasts:i,addToast:R.addToast,removeToast:R.removeToast,clearAll:R.clearAll,success:R.success,error:R.error,info:R.info,warning:R.warning,showGeneralMessage:R.showGeneralMessage,clearGeneralMessageById:R.clearGeneralMessageById,clearAllGeneralMessages:R.clearAllGeneralMessages}),(c,p)=>(M(),me(ve,{to:"body"},[j("div",uo,[z(pe,{name:"toast-slide"},{default:de(()=>[(M(!0),S(X,null,fe(Y(i),g=>(M(),S("div",{key:g.id,class:he(["vue-toast-message","vue-toast-"+g.type])},[g.isHTML?(M(),S("span",{key:0,innerHTML:g.message},null,8,co)):(M(),S("span",mo,ge(g.message),1)),j("button",{class:"vue-toast-close",onClick:Te(x=>m(g.id),["stop"])},"×",8,po)],2))),128))]),_:1})])]))}}),fo=(e,a)=>{const i=e.__vccOpts||e;for(const[m,c]of a)i[m]=c;return i},ho=fo(vo,[["__scopeId","data-v-28b4c9eb"]]),go=W({__name:"App",setup(e){const a=eo();return Oe(()=>{a.initSettings()}),(i,m)=>(M(),S(X,null,[z(Y(Pe)),z(ho)],64))}}),To=[{path:"/",name:"bookshelf",component:()=>L(()=>import("./BookshelfView.MgqoiwqD.js"),__vite__mapDeps([3,4,5,6,1,2,7,8,9,10])),meta:{title:"书架"}},{path:"/translate",name:"translate",component:()=>L(()=>import("./TranslateView.D9o22ht4.js"),__vite__mapDeps([11,5,7,1,2,0,12,13,8,9,6,14])),meta:{title:"翻译"},props:e=>({bookId:e.query.book,chapterId:e.query.chapter})},{path:"/reader",name:"reader",component:()=>L(()=>import("./ReaderView.CuWD8vQM.js"),__vite__mapDeps([15,5,6,1,2,16])),meta:{title:"阅读器"},props:e=>({bookId:e.query.book,chapterId:e.query.chapter}),beforeEnter:(e,a,i)=>{!e.query.book||!e.query.chapter?i({name:"bookshelf"}):i()}},{path:"/insight",name:"insight",component:()=>L(()=>import("./InsightView.DRLIM_Al.js"),__vite__mapDeps([17,5,4,6,1,2,12,13,8,9,0,18])),meta:{title:"漫画分析"},props:e=>({bookId:e.query.book})},{path:"/:pathMatch(.*)*",redirect:{name:"bookshelf"}}],ee=xe({history:Re("/"),routes:To});ee.beforeEach((e,a,i)=>{const m=e.meta.title;document.title=m?`${m} - Saber Translator`:"Saber Translator",i()});const C=_e(go),Oo=Ee();C.use(Oo);C.use(ee);C.config.errorHandler=(e,a,i)=>{console.error("Vue 错误:",e,i)};C.mount("#app");export{So as B,Vo as D,Mo as F,bo as L,Ro as P,yo as S,Io as W,fo as _,L as a,De as b,Ue as c,Ie as d,Ne as e,qe as f,eo as g,xo as h,Z as i,ye as j,Ae as k,Se as l,be as m,Q as n,Ve as o,_o as p,No as q,Ao as r,Do as s,qo as t,Uo as u,Lo as v,Eo as w};
